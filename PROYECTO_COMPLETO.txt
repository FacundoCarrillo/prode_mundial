
==================================================
ARCHIVO: .\api_directa.py
==================================================
import requests
import json

# --- CONFIGURACI√ìN PARA API-FOOTBALL (DIRECTO) ---
# F√≠jate que la URL cambi√≥, ya no dice "rapidapi"
url = "https://v3.football.api-sports.io/fixtures"

headers = {
    'x-apisports-key': '8bfe23f584f1867b8ac0841f70d12009'
}

# Vamos a pedir los partidos de la Final del Mundo 2022 para asegurar que haya datos
# League 1 = Mundial. Season 2022.
params = {
    'date': '2025-12-14',
}

print("üì° Conectando directamente a API-Sports...")

try:
    response = requests.get(url, headers=headers, params=params)
    
    # Verificamos si la respuesta es correcta (C√≥digo 200)
    if response.status_code == 200:
        data = response.json()
        
        # Verificar si hay errores en el cuerpo de la respuesta (ej: clave inv√°lida)
        if data.get('errors'):
            print("‚ùå Error reportado por la API:")
            print(data['errors'])
        else:
            partidos = data['response']
            print(f"‚úÖ ¬°Conexi√≥n Exitosa! Se encontraron {len(partidos)} partidos.")
            
            for match in partidos:
                local = match['teams']['home']['name']
                visitante = match['teams']['away']['name']
                goles_local = match['goals']['home']
                goles_visitante = match['goals']['away']
                estado = match['fixture']['status']['long']
                
                print(f"--------------------------------")
                print(f"üèÜ {match['league']['name']} - {match['league']['round']}")
                print(f"‚öΩ {local} {goles_local} - {goles_visitante} {visitante}")
                print(f"üìä Estado: {estado}")

    else:
        print(f"‚ùå Error HTTP {response.status_code}")
        print(response.text)

except Exception as e:
    print(f"‚ùå Error de conexi√≥n: {e}")
==================================================
ARCHIVO: .\crear_contexto.py
==================================================
import os

# Extensiones que nos interesan
extensions = ['.py', '.html', '.css', '.js']
# Carpetas a ignorar (MUY IMPORTANTE para no copiar librerias basura)
ignore_dirs = ['venv', '.git', '__pycache__', '.idea', 'staticfiles']
output_file = 'PROYECTO_COMPLETO.txt'

with open(output_file, 'w', encoding='utf-8') as outfile:
    for root, dirs, files in os.walk("."):
        # Filtrar carpetas ignoradas
        dirs[:] = [d for d in dirs if d not in ignore_dirs]
        
        for file in files:
            if any(file.endswith(ext) for ext in extensions):
                path = os.path.join(root, file)
                outfile.write(f"\n{'='*50}\n")
                outfile.write(f"ARCHIVO: {path}\n")
                outfile.write(f"{'='*50}\n")
                try:
                    with open(path, 'r', encoding='utf-8') as infile:
                        outfile.write(infile.read())
                except Exception as e:
                    outfile.write(f"Error leyendo archivo: {e}\n")

print(f"Listo! Sub√≠ el archivo '{output_file}' al chat.")
==================================================
ARCHIVO: .\manage.py
==================================================
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()

==================================================
ARCHIVO: .\prueba_api.py
==================================================
import requests
import json

# 1. Configuraci√≥n
url = "https://api-football-v1.p.rapidapi.com/v3/fixtures"

# Queremos ver los partidos de HOY
# Ojo: Si hoy no hay partidos interesantes, la lista saldr√° vac√≠a.
# Puedes cambiar la fecha a un d√≠a que sepas que hubo f√∫tbol (ej: '2022-12-18' la final del mundo)
querystring = {"date": "2023-11-21"} 

headers = {
	"X-RapidAPI-Key": "57869ce1a1msh82e5d398f20ccb7p11a477jsnb1a7483a2731",
	"X-RapidAPI-Host": "api-football-v1.p.rapidapi.com"
}

print("üì° Consultando a la API...")

# 2. Hacemos el pedido (Request)
response = requests.get(url, headers=headers, params=querystring)

# 3. Analizamos la respuesta
if response.status_code == 200:
    data = response.json()
    cantidad = data['results']
    print(f"‚úÖ ¬°√âxito! Se encontraron {cantidad} partidos.")
    
    # Vamos a mostrar solo los primeros 3 para no llenar la pantalla
    # La API devuelve una lista dentro de 'response'
    for match in data['response'][:3]:
        local = match['teams']['home']['name']
        visitante = match['teams']['away']['name']
        goles_local = match['goals']['home']
        goles_visitante = match['goals']['away']
        estado = match['fixture']['status']['short'] # FT = Finalizado, NS = No Empezado
        
        print(f"--------------------------------")
        print(f"‚öΩ {local} vs {visitante}")
        print(f"üìä Estado: {estado}")
        print(f"ü•Ö Resultado: {goles_local} - {goles_visitante}")
        
else:
    print(f"‚ùå Error: {response.status_code}")
    print(response.text)
==================================================
ARCHIVO: .\ver_ligas.py
==================================================
import requests

api_token = '1988cfde850245faaaceaf5d9ff33ada' # Tu token
uri = 'https://api.football-data.org/v4/competitions'
headers = { 'X-Auth-Token': api_token }

response = requests.get(uri, headers=headers)
competitions = response.json().get('competitions', [])

print(f"{'ID':<6} | {'NOMBRE':<30} | {'PLAN'}")
print("-" * 50)

for c in competitions:
    # Solo mostramos las del plan gratuito (TIER_ONE) para que no te den error
    if c.get('plan') == 'TIER_ONE': 
        print(f"{c['id']:<6} | {c['name']:<30} | {c['plan']}")
==================================================
ARCHIVO: .\config\asgi.py
==================================================
"""
ASGI config for config project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

application = get_asgi_application()

==================================================
ARCHIVO: .\config\settings.py
==================================================
import os
import dj_database_url
"""
Django settings for config project.

Generated by 'django-admin startproject' using Django 5.2.9.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-@bxyzoskvf)@@hy*t5i9r))!ay7#2v-_*%fu)5kocqu$8%+du*'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['*']


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.sites',
    'core',
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'allauth.socialaccount.providers.google', # Proveedor de Google
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'allauth.account.middleware.AccountMiddleware',
]

ROOT_URLCONF = 'config.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                'core.context_processors.selector_competencias',
            ],
        },
    },
]

WSGI_APPLICATION = 'config.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

# Base de datos por defecto (Tu compu)
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

# Configuraci√≥n para Render (Si existe la variable DATABASE_URL, usa Postgres)
db_from_env = dj_database_url.config(conn_max_age=600)
DATABASES['default'].update(db_from_env)


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'es-ar' # Pone los mensajes en espa√±ol

TIME_ZONE = 'America/Argentina/Buenos_Aires' # Hora Argentina

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'
# Esto le dice a Django d√≥nde juntar los estilos antes de subir
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# Activar compresi√≥n de Whitenoise
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# A d√≥nde ir despu√©s de loguearse
LOGIN_REDIRECT_URL = 'home'

# A d√≥nde ir despu√©s de desloguearse
LOGOUT_REDIRECT_URL = 'home'

# --- CONFIGURACI√ìN DE ALLAUTH (A PRUEBA DE ERRORES) ---
AUTHENTICATION_BACKENDS = [
    'django.contrib.auth.backends.ModelBackend',
    'allauth.account.auth_backends.AuthenticationBackend',
]

SITE_ID = 1
LOGIN_REDIRECT_URL = '/'
LOGOUT_REDIRECT_URL = '/'

# Configuraci√≥n Cl√°sica
# 1. Permitir entrar con Email
ACCOUNT_AUTHENTICATION_METHOD = 'email' 
# 2. El email es obligatorio
ACCOUNT_EMAIL_REQUIRED = True
# 3. No verificar el email (para no trabarnos ahora)
ACCOUNT_EMAIL_VERIFICATION = 'none'
# 4. El usuario tambi√©n es obligatorio (necesitamos un nombre para la tabla de posiciones)
ACCOUNT_USERNAME_REQUIRED = True

# --- SEGURIDAD PARA RENDER ---
CSRF_TRUSTED_ORIGINS = ['https://prode-mundial-kczg.onrender.com']

# --- CONFIGURACI√ìN PARA RENDER (SOLUCI√ìN ERROR 400) ---
import os

# Si estamos en Render, forzamos HTTPS
if os.environ.get('RENDER'):
    # Le avisa a Django que est√° detr√°s de un proxy seguro
    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
    # Forza a que los links de login sean HTTPS
    ACCOUNT_DEFAULT_HTTP_PROTOCOL = 'https'
    # Seguridad extra recomendada
    SECURE_SSL_REDIRECT = True
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True
==================================================
ARCHIVO: .\config\urls.py
==================================================
"""
URL configuration for config project.

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/5.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path
from core.views import home, predecir_partido # <--- Importamos la nueva vista
from core.views import home, predecir_partido, ranking  # <--- Agregamos ranking
from django.urls import path, include # <--- Agrega include aqu√≠
from core.views import home, predecir_partido, ranking, actualizar_partidos_web, mis_torneos, buscar_torneo, unirse_torneo, gestionar_torneo, responder_solicitud, eliminar_torneo # <--- Importala
from core.views import correr_migraciones_web, cargar_fixture_inicial, cambiar_competencia, fixture, tabla_posiciones, cargar_tabla, debug_datos, crear_torneo, unirse_por_codigo, detalle_torneo
from core.views import crear_admin_emergencia, perfil_usuario, editar_perfil, configurar_password

urlpatterns = [
    path('admin/', admin.site.urls),

    # --- CAMBIO AQU√ç ---
    # Reemplazamos la l√≠nea vieja por esta nueva.
    # 'allauth.urls' maneja Login, Logout, Registro y... ¬°GOOGLE!
    path('accounts/', include('allauth.urls')),

    path('', home, name='home'),
    path('predecir/<int:match_id>/', predecir_partido, name='predecir'),
    path('ranking/<int:tournament_id>/', ranking, name='ranking_torneo'),
    path('actualizar-ahora/', actualizar_partidos_web, name='actualizar_web'),
    path('mis-torneos/', mis_torneos, name='mis_torneos'),
    path('buscar-torneo/', buscar_torneo, name='buscar_torneo'),
    path('unirse/<int:tournament_id>/', unirse_torneo, name='unirse_torneo'),
    # Panel de control del due√±o del torneo
    path('torneo/<int:tournament_id>/gestionar/', gestionar_torneo, name='gestionar_torneo'),
    
    # Acci√≥n de aceptar/rechazar (recibe el ID del MIEMBRO, no del torneo)
    path('solicitud/<int:member_id>/<str:accion>/', responder_solicitud, name='responder_solicitud'),
    path('torneo/<int:tournament_id>/eliminar/', eliminar_torneo, name='eliminar_torneo'),
    path('migrar-emergencia/', correr_migraciones_web),
    path('cargar-fixture/<int:id_liga>/', cargar_fixture_inicial, name='cargar_fixture'),
    path('cambiar-liga/<int:comp_id>/', cambiar_competencia, name='cambiar_competencia'),
    path('fixture/', fixture, name='fixture'),
    path('tabla/', tabla_posiciones, name='tabla'),
    path('cargar-tabla/<int:id_liga>/', cargar_tabla, name='cargar_tabla'),
    path('debug/', debug_datos, name='debug'),
    path('crear-torneo/', crear_torneo, name='crear_torneo'),
    # En core/urls.py
    path('unirse-codigo/', unirse_por_codigo, name='unirse_por_codigo'),
    path('torneo/<int:tournament_id>/', detalle_torneo, name='detalle_torneo'),
    path('crear-admin-secreto/', crear_admin_emergencia),
    path('perfil/', perfil_usuario, name='perfil'),
    path('perfil/editar/', editar_perfil, name='editar_perfil'),
    path('perfil/password/', configurar_password, name='configurar_password'),
]


==================================================
ARCHIVO: .\config\wsgi.py
==================================================
"""
WSGI config for config project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

application = get_wsgi_application()

==================================================
ARCHIVO: .\config\__init__.py
==================================================

==================================================
ARCHIVO: .\core\admin.py
==================================================
from django.contrib import admin
from .models import Team, Match, Prediction, Tournament, TournamentMember, Competition

# --- 1. NUEVA CONFIGURACI√ìN PARA COMPETICIONES ---
@admin.register(Competition)
class CompetitionAdmin(admin.ModelAdmin):
    list_display = ('name', 'type', 'api_id', 'slug')
    list_filter = ('type',)
    search_fields = ('name',)
    # Esto hace que el slug se escriba solo mientras escrib√≠s el nombre
    prepopulated_fields = {"slug": ("name",)} 

# --- 2. CONFIGURACI√ìN MEJORADA PARA PARTIDOS ---
@admin.register(Match)
class MatchAdmin(admin.ModelAdmin):
    # Ahora mostramos la Competici√≥n y la Ronda en la lista
    list_display = ('__str__', 'competition', 'round_name', 'date', 'status')
    list_filter = ('competition', 'status', 'date') # Filtros laterales muy √∫tiles
    search_fields = ('home_team__name', 'away_team__name')

# --- 3. CONFIGURACI√ìN MEJORADA PARA TORNEOS ---
class MemberInline(admin.TabularInline):
    model = TournamentMember
    extra = 1

@admin.register(Tournament)
class TournamentAdmin(admin.ModelAdmin):
    list_display = ('name', 'code', 'competition', 'creator', 'created_at')
    list_filter = ('competition',) # Filtro lateral para ver torneos por liga
    search_fields = ('name', 'code')
    inlines = [MemberInline]

# --- 4. RESTO DE MODELOS (Sin cambios mayores) ---
admin.site.register(Team)
admin.site.register(Prediction)

@admin.register(TournamentMember)
class TournamentMemberAdmin(admin.ModelAdmin):
    list_display = ('user', 'tournament', 'status', 'points')
    list_filter = ('status', 'tournament__competition') # Filtramos por la liga del torneo
==================================================
ARCHIVO: .\core\apps.py
==================================================
from django.apps import AppConfig


class CoreConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'core'

==================================================
ARCHIVO: .\core\context_processors.py
==================================================
from .models import Competition

def selector_competencias(request):
    # 1. Obtenemos todas las ligas para el men√∫ desplegable
    todas_comps = Competition.objects.all()
    
    # 2. Buscamos cu√°l est√° seleccionada en la sesi√≥n
    comp_id = request.session.get('competencia_id')
    
    competencia_activa = None
    if comp_id:
        competencia_activa = Competition.objects.filter(id=comp_id).first()
    
    # Si no hay ninguna seleccionada (primera vez), elegimos la primera por defecto
    if not competencia_activa and todas_comps.exists():
        competencia_activa = todas_comps.first()
        # La guardamos en sesi√≥n para la pr√≥xima
        request.session['competencia_id'] = competencia_activa.id

    return {
        'lista_competencias': todas_comps,
        'competencia_activa': competencia_activa
    }
==================================================
ARCHIVO: .\core\forms.py
==================================================
from django import forms
from django.contrib.auth.models import User  # <--- IMPORTANTE: Agregamos esto
from .models import Prediction, Tournament, Match

class PredictionForm(forms.ModelForm):
    class Meta:
        model = Prediction
        fields = ['predicted_home', 'predicted_away']
        widgets = {
            'predicted_home': forms.NumberInput(attrs={'class': 'form-control', 'placeholder': 'Local'}),
            'predicted_away': forms.NumberInput(attrs={'class': 'form-control', 'placeholder': 'Visitante'}),
        }

class TournamentForm(forms.ModelForm):
    # Agregamos los campos para elegir inicio y fin (ChoiceField crea un dropdown)
    start_round = forms.ChoiceField(required=False, label="Desde la fecha")
    end_round = forms.ChoiceField(required=False, label="Hasta la fecha")

    class Meta:
        model = Tournament
        fields = ['name', 'image', 'start_round', 'end_round']
        widgets = {
            'name': forms.TextInput(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400',
                'placeholder': 'Ej: Copa de la Oficina'
            }),
            'image': forms.URLInput(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400',
                'placeholder': 'https://... (Opcional)'
            })
        }

    def __init__(self, *args, **kwargs):
        # Extraemos la competici√≥n que pasaremos desde la vista
        competition = kwargs.pop('competition', None)
        super().__init__(*args, **kwargs)

        if competition:
            # Buscamos todas las rondas √öNICAS de esa liga
            rondas = Match.objects.filter(competition=competition).values_list('round_name', flat=True).distinct().order_by('date')
            
            # Las convertimos en opciones para el select [(valor, texto), ...]
            opciones = [('', 'Torneo Completo (Todas las fechas)')] + [(r, r) for r in rondas]
            
            self.fields['start_round'].choices = opciones
            self.fields['end_round'].choices = opciones
            
            # Estilos CSS para los select
            style = 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-white'
            self.fields['start_round'].widget.attrs['class'] = style
            self.fields['end_round'].widget.attrs['class'] = style

# --- NUEVO FORMULARIO PARA EDITAR PERFIL ---
class EditarPerfilForm(forms.ModelForm):
    class Meta:
        model = User
        fields = ['username', 'email', 'first_name', 'last_name']
        widgets = {
            'username': forms.TextInput(attrs={'class': 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500'}),
            'email': forms.EmailInput(attrs={'class': 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500 bg-gray-100 text-gray-500', 'readonly': 'readonly'}), 
            'first_name': forms.TextInput(attrs={'class': 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500'}),
            'last_name': forms.TextInput(attrs={'class': 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500'}),
        }
    
    def clean_email(self):
        # Evita que cambien el email (importante si usas Google Login)
        return self.instance.email
==================================================
ARCHIVO: .\core\models.py
==================================================
from django.db import models
from django.contrib.auth.models import User
import random
import string

# --- 1. NUEVA ENTIDAD: COMPETICI√ìN (La base de la nueva arquitectura) ---
class Competition(models.Model):
    name = models.CharField(max_length=100, verbose_name="Nombre Liga/Copa") # Ej: Premier League
    slug = models.SlugField(unique=True, verbose_name="Identificador URL") # Ej: premier-league
    api_id = models.IntegerField(unique=True, verbose_name="ID en API Football") # Ej: 2021
    
    # Esto define si mostramos Tabla de Posiciones (Liga) o Grupos/Llaves (Copa)
    TYPE_CHOICES = [
        ('LEAGUE', 'Liga'), 
        ('CUP', 'Copa'),    
    ]
    type = models.CharField(max_length=10, choices=TYPE_CHOICES, default='LEAGUE')

    def __str__(self):
        return self.name

# --- 2. EQUIPOS (Sin cambios, solo mantenemos tu estructura) ---
class Team(models.Model):
    name = models.CharField(max_length=50, verbose_name="Nombre")
    flag_code = models.CharField(max_length=5, verbose_name="C√≥digo Bandera") # Ej: "ar", "br"
    logo = models.URLField(null=True, blank=True, verbose_name="Escudo URL")
    
    def __str__(self):
        return self.name

# --- 3. PARTIDOS (Ahora con Competici√≥n y Ronda) ---
class Match(models.Model):
    # Relaci√≥n nueva: Cada partido pertenece a una Liga/Copa espec√≠fica
    competition = models.ForeignKey(Competition, on_delete=models.CASCADE, related_name='matches', verbose_name="Competici√≥n")
    
    home_team = models.ForeignKey(Team, on_delete=models.CASCADE, related_name='home_matches', verbose_name="Local")
    away_team = models.ForeignKey(Team, on_delete=models.CASCADE, related_name='away_matches', verbose_name="Visitante")
    
    date = models.DateTimeField(verbose_name="Fecha del partido")
    status = models.CharField(max_length=20, default='SCHEDULED')
    
    # --- CAMPO NUEVO PARA TU FILTRO DE FECHAS ---
    # Aqu√≠ guardaremos "Regular Season - 1", "Group A - 3", "Quarter-finals", etc.
    round_name = models.CharField(max_length=50, verbose_name="Ronda / Fecha") 
    
    # Goles reales
    home_goals = models.IntegerField(null=True, blank=True, verbose_name="Goles Local")
    away_goals = models.IntegerField(null=True, blank=True, verbose_name="Goles Visitante")
    
    class Meta:
        verbose_name = "Partido"
        verbose_name_plural = "Partidos"

    def __str__(self):
        return f"[{self.competition.name}] {self.home_team} vs {self.away_team} ({self.round_name})"

# --- 4. PREDICCIONES (Tu l√≥gica original intacta) ---
class Prediction(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    match = models.ForeignKey(Match, on_delete=models.CASCADE)
    
    predicted_home = models.IntegerField(verbose_name="Predicci√≥n Local")
    predicted_away = models.IntegerField(verbose_name="Predicci√≥n Visitante")
    points = models.IntegerField(default=0) 
    
    def __str__(self):
        return f"{self.user.username}: {self.predicted_home}-{self.predicted_away}"

    def get_score(self):
        """
        Calcula los puntos ganados comparando con el resultado real del partido.
        Retorna: 3 (Exacto), 1 (Tendencia), 0 (Nada) o None (Si no se jug√≥).
        """
        if self.match.home_goals is None or self.match.away_goals is None:
            return None

        ph = self.predicted_home
        pa = self.predicted_away
        rh = self.match.home_goals
        ra = self.match.away_goals

        # 1. Exacto (3 Puntos)
        if ph == rh and pa == ra:
            return 3

        # 2. Tendencia (1 Punto)
        gana_local = (ph > pa) and (rh > ra)
        gana_visitante = (ph < pa) and (rh < ra)
        empate = (ph == pa) and (rh == ra)

        if gana_local or gana_visitante or empate:
            return 1
        
        # 3. Nada
        return 0

# --- 5. TORNEOS (Actualizado con Competici√≥n y Rango de Fechas) ---
class Tournament(models.Model):
    name = models.CharField(max_length=100, verbose_name="Nombre del Torneo")
    code = models.CharField(max_length=6, unique=True, verbose_name="C√≥digo de Invitaci√≥n")
    creator = models.ForeignKey(User, on_delete=models.CASCADE, related_name="created_tournaments")
    image = models.URLField(blank=True, null=True, verbose_name="Imagen (URL)")
    created_at = models.DateTimeField(auto_now_add=True)

    # --- NUEVOS FILTROS MAESTROS ---
    # Un torneo pertenece obligatoriamente a UNA competici√≥n (Premier, Champions, etc.)
    competition = models.ForeignKey(Competition, on_delete=models.CASCADE, verbose_name="Liga/Copa Base")
    
    # Rango de fechas (Opcional: Si se dejan vac√≠os, incluye todo el torneo)
    start_round = models.CharField(max_length=50, null=True, blank=True, verbose_name="Desde la Ronda")
    end_round = models.CharField(max_length=50, null=True, blank=True, verbose_name="Hasta la Ronda")

    members = models.ManyToManyField(User, through='TournamentMember', related_name="tournaments")

    def save(self, *args, **kwargs):
        if not self.code:
            self.code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))
        super().save(*args, **kwargs)

    def __str__(self):
        return f"{self.name} ({self.competition.name})"

# --- 6. MIEMBROS (Sin cambios) ---
class TournamentMember(models.Model):
    STATUS_CHOICES = [
        ('PENDING', 'Pendiente de Aprobaci√≥n'),
        ('ACCEPTED', 'Aceptado / Jugando'),
        ('REJECTED', 'Rechazado'),
    ]

    tournament = models.ForeignKey(Tournament, on_delete=models.CASCADE)
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    status = models.CharField(max_length=10, choices=STATUS_CHOICES, default='PENDING')
    joined_at = models.DateTimeField(auto_now_add=True)
    
    # Puntaje acumulado SOLO en este torneo
    points = models.IntegerField(default=0) 

    class Meta:
        unique_together = ('tournament', 'user')
        verbose_name = "Miembro de Torneo"
        verbose_name_plural = "Miembros de Torneo"

    def __str__(self):
        return f"{self.user.username} en {self.tournament.name} ({self.status})"
    
class Standing(models.Model):
    competition = models.ForeignKey(Competition, on_delete=models.CASCADE, related_name='standings')
    team = models.ForeignKey(Team, on_delete=models.CASCADE)
    
    position = models.IntegerField(default=0)
    played = models.IntegerField(default=0)
    won = models.IntegerField(default=0)
    drawn = models.IntegerField(default=0)
    lost = models.IntegerField(default=0)
    points = models.IntegerField(default=0)
    goals_for = models.IntegerField(default=0)
    goals_against = models.IntegerField(default=0)
    goal_diff = models.IntegerField(default=0)
    
    # Para Mundiales o Champions (Ej: "GROUP_A")
    group = models.CharField(max_length=20, null=True, blank=True) 

    class Meta:
        ordering = ['group', 'position'] # Ordenar por grupo y posici√≥n

    def __str__(self):
        return f"{self.competition.name} - {self.team.name} ({self.points} pts)"
==================================================
ARCHIVO: .\core\tests.py
==================================================
from django.test import TestCase

# Create your tests here.

==================================================
ARCHIVO: .\core\views.py
==================================================
from django.shortcuts import render, redirect, get_object_or_404
from .models import Match, Prediction, Team, Tournament, TournamentMember, Competition, Standing
from .forms import PredictionForm
from django.contrib.auth.decorators import login_required
from django.contrib.auth.models import User
from django.utils import timezone # <--- IMPORTANTE
from django.core.management import call_command
from django.contrib.admin.views.decorators import staff_member_required
from django.http import HttpResponse
import io
from .forms import TournamentForm
from django.db.models import Q
from django.contrib import messages
import requests
from datetime import timedelta
from itertools import groupby
from operator import attrgetter
from django.db.models import Sum, Count, Avg
from django.contrib.auth import update_session_auth_hash
from django.contrib.auth.forms import PasswordChangeForm, SetPasswordForm
from .forms import EditarPerfilForm # Aseg√∫rate de importar el form que acabamos de crear

# En core/views.py

@login_required
def home(request):
    # 1. Competencia Activa
    comp_id = request.session.get('competencia_id')
    if not comp_id:
        first_comp = Competition.objects.first()
        if first_comp:
            comp_id = first_comp.id
            request.session['competencia_id'] = comp_id
    
    competencia_activa = None
    partidos = Match.objects.none()
    
    if comp_id:
        competencia_activa = Competition.objects.get(id=comp_id)
        # Filtramos por competencia para que no se mezclen
        partidos = Match.objects.filter(competition_id=comp_id).order_by('date')

    # 2. Agrupar Partidos para el Men√∫
    grupos_temp = {}
    rondas_nombres = [] 

    for partido in partidos:
        ronda = partido.round_name
        if ronda not in grupos_temp:
            grupos_temp[ronda] = []
            rondas_nombres.append(ronda)
        
        # Buscamos predicci√≥n del usuario
        pred = Prediction.objects.filter(user=request.user, match=partido).first()
        
        item = {
            'partido': partido,
            'prediccion': pred
        }
        grupos_temp[ronda].append(item)

    # 3. L√≥gica del Selector de Fechas
    ronda_seleccionada = request.GET.get('ronda')

    # Si no eligi√≥ nada, buscamos la m√°s cercana a HOY
    if not ronda_seleccionada and rondas_nombres:
        hoy = timezone.now()
        partido_futuro = partidos.filter(date__gte=hoy).first()
        
        if partido_futuro:
            ronda_seleccionada = partido_futuro.round_name
        else:
            # Si ya termin√≥ todo, mostramos la √∫ltima fecha
            ronda_seleccionada = rondas_nombres[-1]

    # Obtenemos los partidos de esa fecha espec√≠fica
    grupo_activo = []
    if ronda_seleccionada and ronda_seleccionada in grupos_temp:
        grupo_activo = grupos_temp[ronda_seleccionada]
    
    # Ordenamos por horario
    grupo_activo.sort(key=lambda x: x['partido'].date)

    return render(request, 'core/home.html', {
        'competencia_activa': competencia_activa,
        'rondas_disponibles': rondas_nombres,   # <--- Esto llena el men√∫
        'ronda_actual': ronda_seleccionada,     # <--- Esto marca la opci√≥n
        'partidos_mostrar': grupo_activo        # <--- Esto llena la lista
    })

@login_required # ¬°Ojo! Solo usuarios logueados pueden predecir
def predecir_partido(request, match_id):
    partido = get_object_or_404(Match, id=match_id)
    
    # --- NUEVA REGLA: VALIDACI√ìN DE HORARIO ---
    # Si la fecha del partido es menor a "ahora", ya empez√≥.
    if partido.date < timezone.now():
        # Opci√≥n A: Mostrar error feo
        # return HttpResponse("El partido ya empez√≥, tarde piaste.")
        
        # Opci√≥n B (Mejor): Redirigir al home y que se de cuenta solo
        return redirect('home')
    # ------------------------------------------

    prediccion_existente = Prediction.objects.filter(user=request.user, match=partido).first()

    if request.method == 'POST':
        # Si envi√≥ datos, cargamos el formulario con esos datos
        form = PredictionForm(request.POST, instance=prediccion_existente)
        if form.is_valid():
            # Guardamos pero sin enviar a la DB todav√≠a (commit=False)
            prediccion = form.save(commit=False)
            # Asignamos los datos faltantes que no vienen en el form
            prediccion.user = request.user
            prediccion.match = partido
            prediccion.save() # ¬°Ahora s√≠ guardamos!
            # --- CAMBIO AQU√ç: REDIRECCI√ìN INTELIGENTE ---
            # 1. Obtenemos el nombre de la ronda (Ej: "Fecha 16")
            ronda = partido.round_name
            
            # 2. Armamos la URL para que abra esa ronda y baje hasta el partido
            # El signo # hace que el navegador baje hasta el ID del partido
            return redirect(f"/?ronda={ronda}#group-{ronda}")
            # --------------------------------------------# Lo mandamos al inicio
    else:
        # Si solo est√° visitando la p√°gina, mostramos el form (vac√≠o o con datos previos)
        form = PredictionForm(instance=prediccion_existente)

    return render(request, 'core/prediccion.html', {'form': form, 'partido': partido})
@login_required
def ranking(request, tournament_id=None):
    # 1. Si no hay ID, mandar a Mis Torneos
    if not tournament_id:
        messages.warning(request, "Debes seleccionar un torneo primero.")
        return redirect('mis_torneos')

    torneo = get_object_or_404(Tournament, id=tournament_id)
    
    # 2. Verificar si el usuario pertenece al torneo (Mirando la tabla intermedia expl√≠citamente)
    soy_miembro = TournamentMember.objects.filter(
        user=request.user, 
        tournament=torneo,
        status='ACCEPTED' # Solo dejamos pasar si est√° Aceptado
    ).exists()

    if not soy_miembro:
        # Si no es miembro aceptado, lo rebotamos
        messages.error(request, "No tienes permiso para ver este torneo o tu solicitud sigue pendiente.")
        return redirect('mis_torneos')

    # 3. Armar la Tabla de Posiciones
    ranking_data = []
    
    # Traemos a todos los miembros aceptados, ordenados por puntos (Mayor a menor)
    miembros = TournamentMember.objects.filter(
        tournament=torneo, 
        status='ACCEPTED'
    ).select_related('user').order_by('-points')

    for i, miembro in enumerate(miembros, 1):
        ranking_data.append({
            'posicion': i,
            'usuario': miembro.user.username,
            'puntos': miembro.points,
            'es_el_usuario': (miembro.user == request.user)
        })

    return render(request, 'core/ranking.html', {
        'ranking_data': ranking_data,
        'titulo': f"üèÜ {torneo.name}",
        'torneo': torneo
    })

    # 3. Ordenamos la lista de mayor a menor puntaje
    # lambda es una forma corta de decir: "ordena usando la clave 'puntos'"
    lista_ranking.sort(key=lambda x: x['puntos'], reverse=True)

    return render(request, 'core/ranking.html', {'ranking': lista_ranking})

@login_required
def actualizar_partidos_web(request):
    if not request.user.is_staff:
        messages.error(request, "Solo el administrador puede actualizar partidos.")
        return redirect('home')

    # --- TU TOKEN REAL AQU√ç ---
    API_TOKEN = '1988cfde850245faaaceaf5d9ff33ada' 
    # --------------------------
    
    base_url = "https://api.football-data.org/v4/matches"
    headers = {'X-Auth-Token': API_TOKEN}
    
    # Rango de fechas
    hoy = timezone.now().date()
    ayer = hoy - timedelta(days=5)
    manana = hoy + timedelta(days=5)
    
    params = {
        'dateFrom': ayer.strftime('%Y-%m-%d'),
        'dateTo': manana.strftime('%Y-%m-%d')
    }

    reporte = [] 

    try:
        response = requests.get(base_url, headers=headers, params=params)
        data = response.json()
        
        if 'matches' in data:
            for item in data['matches']:
                local = item['homeTeam']['name']
                visitante = item['awayTeam']['name']
                goles_local = item['score']['fullTime']['home']
                goles_visitante = item['score']['fullTime']['away']
                estado = item['status']
                
                # Info para el reporte
                info_partido = {
                    'partido': f"{local} vs {visitante}",
                    'resultado': f"{goles_local} - {goles_visitante}" if goles_local is not None else "- vs -",
                    'estado': estado,
                    'accion': 'Ignorado (No existe en DB)'
                }

                # Buscar en DB
                partido_db = Match.objects.filter(
                    home_team__name__icontains=local,
                    away_team__name__icontains=visitante
                ).first()

                if partido_db:
                    info_partido['accion'] = '‚úÖ Actualizado'
                    
                    # 1. ACTUALIZAR DATOS B√ÅSICOS
                    if goles_local is not None:
                        partido_db.home_goals = goles_local
                        partido_db.away_goals = goles_visitante
                    
                    partido_db.date = item['utcDate']
                    partido_db.status = estado # Guardamos el estado (FINISHED, TIMED, etc)
                    partido_db.save()

                    # 2. CALCULAR PUNTOS (üî• CORRECCI√ìN AQU√ç üî•)
                    # Solo entramos a calcular si EFECTIVAMENTE hay goles cargados
                    if goles_local is not None and goles_visitante is not None:
                        
                        preds = Prediction.objects.filter(match=partido_db)
                        puntos_repartidos = 0
                        
                        # Calculamos ganador real (Ahora es seguro porque no son None)
                        winner_real = "H" if goles_local > goles_visitante else "A" if goles_visitante > goles_local else "D"
                        
                        for pred in preds:
                            pts = 0
                            # A. Acierto Exacto (3 pts)
                            if pred.predicted_home == goles_local and pred.predicted_away == goles_visitante:
                                pts = 3
                            else:
                                # B. Acierto de Tendencia (1 pt)
                                winner_pred = "H" if pred.predicted_home > pred.predicted_away else "A" if pred.predicted_away > pred.predicted_home else "D"
                                
                                if winner_real == winner_pred:
                                    pts = 1
                            
                            # Guardar solo si cambi√≥ el puntaje
                            if pred.points != pts:
                                pred.points = pts
                                pred.save()
                                puntos_repartidos += 1
                                
                        if puntos_repartidos > 0:
                            info_partido['accion'] += f" y Puntos Recalculados ({puntos_repartidos} preds)"

                reporte.append(info_partido)

            # 3. RECALCULAR PUNTAJES TOTALES DE LOS TORNEOS
            miembros = TournamentMember.objects.filter(status='ACCEPTED')
            for m in miembros:
                # Sumamos todos los puntos de las predicciones de este usuario
                total = Prediction.objects.filter(user=m.user).aggregate(Sum('points'))['points__sum'] or 0
                if m.points != total:
                    m.points = total
                    m.save()

        else:
            messages.warning(request, "La API respondi√≥ OK pero sin partidos.")

    except Exception as e:
        print(f"ERROR EN UPDATE: {e}") # Para ver en la consola negra
        messages.error(request, f"Error: {e}")
        return redirect('mis_torneos')

    return render(request, 'core/actualizar_resultados.html', {'reporte': reporte})
    
@login_required
def mis_torneos(request):
    # --- 1. L√ìGICA DE COMPETENCIA (Tu c√≥digo original) ---
    comp_id = request.session.get('competencia_id')
    if not comp_id:
        primera = Competition.objects.first()
        if primera:
            comp_id = primera.id
            request.session['competencia_id'] = comp_id
            
    # Manejo seguro si no hay competencias
    competencia_activa = None
    if comp_id:
        competencia_activa = get_object_or_404(Competition, id=comp_id)

    # --- 2. FILTRADO (Tu c√≥digo + Adaptaci√≥n al nuevo dise√±o) ---
    
    # Usamos 'mis_torneos' en el return para coincidir con el HTML nuevo
    mis_torneos_list = TournamentMember.objects.filter(
        user=request.user, 
        status='ACCEPTED',
        tournament__competition=competencia_activa # <--- ¬°MANTENEMOS EL FILTRO!
    ).select_related('tournament').order_by('-joined_at')

    pendientes_list = TournamentMember.objects.filter(
        user=request.user, 
        status='PENDING',
        tournament__competition=competencia_activa # <--- ¬°MANTENEMOS EL FILTRO!
    ).select_related('tournament').order_by('-joined_at')

    # Nota: Ya no procesamos el formulario aqu√≠ porque el bot√≥n "Crear"
    # del nuevo dise√±o lleva a una vista dedicada ('crear_torneo').

    return render(request, 'core/mis_torneos.html', {
        'mis_torneos': mis_torneos_list, 
        'pendientes': pendientes_list,
        'competencia_activa': competencia_activa
    })

@login_required
def buscar_torneo(request):
    query = request.GET.get('q')
    resultados = []

    if query:
        # Buscamos por Nombre o por C√≥digo exacto
        resultados = Tournament.objects.filter(
            Q(name__icontains=query) | Q(code__iexact=query)
        ).exclude(members=request.user) # Excluir los que ya estoy unido

    return render(request, 'core/buscar_torneo.html', {'resultados': resultados, 'query': query})

@login_required
def unirse_torneo(request, tournament_id):
    torneo = Tournament.objects.get(id=tournament_id)
    
    # Verificamos si ya existe la solicitud para no duplicar
    miembro, created = TournamentMember.objects.get_or_create(
        user=request.user,
        tournament=torneo
    )
    
    if created:
        miembro.status = 'PENDING' # Por defecto entra en espera
        miembro.save()
        messages.success(request, f'Solicitud enviada a "{torneo.name}". Espera que el admin te acepte.')
    else:
        messages.info(request, 'Ya has enviado una solicitud a este torneo.')
        
    return redirect('mis_torneos')
@login_required
def gestionar_torneo(request, tournament_id):
    torneo = get_object_or_404(Tournament, id=tournament_id)
    
    # SEGURIDAD: Solo el creador puede entrar aqu√≠
    if request.user != torneo.creator:
        messages.error(request, "Solo el creador del torneo puede gestionarlo.")
        return redirect('mis_torneos')

    # Buscamos pendientes y aceptados
    pendientes = TournamentMember.objects.filter(tournament=torneo, status='PENDING')
    aceptados = TournamentMember.objects.filter(tournament=torneo, status='ACCEPTED')

    return render(request, 'core/gestionar_torneo.html', {
        'torneo': torneo,
        'pendientes': pendientes,
        'aceptados': aceptados
    })

@login_required
def responder_solicitud(request, member_id, accion):
    miembro = get_object_or_404(TournamentMember, id=member_id)
    torneo = miembro.tournament
    
    # SEGURIDAD: Solo el creador puede decidir
    if request.user != torneo.creator:
        messages.error(request, "No tienes permiso para hacer esto.")
        return redirect('mis_torneos')

    if accion == 'aceptar':
        miembro.status = 'ACCEPTED'
        miembro.save()
        messages.success(request, f"¬°{miembro.user.username} ha sido aceptado en el torneo!")
        
    elif accion == 'rechazar':
        # Si rechazamos, borramos la solicitud para que pueda volver a intentar o simplemente desaparezca
        nombre = miembro.user.username
        miembro.delete()
        messages.warning(request, f"Solicitud de {nombre} rechazada.")

    # Volvemos al panel de gesti√≥n
    return redirect('gestionar_torneo', tournament_id=torneo.id)

@login_required
def eliminar_torneo(request, tournament_id):
    torneo = get_object_or_404(Tournament, id=tournament_id)
    
    # SEGURIDAD: Solo el creador puede borrarlo
    if request.user != torneo.creator:
        messages.error(request, "No tienes permiso para eliminar este torneo.")
        return redirect('mis_torneos')
    
    # Borramos el torneo (y a todos sus miembros en cascada)
    nombre = torneo.name
    torneo.delete()
    messages.success(request, f"El torneo '{nombre}' ha sido eliminado correctamente.")
    
    return redirect('mis_torneos')

# --- AGREGAR AL FINAL DE core/views.py ---
from django.core.management import call_command
from django.http import HttpResponse

def correr_migraciones_web(request):
    try:
        # 1. Le decimos a Django: "F√≠jate qu√© cambios hubo en models.py" (Crea el archivo de migraci√≥n)
        call_command('makemigrations')
        
        # 2. Le decimos: "Aplica esos cambios a la base de datos real"
        call_command('migrate')
        
        return HttpResponse("‚úÖ ¬°√âXITO! Se agreg√≥ la columna 'points' y la base de datos est√° actualizada.")
    except Exception as e:
        return HttpResponse(f"‚ùå Error al migrar: {e}")
    
# --- AGREGAR AL FINAL DE core/views.py ---

# Aseg√∫rate de tener estos imports arriba en views.py:
# from .models import Match, Team, Competition  <-- IMPORTANTE AGREGAR Competition
# import requests

# En core/views.py

def cargar_fixture_inicial(request, id_liga): # <--- AHORA RECIBE EL ID
    if not request.user.is_staff:
        return HttpResponse("‚õî Acceso denegado.")

    API_TOKEN = '1988cfde850245faaaceaf5d9ff33ada' 
    
    # YA NO EST√Å FIJO. Usamos el que viene de la URL
    COMPETITION_ID_API = id_liga 
    
    headers = {'X-Auth-Token': API_TOKEN}
    url = f"https://api.football-data.org/v4/competitions/{COMPETITION_ID_API}/matches"

    log_html = f"<h1>üìù Reporte de Carga (Liga ID: {id_liga})</h1><ul>"
    actualizados = 0
    nuevos = 0

    try:
        try:
            competencia_db = Competition.objects.get(api_id=COMPETITION_ID_API)
        except Competition.DoesNotExist:
            return HttpResponse(f"‚ùå Error: No existe la competici√≥n con ID {COMPETITION_ID_API} en tu base de datos. <br>Ve al Admin y cr√©ala primero.")

        response = requests.get(url, headers=headers)
        data = response.json()
        
        if 'matches' in data:
            for item in data['matches']:
                
                # LOGICA UNIVERSAL (Sirve para Mundial, Premier, etc.)
                nombre_local = item['homeTeam']['name'] or "A Confirmar"
                nombre_visitante = item['awayTeam']['name'] or "A Confirmar"
                flag_local = item['homeTeam'].get('tla') or 'XX'
                flag_visitante = item['awayTeam'].get('tla') or 'XX'

                # 1. Equipos
                equipo_local, _ = Team.objects.get_or_create(
                    name=nombre_local, 
                    defaults={'logo': item['homeTeam'].get('crest'), 'flag_code': flag_local}
                )
                equipo_visitante, _ = Team.objects.get_or_create(
                    name=nombre_visitante, 
                    defaults={'logo': item['awayTeam'].get('crest'), 'flag_code': flag_visitante}
                )

                # 2. Datos
                fecha = item['utcDate']
                estado = item['status']
                gol_local = item['score']['fullTime']['home']
                gol_visitante = item['score']['fullTime']['away']
                
                ronda_api = item.get('matchday')
                nombre_ronda = f"Fecha {ronda_api}" if ronda_api else item.get('stage', 'General').replace('_', ' ').title()

                # 3. Guardar
                partido = Match.objects.filter(
                    competition=competencia_db, 
                    home_team=equipo_local, 
                    away_team=equipo_visitante
                ).first()

                if partido:
                    cambios = []
                    if partido.status != estado:
                        partido.status = estado
                        cambios.append("Estado")
                    if partido.home_goals != gol_local:
                        partido.home_goals = gol_local
                        partido.away_goals = gol_visitante
                        cambios.append("Goles")
                    
                    if cambios:
                        partido.save()
                        actualizados += 1
                        log_html += f"<li>‚úÖ <b>{equipo_local} vs {equipo_visitante}</b>: Actualizado</li>"
                else:
                    Match.objects.create(
                        competition=competencia_db,
                        home_team=equipo_local,
                        away_team=equipo_visitante,
                        date=fecha,
                        status=estado,
                        round_name=nombre_ronda,
                        home_goals=gol_local,
                        away_goals=gol_visitante
                    )
                    nuevos += 1
                    log_html += f"<li>üÜï <b>{equipo_local} vs {equipo_visitante}</b>: Creado</li>"

            log_html += f"</ul><h2>Resumen: {nuevos} Nuevos, {actualizados} Actualizados.</h2>"
            return HttpResponse(log_html)
        
        else:
            return HttpResponse(f"‚ö†Ô∏è La API respondi√≥ sin partidos. Data: {data}")

    except Exception as e:
        return HttpResponse(f"‚ùå Error cr√≠tico: {e}")
    
def cambiar_competencia(request, comp_id):
    # Guardamos la elecci√≥n en la "memoria" del navegador (Sesi√≥n)
    request.session['competencia_id'] = comp_id
    
    # Redirigimos al usuario a la misma p√°gina donde estaba (o al home si falla)
    return redirect(request.META.get('HTTP_REFERER', 'home'))

# En core/views.py

# En core/views.py

def fixture(request):
    # 1. Competencia Activa
    comp_id = request.session.get('competencia_id')
    if not comp_id:
        first_comp = Competition.objects.first()
        if first_comp:
            comp_id = first_comp.id
            request.session['competencia_id'] = comp_id
    
    competencia_activa = None
    partidos = Match.objects.none()
    
    if comp_id:
        competencia_activa = Competition.objects.get(id=comp_id)
        # Filtramos por competencia
        partidos = Match.objects.filter(competition_id=comp_id).order_by('date')

    # 2. Agrupar Partidos para el Men√∫
    grupos_temp = {}
    rondas_nombres = [] 

    for partido in partidos:
        ronda = partido.round_name
        if ronda not in grupos_temp:
            grupos_temp[ronda] = []
            rondas_nombres.append(ronda)
        
        # En Fixture NO necesitamos predicciones, as√≠ que guardamos solo el partido
        item = { 'partido': partido }
        grupos_temp[ronda].append(item)

    # 3. L√≥gica del Selector de Fechas
    ronda_seleccionada = request.GET.get('ronda')

    # Si no eligi√≥ nada, buscamos la m√°s cercana a HOY
    if not ronda_seleccionada and rondas_nombres:
        hoy = timezone.now()
        partido_futuro = partidos.filter(date__gte=hoy).first()
        
        if partido_futuro:
            ronda_seleccionada = partido_futuro.round_name
        else:
            ronda_seleccionada = rondas_nombres[-1]

    # Obtenemos los partidos de esa fecha espec√≠fica
    grupo_activo = []
    if ronda_seleccionada and ronda_seleccionada in grupos_temp:
        grupo_activo = grupos_temp[ronda_seleccionada]
    
    # Ordenamos por horario
    grupo_activo.sort(key=lambda x: x['partido'].date)

    return render(request, 'core/fixture.html', {
        'competencia_activa': competencia_activa,
        'rondas_disponibles': rondas_nombres,
        'ronda_actual': ronda_seleccionada,
        'partidos_mostrar': grupo_activo
    })

def cargar_tabla(request, id_liga):
    if not request.user.is_staff:
        return HttpResponse("‚õî Acceso denegado.")

    API_TOKEN = '1988cfde850245faaaceaf5d9ff33ada' 
    headers = {'X-Auth-Token': API_TOKEN}
    url = f"https://api.football-data.org/v4/competitions/{id_liga}/standings"

    log_html = f"<h1>üìä Cargando Tabla (Liga: {id_liga})</h1><ul>"
    
    try:
        try:
            competencia_db = Competition.objects.get(api_id=id_liga)
        except Competition.DoesNotExist:
            return HttpResponse(f"‚ùå Error: No existe la competici√≥n {id_liga}. Carga primero el fixture.")

        # Limpiamos tabla anterior
        Standing.objects.filter(competition=competencia_db).delete()

        response = requests.get(url, headers=headers)
        data = response.json()
        
        if 'standings' in data:
            for bloque in data['standings']:
                if bloque['type'] == 'TOTAL':
                    
                    # --- CORRECCI√ìN CLAVE PARA LIGAS ---
                    # En ligas, 'group' viene como None. Validamos antes de usar replace.
                    raw_group = bloque.get('group')
                    if raw_group:
                        nombre_grupo = raw_group.replace('_', ' ') # Ej: GROUP A
                    else:
                        nombre_grupo = "General" # Para Premier, Bundesliga, etc.
                    # -----------------------------------
                    
                    for row in bloque['table']:
                        equipo_api = row['team']
                        nombre_equipo = equipo_api['name'] or "A Confirmar"

                        # Buscamos o creamos el equipo
                        team_obj, _ = Team.objects.get_or_create(
                            name=nombre_equipo,
                            defaults={
                                'logo': equipo_api.get('crest'),
                                'flag_code': 'XX'
                            }
                        )

                        Standing.objects.create(
                            competition=competencia_db,
                            team=team_obj,
                            position=row['position'],
                            played=row['playedGames'],
                            won=row['won'],
                            drawn=row['draw'],
                            lost=row['lost'],
                            points=row['points'],
                            goals_for=row['goalsFor'],
                            goals_against=row['goalsAgainst'],
                            goal_diff=row['goalDifference'],
                            group=nombre_grupo
                        )
                        log_html += f"<li>‚úÖ {row['position']}¬∞ {team_obj.name} ({row['points']} pts)</li>"

            return HttpResponse(log_html + "</ul>")
        else:
            return HttpResponse(f"‚ö†Ô∏è La API no devolvi√≥ tablas. Data: {data}")

    except Exception as e:
        return HttpResponse(f"‚ùå Error cr√≠tico: {e}")

def tabla_posiciones(request):
    # 1. Obtener Liga Activa
    comp_id = request.session.get('competencia_id')
    if not comp_id:
        first = Competition.objects.first()
        if first:
            comp_id = first.id
            request.session['competencia_id'] = comp_id
            
    # 2. Buscar datos
    standings = []
    competencia = None
    
    if comp_id:
        competencia = Competition.objects.get(id=comp_id)
        # Traemos la tabla ordenada por Grupo y luego por Posici√≥n
        standings = Standing.objects.filter(competition_id=comp_id).order_by('group', 'position')

    # 3. Agrupar para el HTML (Para que se vea separado por grupos)
    # Usamos itertools.groupby que es muy eficiente para esto
    from itertools import groupby
    
    # Convertimos a lista de diccionarios: [ {'nombre': 'GROUP A', 'equipos': [...]}, ... ]
    tabla_agrupada = []
    for key, group in groupby(standings, key=lambda x: x.group):
        tabla_agrupada.append({
            'nombre_grupo': key,
            'equipos': list(group)
        })

    return render(request, 'core/tabla.html', {
        'tabla_agrupada': tabla_agrupada,
        'competencia': competencia
    })


@staff_member_required
def debug_datos(request):
    comps = Competition.objects.all()
    
    html = """
    <body style='font-family: sans-serif; padding: 20px; background: #f0f0f0;'>
    <h1>üïµÔ∏è‚Äç‚ôÇÔ∏è Detective de Datos</h1>
    <div style='background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);'>
    """
    
    # 1. ¬øQu√© est√°s viendo t√∫ ahora?
    sess_id = request.session.get('competencia_id')
    html += f"<h3>üîë Tu Sesi√≥n Actual</h3><p>Est√°s "
    
    if sess_id:
        try:
            actual = Competition.objects.get(id=sess_id)
            html += f"viendo la liga: <b>{actual.name}</b> (ID Interno: <b>{actual.id}</b> | API ID: <b>{actual.api_id}</b>)"
        except:
            html += f"apuntando a una ID que ya no existe: <b>{sess_id}</b>"
    else:
        html += "sin ninguna liga seleccionada (None)."
    
    html += "</p><hr>"

    # 2. ¬øD√≥nde est√°n los partidos realmente?
    html += "<h3>üìö Inventario de Ligas</h3><ul>"
    for c in comps:
        qty = Match.objects.filter(competition=c).count()
        color = "green" if qty > 0 else "red"
        select_btn = f" <a href='/cambiar-liga/{c.id}/' style='text-decoration:none; background:#333; color:white; padding:2px 8px; border-radius:4px; font-size:12px;'>üëâ Seleccionar</a>"
        
        html += f"<li style='margin-bottom: 10px; color:{color};'>"
        html += f"üèÜ <b>{c.name}</b> (ID: {c.id} | API_ID: {c.api_id}) <br>"
        html += f"&nbsp;&nbsp;&nbsp;&nbsp;‚û° Tiene <b>{qty}</b> partidos cargados. {select_btn}</li>"
        
    html += "</ul></div></body>"
    return HttpResponse(html)

@login_required
def crear_torneo(request):
    # Recuperamos la competencia igual que siempre
    comp_id = request.session.get('competencia_id')
    competencia_activa = get_object_or_404(Competition, id=comp_id)

    if request.method == 'POST':
        # Validamos l√≠mite de 3 torneos (Tu l√≥gica original)
        cantidad_creados = Tournament.objects.filter(creator=request.user, competition=competencia_activa).count()
        
        if cantidad_creados >= 3:
            messages.error(request, "üö´ L√≠mite alcanzado: Solo 3 torneos por liga.")
            return redirect('mis_torneos')

        form = TournamentForm(request.POST)
        if form.is_valid():
            torneo = form.save(commit=False)
            torneo.creator = request.user
            torneo.competition = competencia_activa # Asignaci√≥n autom√°tica
            torneo.save()
            
            # Crear la membres√≠a del creador autom√°ticamente
            TournamentMember.objects.create(
                user=request.user, 
                tournament=torneo, 
                status='ACCEPTED'
            )
            
            messages.success(request, f'¬°Torneo "{torneo.name}" creado!')
            return redirect('mis_torneos')
    else:
        form = TournamentForm()

    return render(request, 'core/crear_torneo.html', {
        'form': form,
        'competencia': competencia_activa
    })

# En core/views.py

@login_required
def unirse_por_codigo(request):
    if request.method == 'POST':
        codigo = request.POST.get('codigo', '').strip()
        
        # 1. Buscamos si existe un torneo con ese c√≥digo
        try:
            torneo = Tournament.objects.get(code=codigo)
        except Tournament.DoesNotExist:
            messages.error(request, "‚ùå C√≥digo inv√°lido. No encontramos ese torneo.")
            return redirect('unirse_por_codigo')

        # 2. Verificamos si ya es miembro
        if TournamentMember.objects.filter(user=request.user, tournament=torneo).exists():
            messages.warning(request, f"Ya eres parte de {torneo.name}.")
            return redirect('mis_torneos')

        # 3. Lo unimos (Si el torneo es privado podr√≠as ponerlo como PENDING, aqu√≠ lo aceptamos directo o seg√∫n tu l√≥gica)
        TournamentMember.objects.create(
            user=request.user, 
            tournament=torneo, 
            status='ACCEPTED' # O 'PENDING' si quieres aprobaci√≥n del admin
        )
        
        messages.success(request, f"‚úÖ ¬°Te uniste a {torneo.name} exitosamente!")
        return redirect('mis_torneos')

    return render(request, 'core/unirse_por_codigo.html')

@login_required
def detalle_torneo(request, tournament_id):
    # Buscamos el torneo o damos error 404
    torneo = get_object_or_404(Tournament, id=tournament_id)
    
    # Buscamos los miembros aceptados y los ordenamos por puntos (mayor a menor)
    ranking = TournamentMember.objects.filter(
        tournament=torneo, 
        status='ACCEPTED'
    ).select_related('user').order_by('-points')

    return render(request, 'core/detalle_torneo.html', {
        'torneo': torneo,
        'ranking': ranking
    })


def crear_admin_emergencia(request):
    # Verificamos si ya existe para no dar error
    if not User.objects.filter(username='admin').exists():
        # CREA EL SUPERUSUARIO
        User.objects.create_superuser('admin', 'admin@example.com', 'admin123')
        return HttpResponse("‚úÖ ¬°Usuario 'admin' creado con contrase√±a 'admin123'! Entra a /admin")
    else:
        return HttpResponse("‚ö†Ô∏è El usuario 'admin' ya existe.")
    
@login_required
def perfil_usuario(request):
    # 1. Estad√≠sticas Globales
    mis_preds = Prediction.objects.filter(user=request.user)
    
    total_pronosticos = mis_preds.count()
    total_puntos = mis_preds.aggregate(Sum('points'))['points__sum'] or 0
    
    # Plenos (3 puntos) vs Tendencias (1 punto)
    plenos = mis_preds.filter(points=3).count()
    tendencias = mis_preds.filter(points=1).count()
    fallos = mis_preds.filter(points=0).count() # Ojo: esto incluye partidos no jugados si se guardan con 0
    
    # Calcular efectividad real (Solo sobre partidos terminados)
    # Filtramos partidos que YA se jugaron (status='FINISHED')
    preds_terminadas = mis_preds.filter(match__status='FINISHED')
    jugados_count = preds_terminadas.count()
    
    efectividad = 0
    promedio = 0
    if jugados_count > 0:
        aciertos_totales = preds_terminadas.exclude(points=0).count()
        efectividad = int((aciertos_totales / jugados_count) * 100)
        promedio = round(total_puntos / jugados_count, 2)

    context = {
        'total_pronosticos': total_pronosticos,
        'total_puntos': total_puntos,
        'plenos': plenos,
        'tendencias': tendencias,
        'efectividad': efectividad,
        'promedio': promedio,
        'jugados_count': jugados_count
    }
    return render(request, 'core/perfil.html', context)

@login_required
def editar_perfil(request):
    if request.method == 'POST':
        form = EditarPerfilForm(request.POST, instance=request.user)
        if form.is_valid():
            form.save()
            messages.success(request, "‚úÖ Tus datos han sido actualizados.")
            return redirect('perfil')
    else:
        form = EditarPerfilForm(instance=request.user)
    
    return render(request, 'core/editar_perfil.html', {'form': form})

# 2. VISTA: Gestionar Contrase√±a (La m√°gica ‚ú®)
@login_required
def configurar_password(request):
    # Si el usuario ya tiene contrase√±a (login normal), usamos PasswordChangeForm
    # Si entr√≥ con Google (no tiene usable password), usamos SetPasswordForm
    
    if request.user.has_usable_password():
        FormularioPassword = PasswordChangeForm
        titulo = "Cambiar Contrase√±a"
    else:
        FormularioPassword = SetPasswordForm
        titulo = "Crear Contrase√±a"

    if request.method == 'POST':
        form = FormularioPassword(request.user, request.POST)
        if form.is_valid():
            user = form.save()
            # IMPORTANTE: Esto evita que se cierre la sesi√≥n al cambiar la clave
            update_session_auth_hash(request, user) 
            messages.success(request, "üîê ¬°Contrase√±a actualizada correctamente!")
            return redirect('perfil')
        else:
            messages.error(request, "Por favor corrige los errores abajo.")
    else:
        form = FormularioPassword(request.user)

    return render(request, 'core/password.html', {
        'form': form, 
        'titulo': titulo,
        'tiene_pass': request.user.has_usable_password()
    })
==================================================
ARCHIVO: .\core\__init__.py
==================================================

==================================================
ARCHIVO: .\core\management\commands\actualizar_partidos.py
==================================================
from django.core.management.base import BaseCommand
from core.models import Match, Competition, Team
import requests
from django.utils import timezone
from datetime import timedelta

class Command(BaseCommand):
    help = 'Actualiza partidos respetando la Competici√≥n y la Ronda'

    def handle(self, *args, **kwargs):
        self.stdout.write("üì° Conectando a Football-Data.org...")

        # --- TU TOKEN (Tomado de tu archivo original) ---
        API_TOKEN = '1988cfde850245faaaceaf5d9ff33ada' 
        headers = {'X-Auth-Token': API_TOKEN}
        base_url = "https://api.football-data.org/v4/competitions"

        # 1. Iteramos solo sobre las competiciones que cargaste en la DB
        competiciones_activas = Competition.objects.all()

        if not competiciones_activas:
            self.stdout.write(self.style.ERROR("‚ùå No hay competiciones cargadas en la base de datos. Cre√°las en el Admin primero."))
            return

        for comp in competiciones_activas:
            self.stdout.write(f"\nüèÜ Procesando: {comp.name} (ID API: {comp.api_id})...")
            
            # Pedimos los partidos de ESTA competici√≥n
            # Traemos partidos recientes y futuros cercanos (Rango amplio para fixture)
            hoy = timezone.now().date()
            desde = hoy - timedelta(days=5) 
            hasta = hoy + timedelta(days=15)
            
            url = f"{base_url}/{comp.api_id}/matches"
            params = {
                'dateFrom': desde.strftime('%Y-%m-%d'),
                'dateTo': hasta.strftime('%Y-%m-%d')
            }

            try:
                response = requests.get(url, headers=headers, params=params)
                data = response.json()

                if 'errorCode' in data:
                    self.stdout.write(self.style.WARNING(f"   ‚ö†Ô∏è Error API: {data.get('message')}"))
                    continue

                partidos_api = data.get('matches', [])
                self.stdout.write(f"   ‚úÖ Encontrados: {len(partidos_api)} partidos.")

                for item in partidos_api:
                    # --- A. PROCESAR EQUIPOS ---
                    # Usamos get_or_create para no duplicar
                    local, _ = Team.objects.get_or_create(
                        name=item['homeTeam']['name'],
                        defaults={
                            'logo': item['homeTeam'].get('crest'),
                            'flag_code': item['homeTeam'].get('tla', 'XX')
                        }
                    )
                    visitante, _ = Team.objects.get_or_create(
                        name=item['awayTeam']['name'],
                        defaults={
                            'logo': item['awayTeam'].get('crest'),
                            'flag_code': item['awayTeam'].get('tla', 'XX')
                        }
                    )

                    # --- B. DETECTAR RONDA (Vital para tu lista plegable) ---
                    # La API devuelve 'matchday' (ej: 10) o 'stage' (ej: GROUP_STAGE)
                    ronda = item.get('matchday')
                    stage = item.get('stage')
                    
                    if ronda:
                        nombre_ronda = f"Fecha {ronda}"
                    else:
                        # Limpiamos el nombre feo de la API (Ej: REGULAR_SEASON -> Regular Season)
                        nombre_ronda = stage.replace('_', ' ').title() if stage else "General"

                    # --- C. DATOS DEL PARTIDO ---
                    fecha_str = item['utcDate']
                    estado = item['status']
                    goles_local = item['score']['fullTime']['home']
                    goles_visitante = item['score']['fullTime']['away']

                    # --- D. BUSCAR O CREAR PARTIDO ---
                    # Ahora filtramos TAMBI√âN por competici√≥n para evitar cruces
                    match_obj, created = Match.objects.get_or_create(
                        competition=comp,
                        home_team=local,
                        away_team=visitante,
                        defaults={
                            'date': fecha_str,
                            'status': estado,
                            'round_name': nombre_ronda, # <--- Guardamos la ronda aqu√≠
                            'home_goals': goles_local,
                            'away_goals': goles_visitante
                        }
                    )

                    if not created:
                        # Si ya existe, actualizamos datos clave
                        cambios = False
                        if match_obj.status != estado:
                            match_obj.status = estado
                            cambios = True
                        if match_obj.home_goals != goles_local:
                            match_obj.home_goals = goles_local
                            match_obj.away_goals = goles_visitante
                            cambios = True
                        if match_obj.date != item['utcDate']: # Por si cambi√≥ el horario
                            # Ojo: comparar strings de fecha puede ser truculento, pero sirve para cambios grandes
                            pass 
                        
                        if cambios:
                            match_obj.save()
                            self.stdout.write(f"      üîÑ Actualizado: {local} vs {visitante}")
                    else:
                        self.stdout.write(self.style.SUCCESS(f"      ‚ú® Nuevo: {local} vs {visitante} ({nombre_ronda})"))

            except Exception as e:
                self.stdout.write(self.style.ERROR(f"   ‚ùå Error conectando: {e}"))

        self.stdout.write(self.style.SUCCESS("\n‚úÖ Proceso de carga finalizado."))
==================================================
ARCHIVO: .\core\management\commands\actualizar_partidos_apisports.py
==================================================
from django.core.management.base import BaseCommand
from core.models import Match
import requests
from django.utils import timezone
from datetime import timedelta

class Command(BaseCommand):
    help = 'Actualiza partidos de Ayer, Hoy y Ma√±ana'

    def handle(self, *args, **kwargs):
        self.stdout.write("üì° Iniciando actualizaci√≥n masiva...")

        # TU CONFIGURACI√ìN
        base_url = "https://v3.football.api-sports.io/fixtures"
        headers = {
            'x-apisports-key': '8bfe23f584f1867b8ac0841f70d12009' 
        }

        # Calculamos las fechas: Ayer, Hoy, Ma√±ana
        hoy = timezone.now().date()
        fechas_a_revisar = [
            hoy - timedelta(days=1), # Ayer
            hoy,                     # Hoy
            hoy + timedelta(days=1)  # Ma√±ana
        ]

        # BUCLE PRINCIPAL
        for fecha in fechas_a_revisar:
            fecha_str = fecha.strftime('%Y-%m-%d')
            self.stdout.write(f"üìÖ Consultando fecha: {fecha_str}...")

            params = {
                'date': fecha_str
            }

            try:
                response = requests.get(base_url, headers=headers, params=params)
                
                if response.status_code != 200:
                    self.stdout.write(self.style.ERROR(f"‚ùå Error API en {fecha_str}"))
                    continue 

                data = response.json()
                
                # Diagn√≥stico de errores (Plan Free, Cuota, etc)
                errores = data.get('errors')
                if errores:
                    self.stdout.write(self.style.WARNING(f"‚ö†Ô∏è ALERTA API en {fecha_str}: {errores}"))
                    continue 

                partidos_api = data.get('response', [])
                self.stdout.write(f"   --> Encontrados en API: {len(partidos_api)} partidos")

                count_actualizados = 0

                for item in partidos_api:
                    # 1. Datos API
                    nombre_local_api = item['teams']['home']['name']
                    nombre_visitante_api = item['teams']['away']['name']
                    
                    # --- ESTA ES LA L√çNEA QUE FALTABA (MODO ESP√çA) ---
                    self.stdout.write(f"üëÄ API ve: {nombre_local_api} vs {nombre_visitante_api}")
                    # -------------------------------------------------

                    goles_local = item['goals']['home']
                    goles_visitante = item['goals']['away']
                    estado = item['fixture']['status']['short']

                    # Logos
                    logo_local = item['teams']['home']['logo']
                    logo_visitante = item['teams']['away']['logo']

                    # 2. Buscar en DB
                    partido_db = Match.objects.filter(
                        home_team__name__icontains=nombre_local_api,
                        away_team__name__icontains=nombre_visitante_api
                    ).first()

                    if partido_db:
                        cambios = False

                        # A. Actualizar Goles
                        if goles_local is not None and goles_visitante is not None:
                            if partido_db.home_goals != goles_local or partido_db.away_goals != goles_visitante:
                                partido_db.home_goals = goles_local
                                partido_db.away_goals = goles_visitante
                                cambios = True

                        # B. Actualizar Logos (Esto s√≠ estaba, pero me aseguro que est√© bien)
                        if partido_db.home_team.logo != logo_local:
                            partido_db.home_team.logo = logo_local
                            partido_db.home_team.save()
                            self.stdout.write(f"      üõ°Ô∏è Logo actualizado: {nombre_local_api}")

                        if partido_db.away_team.logo != logo_visitante:
                            partido_db.away_team.logo = logo_visitante
                            partido_db.away_team.save()
                            self.stdout.write(f"      üõ°Ô∏è Logo actualizado: {nombre_visitante_api}")

                        # Guardar cambios
                        if cambios:
                            partido_db.save()
                            self.stdout.write(self.style.SUCCESS(f"      ‚úÖ Goles actualizados: {nombre_local_api}"))
                            count_actualizados += 1
                        
            except Exception as e:
                self.stdout.write(self.style.ERROR(f"‚ùå Error cr√≠tico en {fecha_str}: {e}"))

        self.stdout.write(self.style.SUCCESS("‚ú® Proceso finalizado."))
==================================================
ARCHIVO: .\core\migrations\0001_initial.py
==================================================
# Generated by Django 5.2.9 on 2025-12-20 01:01

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Competition',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre Liga/Copa')),
                ('slug', models.SlugField(unique=True, verbose_name='Identificador URL')),
                ('api_id', models.IntegerField(unique=True, verbose_name='ID en API Football')),
                ('type', models.CharField(choices=[('LEAGUE', 'Liga'), ('CUP', 'Copa')], default='LEAGUE', max_length=10)),
            ],
        ),
        migrations.CreateModel(
            name='Team',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50, verbose_name='Nombre')),
                ('flag_code', models.CharField(max_length=5, verbose_name='C√≥digo Bandera')),
                ('logo', models.URLField(blank=True, null=True, verbose_name='Escudo URL')),
            ],
        ),
        migrations.CreateModel(
            name='Match',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateTimeField(verbose_name='Fecha del partido')),
                ('status', models.CharField(default='SCHEDULED', max_length=20)),
                ('round_name', models.CharField(max_length=50, verbose_name='Ronda / Fecha')),
                ('home_goals', models.IntegerField(blank=True, null=True, verbose_name='Goles Local')),
                ('away_goals', models.IntegerField(blank=True, null=True, verbose_name='Goles Visitante')),
                ('competition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='matches', to='core.competition', verbose_name='Competici√≥n')),
                ('away_team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='away_matches', to='core.team', verbose_name='Visitante')),
                ('home_team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='home_matches', to='core.team', verbose_name='Local')),
            ],
            options={
                'verbose_name': 'Partido',
                'verbose_name_plural': 'Partidos',
            },
        ),
        migrations.CreateModel(
            name='Prediction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('predicted_home', models.IntegerField(verbose_name='Predicci√≥n Local')),
                ('predicted_away', models.IntegerField(verbose_name='Predicci√≥n Visitante')),
                ('points', models.IntegerField(default=0)),
                ('match', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.match')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Tournament',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre del Torneo')),
                ('code', models.CharField(max_length=6, unique=True, verbose_name='C√≥digo de Invitaci√≥n')),
                ('image', models.URLField(blank=True, null=True, verbose_name='Imagen (URL)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('start_round', models.CharField(blank=True, max_length=50, null=True, verbose_name='Desde la Ronda')),
                ('end_round', models.CharField(blank=True, max_length=50, null=True, verbose_name='Hasta la Ronda')),
                ('competition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.competition', verbose_name='Liga/Copa Base')),
                ('creator', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='created_tournaments', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='TournamentMember',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('PENDING', 'Pendiente de Aprobaci√≥n'), ('ACCEPTED', 'Aceptado / Jugando'), ('REJECTED', 'Rechazado')], default='PENDING', max_length=10)),
                ('joined_at', models.DateTimeField(auto_now_add=True)),
                ('points', models.IntegerField(default=0)),
                ('tournament', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.tournament')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Miembro de Torneo',
                'verbose_name_plural': 'Miembros de Torneo',
                'unique_together': {('tournament', 'user')},
            },
        ),
        migrations.AddField(
            model_name='tournament',
            name='members',
            field=models.ManyToManyField(related_name='tournaments', through='core.TournamentMember', to=settings.AUTH_USER_MODEL),
        ),
    ]

==================================================
ARCHIVO: .\core\migrations\0002_standing.py
==================================================
# Generated by Django 5.2.9 on 2025-12-20 06:16

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='Standing',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('position', models.IntegerField(default=0)),
                ('played', models.IntegerField(default=0)),
                ('won', models.IntegerField(default=0)),
                ('drawn', models.IntegerField(default=0)),
                ('lost', models.IntegerField(default=0)),
                ('points', models.IntegerField(default=0)),
                ('goals_for', models.IntegerField(default=0)),
                ('goals_against', models.IntegerField(default=0)),
                ('goal_diff', models.IntegerField(default=0)),
                ('group', models.CharField(blank=True, max_length=20, null=True)),
                ('competition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='standings', to='core.competition')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.team')),
            ],
            options={
                'ordering': ['group', 'position'],
            },
        ),
    ]

==================================================
ARCHIVO: .\core\migrations\__init__.py
==================================================

==================================================
ARCHIVO: .\core\templates\account\login.html
==================================================
{% extends 'core/base.html' %}
{% load socialaccount %}
{% load i18n %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh]">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-200">
        
        <div class="text-center mb-6">
            <h2 class="text-3xl font-bold text-slate-800">Bienvenido</h2>
            <p class="text-gray-500 text-sm mt-2">Ingresa para jugar al Prode</p>
        </div>

        <div class="mb-6">
            {% get_providers as socialaccount_providers %}
            {% if socialaccount_providers %}
            <a href="{% provider_login_url 'google' %}?next=/" 
               class="flex items-center justify-center w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold py-3 px-4 rounded-md transition duration-200 shadow-sm gap-3">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Logo Google">
                Continuar con Google
            </a>
            {% endif %}
        </div>

        <div class="relative flex py-2 items-center mb-6">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="flex-shrink mx-4 text-gray-400 text-sm">O ingresa con tu email</span>
            <div class="flex-grow border-t border-gray-300"></div>
        </div>

        <form class="login" method="POST" action="{% url 'account_login' %}">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm">
                    {{ form.non_field_errors.0 }}
                </div>
            {% endif %}

            <div class="space-y-4">
                
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email o Usuario</label>
                    <input type="text" 
                           name="login" 
                           placeholder="tu@email.com" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           required>
                    {% if form.login.errors %}
                        <p class="text-red-500 text-xs italic mt-1">{{ form.login.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <div>
                    <div class="flex justify-between">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Contrase√±a</label>
                        <a href="{% url 'account_reset_password' %}" class="text-xs text-blue-600 hover:underline">¬øOlvidaste tu contrase√±a?</a>
                    </div>
                    <input type="password" 
                           name="password" 
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           required>
                    {% if form.password.errors %}
                        <p class="text-red-500 text-xs italic mt-1">{{ form.password.errors.0 }}</p>
                    {% endif %}
                </div>

                <div class="flex items-center">
                    <input type="checkbox" name="remember" id="id_remember" class="h-4 w-4 text-yellow-500 focus:ring-yellow-400 border-gray-300 rounded">
                    <label for="id_remember" class="ml-2 block text-sm text-gray-900">
                        Recordarme
                    </label>
                </div>

                <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-md transition duration-200 mt-2">
                    Ingresar
                </button>
            </div>
        </form>

        <p class="text-center text-gray-500 text-xs mt-6">
            ¬øA√∫n no tienes cuenta? 
            <a href="{% url 'account_signup' %}" class="text-blue-600 hover:underline">Reg√≠strate aqu√≠</a>
        </p>
    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\account\signup.html
==================================================
{% extends 'core/base.html' %}
{% load socialaccount %}
{% load i18n %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh]">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-200">
        
        <div class="text-center mb-6">
            <h2 class="text-3xl font-bold text-slate-800">Crear Cuenta</h2>
            <p class="text-gray-500 text-sm mt-2">√önete para jugar al Prode</p>
        </div>

        <div class="mb-6">
            {% get_providers as socialaccount_providers %}
            {% if socialaccount_providers %}
            <a href="{% provider_login_url 'google' %}?next=/" 
               class="flex items-center justify-center w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold py-3 px-4 rounded-md transition duration-200 shadow-sm gap-3">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Logo Google">
                Registrarse con Google
            </a>
            {% endif %}
        </div>

        <div class="relative flex py-2 items-center mb-6">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="flex-shrink mx-4 text-gray-400 text-sm">O usa tu email</span>
            <div class="flex-grow border-t border-gray-300"></div>
        </div>

        <form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
            {% csrf_token %}

            {% if form.non_field_errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}

            <div class="space-y-4">
                {% for field in form %}
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">{{ field.label }}</label>
                    <input type="{{ field.field.widget.input_type }}" 
                           name="{{ field.name }}" 
                           id="{{ field.id_for_label }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           {% if field.field.required %}required{% endif %}
                           placeholder="{{ field.label }}">
                    
                    {% if field.errors %}
                        <p class="text-red-500 text-xs italic mt-1">{{ field.errors.0 }}</p>
                    {% endif %}
                    
                    {% if field.help_text %}
                        <p class="text-gray-400 text-xs mt-1">{{ field.help_text|safe }}</p>
                    {% endif %}
                </div>
                {% endfor %}

                <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-md transition duration-200 mt-2">
                    Registrarse
                </button>
            </div>
        </form>

        <p class="text-center text-gray-500 text-xs mt-6">
            ¬øYa tienes cuenta? 
            <a href="{% url 'account_login' %}" class="text-blue-600 hover:underline">Ingresa aqu√≠</a>
        </p>
    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\actualizar_resultados.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">
    
    <div class="mb-6 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-slate-800">üì° Reporte de Conexi√≥n API</h1>
        <a href="{% url 'mis_torneos' %}" class="bg-blue-600 text-white px-4 py-2 rounded-md font-bold hover:bg-blue-700">
            &larr; Volver a Mis Torneos
        </a>
    </div>

    <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
        <table class="w-full text-left text-sm">
            <thead class="bg-slate-100 text-slate-600 uppercase font-bold">
                <tr>
                    <th class="px-4 py-3">Partido (API)</th>
                    <th class="px-4 py-3">Resultado</th>
                    <th class="px-4 py-3">Estado</th>
                    <th class="px-4 py-3">Acci√≥n en DB</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for item in reporte %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 font-medium">{{ item.partido }}</td>
                    <td class="px-4 py-3 font-mono bg-gray-50 text-center font-bold">{{ item.resultado }}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-bold
                            {% if item.estado == 'FINISHED' %}bg-green-100 text-green-800
                            {% elif item.estado == 'IN_PLAY' %}bg-red-100 text-red-800 animate-pulse
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ item.estado }}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-slate-600">
                        {{ item.accion }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                        No se encontraron partidos en el rango de fechas de la API.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

==================================================
ARCHIVO: .\core\templates\core\base.html
==================================================
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prode Mundial - {{ competencia_activa.name|default:"General" }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        body { min-height: 100vh; background-color: #f8fafc; position: relative; }
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none;
            background: repeating-linear-gradient(45deg, transparent, transparent 10px, #cbd5e1 10px, #cbd5e1 11px);
            opacity: 0.3;
        }
    </style>
</head> 

<body class="flex flex-col min-h-screen">

    <nav class="bg-slate-900 text-white shadow-lg z-50 relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                
                <div class="flex items-center space-x-6">
                    <a href="{% url 'home' %}" class="flex items-center space-x-2 text-xl font-bold text-yellow-400 hover:text-yellow-300 transition">
                        <span>‚öΩ</span>
                        <span class="hidden md:inline">PRODE</span>
                    </a>

                    <div x-data="{ open: false }" class="relative">
                        <button @click="open = !open" @click.outside="open = false" class="flex items-center space-x-2 bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-full transition border border-slate-700">
                            {% if competencia_activa %}
                                <span class="font-bold text-sm uppercase tracking-wide">{{ competencia_activa.name }}</span>
                            {% else %}
                                <span class="font-bold text-sm text-red-400">Seleccionar Liga</span>
                            {% endif %}
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>

                        <div x-show="open" 
                             x-transition:enter="transition ease-out duration-100"
                             x-transition:enter-start="transform opacity-0 scale-95"
                             x-transition:enter-end="transform opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-75"
                             x-transition:leave-start="transform opacity-100 scale-100"
                             x-transition:leave-end="transform opacity-0 scale-95"
                             class="absolute left-0 mt-2 w-56 bg-white rounded-md shadow-xl py-2 z-50 text-slate-800 border border-gray-100"
                             style="display: none;">
                            
                            <div class="px-4 py-2 text-xs font-bold text-gray-400 uppercase">Cambiar Competici√≥n</div>
                            
                            {% for comp in lista_competencias %}
                            <a href="{% url 'cambiar_competencia' comp.id %}" 
                               class="block px-4 py-2 text-sm hover:bg-yellow-50 hover:text-yellow-700 flex justify-between items-center group
                               {% if comp.id == competencia_activa.id %}bg-slate-50 font-bold text-blue-600{% endif %}">
                                <span>{{ comp.name }}</span>
                                {% if comp.id == competencia_activa.id %}
                                    <span class="text-blue-500">‚óè</span>
                                {% endif %}
                            </a>
                            {% empty %}
                                <span class="block px-4 py-2 text-sm text-gray-400">No hay ligas cargadas</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    
                    {% if user.is_staff %}
                        <a href="{% url 'actualizar_web' %}" class="text-gray-400 hover:text-white p-2 rounded-full hover:bg-slate-800 transition" title="Actualizar API">
                            üîÑ
                        </a>
                    {% endif %}

                    {% if user.is_authenticated %}
                        
                        <div x-data="{ userMenu: false }" class="relative ml-3">
                            <div>
                                <button @click="userMenu = !userMenu" @click.outside="userMenu = false" 
                                        class="flex items-center gap-2 max-w-xs bg-slate-800 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-blue-500 p-1 pr-3 hover:bg-slate-700 transition" 
                                        id="user-menu-button" aria-expanded="false" aria-haspopup="true">
                                    
                                    <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-xs font-bold text-white border-2 border-slate-800 shadow-sm">
                                        {{ user.username|slice:":2"|upper }}
                                    </div>
                                    
                                    <span class="text-sm font-medium text-gray-300 hidden md:block">{{ user.username }}</span>
                                    
                                    <svg class="h-4 w-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>

                            <div x-show="userMenu" 
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="transform opacity-0 scale-95"
                                 x-transition:enter-end="transform opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="transform opacity-100 scale-100"
                                 x-transition:leave-end="transform opacity-0 scale-95"
                                 class="origin-top-right absolute right-0 mt-2 w-56 rounded-xl shadow-2xl py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50"
                                 style="display: none;">
                                
                                <div class="px-4 py-3 border-b border-gray-100 bg-gray-50 rounded-t-xl">
                                    <p class="text-xs text-gray-500 uppercase font-bold tracking-wider">Conectado como</p>
                                    <p class="text-sm font-bold text-slate-900 truncate">{{ user.email|default:user.username }}</p>
                                </div>

                                <div class="py-1">
                                    <a href="{% url 'perfil' %}" class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700">
                                        
                                        <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                        Mi Perfil
                                    </a>
                                    
                                    <a href="{% url 'mis_torneos' %}" class="group flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700">

                                        <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                                        </svg>
                                        Mis Torneos
                                    </a>
                                </div>

                                <div class="border-t border-gray-100 py-1">
                                    <form action="{% url 'account_logout' %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="w-full text-left group flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                            
                                            <svg class="mr-3 h-5 w-5 text-red-400 group-hover:text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                            </svg>
                                            Cerrar Sesi√≥n
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                    {% else %}
                        <div class="flex items-center space-x-2">
                            <a href="{% url 'account_login' %}" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition">Ingresar</a>
                            <a href="{% url 'account_signup' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-bold transition shadow-lg shadow-blue-900/50">Registrarse</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm relative group">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative">
            
            <div class="absolute right-0 top-0 bottom-0 w-12 bg-gradient-to-l from-white to-transparent pointer-events-none md:hidden z-10"></div>

            <nav class="flex space-x-5 md:space-x-8 overflow-x-auto no-scrollbar py-1" aria-label="Tabs">
                
                <a href="{% url 'home' %}" 
                   class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition flex-shrink-0
                   {% if request.resolver_match.url_name == 'home' or request.resolver_match.url_name == 'predecir' %}
                       border-blue-500 text-blue-600
                   {% else %}
                       border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üìù Pron√≥sticos
                </a>

                <a href="{% url 'mis_torneos' %}" 
                   class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition flex-shrink-0
                   {% if 'torneo' in request.resolver_match.url_name %}
                       border-blue-500 text-blue-600
                   {% else %}
                       border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üèÜ Torneos </a>

                <a href="{% url 'fixture' %}" 
                   class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition flex-shrink-0
                   {% if request.resolver_match.url_name == 'fixture' %}
                       border-blue-500 text-blue-600
                   {% else %}
                       border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üìÖ Fixture
                </a>

                <a href="{% url 'tabla' %}" 
                   class="whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition flex-shrink-0
                   {% if request.resolver_match.url_name == 'tabla' %}
                       border-blue-500 text-blue-600
                   {% else %}
                       border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üìä {% if competencia_activa.type == 'CUP' %}Grupos{% else %}Tabla{% endif %}
                </a>

            </nav>
        </div>
    </div>

    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% if messages %}
            <div class="max-w-4xl mx-auto mb-6">
                {% for message in messages %}
                    <div class="p-4 rounded-md shadow-sm border mb-2 text-sm font-medium
                        {% if message.tags == 'error' %}bg-red-50 text-red-700 border-red-200
                        {% elif message.tags == 'success' %}bg-green-50 text-green-700 border-green-200
                        {% else %}bg-blue-50 text-blue-700 border-blue-200{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-slate-900 text-gray-500 py-6 mt-auto border-t border-slate-800">
        <div class="max-w-7xl mx-auto px-4 text-center text-xs">
            <p>&copy; 2026 Prode System - Desarrollado por Facundo</p>
        </div>
    </footer>

</body>
</html>
==================================================
ARCHIVO: .\core\templates\core\buscar_torneo.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto min-h-[60vh]">

    <div class="mb-6">
        <a href="{% url 'mis_torneos' %}" class="text-gray-500 hover:text-gray-900 flex items-center mb-4">
            &larr; Volver a Mis Torneos
        </a>
        <h1 class="text-3xl font-bold text-slate-800">üîç Buscar Torneo</h1>
        <p class="text-gray-600">Ingresa el nombre del torneo o el c√≥digo de invitaci√≥n.</p>
    </div>

    <form method="get" class="mb-8 relative">
        <input type="text" name="q" value="{{ query|default:'' }}" 
               class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
               placeholder="Ej: Mundial Amigos o C√≥digo X7Z9...">
        <span class="absolute left-3 top-3.5 text-gray-400 text-xl">üîé</span>
        <button type="submit" class="absolute right-2 top-2 bg-blue-600 text-white px-4 py-1.5 rounded-md font-bold hover:bg-blue-700">
            Buscar
        </button>
    </form>

    {% if query %}
        <h2 class="text-xl font-bold text-gray-700 mb-4">Resultados para "{{ query }}"</h2>
        
        {% if resultados %}
            <div class="space-y-4">
                {% for torneo in resultados %}
                <div class="bg-white p-4 rounded-lg shadow border border-gray-200 flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        {% if torneo.image %}
                            <img src="{{ torneo.image }}" class="w-10 h-10 rounded-full object-cover">
                        {% else %}
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-lg">üèÜ</div>
                        {% endif %}
                        <div>
                            <h3 class="font-bold text-lg">{{ torneo.name }}</h3>
                            <p class="text-xs text-gray-500">Creado por {{ torneo.creator.username }}</p>
                        </div>
                    </div>

                    <a href="{% url 'unirse_torneo' torneo.id %}" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md font-bold text-sm transition">
                        Unirse
                    </a>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 text-yellow-700">
                <p>No se encontraron torneos. Verifica el c√≥digo o el nombre.</p>
            </div>
        {% endif %}

    {% else %}
        <div class="text-center text-gray-400 mt-12">
            <p>Escribe algo arriba para empezar a buscar.</p>
        </div>
    {% endif %}

</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\crear_torneo.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-md mx-auto bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden mt-10">
    <div class="bg-slate-900 px-6 py-4">
        <h2 class="text-xl font-bold text-white">Crear Nuevo Torneo</h2>
        <p class="text-slate-400 text-xs">En {{ competencia.name }}</p>
    </div>
    
    <form method="post" class="p-6 space-y-4">
        {% csrf_token %}
        
        <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Nombre del Torneo</label>
            <input type="text" name="name" required 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500"
                placeholder="Ej: La Copa de los Amigos">
        </div>

        {% if form.image %}
        <div>
            <label class="block text-sm font-bold text-gray-700 mb-2">Imagen (URL)</label>
            <input type="url" name="image" 
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-slate-500 focus:border-slate-500"
                placeholder="https://...">
        </div>
        {% endif %}

        <div class="flex gap-3 pt-4">
            <a href="{% url 'mis_torneos' %}" class="flex-1 text-center py-2 px-4 border border-gray-300 rounded-lg text-gray-700 font-bold hover:bg-gray-50">Cancelar</a>
            <button type="submit" class="flex-1 bg-slate-900 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-800 shadow-lg">Crear Torneo</button>
        </div>
    </form>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\detalle_torneo.html
==================================================
{% extends 'core/base.html' %}

{% block content %}

<div class="max-w-4xl mx-auto">
    
    <div class="mb-8 flex flex-col md:flex-row items-center justify-between gap-4">
        <div>
            <div class="flex items-center gap-2 mb-1">
                <a href="{% url 'mis_torneos' %}" class="text-gray-400 hover:text-slate-900 transition">
                    ‚Üê Volver
                </a>
                <span class="text-gray-300">|</span>
                <span class="text-slate-500 font-bold text-sm tracking-widest uppercase">Tabla de Posiciones</span>
            </div>
            <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">{{ torneo.name }}</h1>
        </div>
        
        <div class="bg-white p-3 rounded-xl border border-gray-200 shadow-sm text-center">
            <p class="text-[10px] text-gray-400 font-bold uppercase mb-1">C√≥digo de Invitaci√≥n</p>
            <code class="text-xl font-mono font-bold text-slate-700 tracking-widest">{{ torneo.code }}</code>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-slate-50 border-b border-gray-200 text-xs uppercase text-gray-500 font-bold tracking-wider">
                    <th class="p-4 w-16 text-center">#</th>
                    <th class="p-4">Usuario</th>
                    <th class="p-4 text-right">Puntos</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for miembro in ranking %}
                <tr class="hover:bg-slate-50 transition {% if miembro.user == request.user %}bg-blue-50/50{% endif %}">
                    
                    <td class="p-4 text-center">
                        {% if forloop.counter == 1 %}
                            <span class="text-2xl">ü•á</span>
                        {% elif forloop.counter == 2 %}
                            <span class="text-2xl">ü•à</span>
                        {% elif forloop.counter == 3 %}
                            <span class="text-2xl">ü•â</span>
                        {% else %}
                            <span class="font-bold text-gray-400">{{ forloop.counter }}</span>
                        {% endif %}
                    </td>
                    
                    <td class="p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-600 font-bold text-xs">
                                {{ miembro.user.username|slice:":1"|upper }}
                            </div>
                            <span class="font-bold text-slate-700 {% if miembro.user == request.user %}text-blue-700{% endif %}">
                                {{ miembro.user.username }}
                                {% if miembro.user == request.user %} (T√∫){% endif %}
                            </span>
                        </div>
                    </td>
                    
                    <td class="p-4 text-right">
                        <span class="font-mono font-bold text-xl text-slate-900">{{ miembro.points }}</span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="p-8 text-center text-gray-500">
                        A√∫n no hay participantes en este torneo.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\editar_perfil.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10">
    
    <div class="mb-6 flex items-center justify-between">
        <div>
            <h2 class="text-2xl font-bold text-slate-900">Editar Perfil</h2>
            <p class="text-gray-500 text-sm">Actualiza tu informaci√≥n personal</p>
        </div>
        <a href="{% url 'perfil' %}" class="text-gray-500 hover:text-slate-800 font-bold text-sm">Cancelar</a>
    </div>

    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        
        <form method="post" class="p-8 space-y-6">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Nombre de Usuario</label>
                    {{ form.username }}
                    <p class="text-xs text-gray-400 mt-1">Tu apodo en los rankings.</p>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Email</label>
                    {{ form.email }}
                    <p class="text-xs text-gray-400 mt-1">No se puede cambiar.</p>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Nombre</label>
                    {{ form.first_name }}
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">Apellido</label>
                    {{ form.last_name }}
                </div>
            </div>

            <div class="pt-4 border-t border-gray-100 flex justify-end">
                <button type="submit" class="bg-slate-900 text-white font-bold py-2.5 px-6 rounded-lg hover:bg-slate-800 transition shadow-lg">
                    Guardar Cambios
                </button>
            </div>
        </form>

        <div class="bg-slate-50 p-8 border-t border-gray-200">
            <h3 class="text-lg font-bold text-slate-800 mb-2">Seguridad y Acceso</h3>
            <div class="flex items-center justify-between">
                <div>
                    {% if user.has_usable_password %}
                        <p class="text-sm text-gray-600">Tienes una contrase√±a configurada.</p>
                        <p class="text-xs text-green-600 font-bold mt-1">‚úì Cuenta segura</p>
                    {% else %}
                        <p class="text-sm text-gray-600">Iniciaste sesi√≥n con Google/Social.</p>
                        <p class="text-xs text-orange-600 font-bold mt-1">‚ö† No tienes contrase√±a para login manual</p>
                    {% endif %}
                </div>
                
                <a href="{% url 'configurar_password' %}" class="bg-white border border-gray-300 text-slate-700 hover:bg-gray-50 font-bold py-2 px-4 rounded-lg shadow-sm transition text-sm">
                    {% if user.has_usable_password %}
                        Cambiar Contrase√±a
                    {% else %}
                        ‚ûï Crear Contrase√±a
                    {% endif %}
                </a>
            </div>
        </div>

    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\fixture.html
==================================================
{% extends 'core/base.html' %} 

{% block content %}

    <div class="text-center mb-6">
        <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Fixture</h1>
        <p class="text-gray-600 text-sm">Calendario de {{ competencia_activa.name }}</p>
    </div>

    <div class="max-w-4xl mx-auto mb-8 px-4 sm:px-0">
        <label for="ronda-select" class="block text-sm font-bold text-gray-700 mb-2">Seleccionar Fecha:</label>
        <div class="relative">
            <select id="ronda-select" 
                    onchange="window.location.href='?ronda=' + this.value"
                    class="appearance-none block w-full pl-4 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-slate-500 focus:border-slate-500 sm:text-sm rounded-xl shadow-sm bg-white cursor-pointer hover:border-gray-400 transition">
                
                {% for nombre_ronda in rondas_disponibles %}
                    <option value="{{ nombre_ronda }}" {% if nombre_ronda == ronda_actual %}selected{% endif %}>
                        {{ nombre_ronda }}
                    </option>
                {% endfor %}
                
                {% if not rondas_disponibles %}
                    <option>No hay fechas disponibles</option>
                {% endif %}
            </select>
            
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto space-y-4">
        
        {% if partidos_mostrar %}
            
            {% for item in partidos_mostrar %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-4 hover:bg-gray-50 transition flex flex-col sm:flex-row items-center justify-between gap-4">
                
                <div class="text-center sm:text-left min-w-[80px]">
                    <span class="block text-xs font-bold text-gray-400 uppercase">{{ item.partido.date|date:"D d" }}</span>
                    <span class="block text-xs text-gray-400">{{ item.partido.date|date:"H:i" }}</span>
                    {% if item.partido.status == 'IN_PLAY' %}
                        <span class="text-[10px] text-red-500 font-bold animate-pulse">EN VIVO</span>
                    {% endif %}
                </div>

                <div class="flex-grow flex items-center justify-center space-x-4 w-full sm:w-auto">
                    
                    <div class="flex items-center justify-end w-1/3 space-x-2 text-right">
                        <span class="font-bold text-slate-800 text-sm md:text-base hidden md:block">{{ item.partido.home_team.name }}</span>
                        <span class="font-bold text-slate-800 text-sm md:text-base md:hidden">{{ item.partido.home_team.name|slice:":3"|upper }}</span>
                        {% if item.partido.home_team.logo %}
                            <img src="{{ item.partido.home_team.logo }}" class="w-8 h-8 object-contain">
                        {% else %}
                            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs">üè†</div>
                        {% endif %}
                    </div>

                    <div class="font-black text-xl text-slate-900 bg-slate-100 px-3 py-1 rounded min-w-[60px] text-center">
                        {% if item.partido.status == 'FINISHED' or item.partido.status == 'IN_PLAY' %}
                            {{ item.partido.home_goals }}-{{ item.partido.away_goals }}
                        {% else %}
                            VS
                        {% endif %}
                    </div>

                    <div class="flex items-center justify-start w-1/3 space-x-2 text-left">
                        {% if item.partido.away_team.logo %}
                            <img src="{{ item.partido.away_team.logo }}" class="w-8 h-8 object-contain">
                        {% else %}
                            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs">‚úàÔ∏è</div>
                        {% endif %}
                        <span class="font-bold text-slate-800 text-sm md:text-base hidden md:block">{{ item.partido.away_team.name }}</span>
                        <span class="font-bold text-slate-800 text-sm md:text-base md:hidden">{{ item.partido.away_team.name|slice:":3"|upper }}</span>
                    </div>
                </div>

                <div class="w-full sm:w-auto min-w-[140px] text-center">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">
                        {% if item.partido.status == 'FINISHED' %}
                            Finalizado
                        {% elif item.partido.status == 'IN_PLAY' %}
                            Jugando
                        {% else %}
                            Pendiente
                        {% endif %}
                    </span>
                </div>

            </div>
            {% endfor %}

        {% else %}
            <div class="text-center py-16 bg-white rounded-xl border border-dashed border-gray-300">
                <p class="text-gray-500 text-lg font-medium">No hay partidos para esta fecha.</p>
            </div>
        {% endif %}
    </div>

{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\gestionar_torneo.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">
    
    <div class="mb-8 flex justify-between items-center">
        <div>
            <a href="{% url 'mis_torneos' %}" class="text-gray-500 hover:text-slate-800 text-sm font-bold mb-2 block">&larr; Volver</a>
            <h1 class="text-3xl font-bold text-slate-800">‚öôÔ∏è Gestionar: {{ torneo.name }}</h1>
            <p class="text-gray-500">C√≥digo de invitaci√≥n: <span class="font-mono bg-yellow-100 px-2 py-1 rounded font-bold text-slate-800 select-all">{{ torneo.code }}</span></p>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-md border border-orange-200 mb-8 overflow-hidden">
        <div class="bg-orange-50 px-6 py-4 border-b border-orange-100 flex justify-between items-center">
            <h2 class="text-lg font-bold text-orange-800">‚è≥ Solicitudes Pendientes</h2>
            <span class="bg-orange-200 text-orange-800 text-xs font-bold px-2 py-1 rounded-full">{{ pendientes.count }}</span>
        </div>

        {% if pendientes %}
            <ul class="divide-y divide-gray-100">
                {% for solicitud in pendientes %}
                <li class="px-6 py-4 flex items-center justify-between hover:bg-orange-50/30 transition">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-600 mr-3">
                            {{ solicitud.user.username|slice:":1"|upper }}
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">{{ solicitud.user.username }}</p>
                            <p class="text-xs text-gray-500">{{ solicitud.user.email }}</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <a href="{% url 'responder_solicitud' solicitud.id 'rechazar' %}" 
                           class="bg-white border border-red-200 text-red-600 hover:bg-red-50 px-3 py-1.5 rounded-md text-sm font-bold transition">
                            Rechazar
                        </a>
                        <a href="{% url 'responder_solicitud' solicitud.id 'aceptar' %}" 
                           class="bg-green-500 text-white hover:bg-green-600 px-3 py-1.5 rounded-md text-sm font-bold shadow-sm transition">
                            ‚úÖ Aceptar
                        </a>
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="p-8 text-center text-gray-400">
                <p>No hay solicitudes pendientes por ahora.</p>
            </div>
        {% endif %}
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-100">
            <h2 class="text-lg font-bold text-slate-700">üë• Participantes Activos ({{ aceptados.count }})</h2>
        </div>
        <div class="p-6">
            <div class="flex flex-wrap gap-2">
                {% for miembro in aceptados %}
                    <div class="inline-flex items-center bg-gray-100 px-3 py-1 rounded-full border border-gray-200">
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                        <span class="text-sm font-medium text-gray-700">
                            {{ miembro.user.username }} 
                            {% if miembro.user == torneo.creator %}<span class="text-xs text-blue-500 font-bold ml-1">(Admin)</span>{% endif %}
                        </span>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

</div>
<div class="mt-12 border-t-2 border-red-100 pt-8">
        <div class="bg-red-50 p-6 rounded-lg border border-red-200 flex justify-between items-center">
            <div>
                <h3 class="text-lg font-bold text-red-800">Zona de Peligro</h3>
                <p class="text-sm text-red-600">Esta acci√≥n no se puede deshacer. Se borrar√° el torneo y todos los puntajes asociados.</p>
            </div>
            
            <button onclick="confirmarEliminacion()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded shadow transition">
                üóëÔ∏è Eliminar Torneo
            </button>
        </div>
    </div>

    <script>
        function confirmarEliminacion() {
            if (confirm('¬øEst√°s SEGURO de que quieres eliminar este torneo?\n\nEsta acci√≥n es irreversible.')) {
                window.location.href = "{% url 'eliminar_torneo' torneo.id %}";
            }
        }
    </script>

</div> 
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\home.html
==================================================
{% extends 'core/base.html' %} 

{% block content %}

    <div class="text-center mb-6">
        <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Pron√≥sticos</h1>
        <p class="text-gray-600 text-sm">Juega fecha a fecha en {{ competencia_activa.name }}</p>
    </div>

    <div class="max-w-4xl mx-auto mb-8 px-4 sm:px-0">
        <label for="ronda-select" class="block text-sm font-bold text-gray-700 mb-2">Seleccionar Fecha:</label>
        <div class="relative">
            <select id="ronda-select" 
                    onchange="window.location.href='?ronda=' + this.value"
                    class="appearance-none block w-full pl-4 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-slate-500 focus:border-slate-500 sm:text-sm rounded-xl shadow-sm bg-white cursor-pointer hover:border-gray-400 transition">
                
                {% for nombre_ronda in rondas_disponibles %}
                    <option value="{{ nombre_ronda }}" {% if nombre_ronda == ronda_actual %}selected{% endif %}>
                        {{ nombre_ronda }}
                    </option>
                {% endfor %}
                
                {% if not rondas_disponibles %}
                    <option>No hay fechas disponibles</option>
                {% endif %}
            </select>
            
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </div>
        </div>
    </div>

    <div class="max-w-4xl mx-auto space-y-4">
        
        {% if partidos_mostrar %}
            
            {% for item in partidos_mostrar %}
            <div id="match-{{ item.partido.id }}" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-4 hover:bg-gray-50 transition flex flex-col sm:flex-row items-center justify-between gap-4">
                
                <div class="text-center sm:text-left min-w-[80px]">
                    <span class="block text-xs font-bold text-gray-400 uppercase">{{ item.partido.date|date:"D d" }}</span>
                    <span class="block text-xs text-gray-400">{{ item.partido.date|date:"H:i" }}</span>
                    {% if item.partido.status == 'IN_PLAY' %}
                        <span class="text-[10px] text-red-500 font-bold animate-pulse">EN VIVO</span>
                    {% endif %}
                </div>

                <div class="flex-grow flex items-center justify-center space-x-4 w-full sm:w-auto">
                    
                    <div class="flex items-center justify-end w-1/3 space-x-2 text-right">
                        <span class="font-bold text-slate-800 text-sm md:text-base hidden md:block">{{ item.partido.home_team.name }}</span>
                        <span class="font-bold text-slate-800 text-sm md:text-base md:hidden">{{ item.partido.home_team.name|slice:":3"|upper }}</span>
                        {% if item.partido.home_team.logo %}
                            <img src="{{ item.partido.home_team.logo }}" class="w-8 h-8 object-contain">
                        {% else %}
                            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs">üè†</div>
                        {% endif %}
                    </div>

                    <div class="font-black text-xl text-slate-900 bg-slate-100 px-3 py-1 rounded min-w-[60px] text-center">
                        {% if item.partido.status == 'FINISHED' or item.partido.status == 'IN_PLAY' %}
                            {{ item.partido.home_goals }}-{{ item.partido.away_goals }}
                        {% else %}
                            VS
                        {% endif %}
                    </div>

                    <div class="flex items-center justify-start w-1/3 space-x-2 text-left">
                        {% if item.partido.away_team.logo %}
                            <img src="{{ item.partido.away_team.logo }}" class="w-8 h-8 object-contain">
                        {% else %}
                            <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs">‚úàÔ∏è</div>
                        {% endif %}
                        <span class="font-bold text-slate-800 text-sm md:text-base hidden md:block">{{ item.partido.away_team.name }}</span>
                        <span class="font-bold text-slate-800 text-sm md:text-base md:hidden">{{ item.partido.away_team.name|slice:":3"|upper }}</span>
                    </div>
                </div>

                <div class="w-full sm:w-auto min-w-[140px]">
                    {% if item.partido.status == 'FINISHED' %}
                        <div class="text-center bg-gray-50 p-2 rounded border border-gray-200">
                            <span class="text-[10px] font-bold text-gray-500 uppercase block mb-1">Tu Predicci√≥n</span>
                            <span class="font-mono font-bold text-lg text-slate-800 block">
                                {% if item.prediccion %}
                                    {{ item.prediccion.predicted_home }} - {{ item.prediccion.predicted_away }}
                                {% else %}
                                    -
                                {% endif %}
                            </span>

                            <div class="mt-1 border-t border-gray-200 pt-1">
                                {% if item.prediccion %}
                                    {% if item.prediccion.points > 0 %}
                                        <span class="text-xs font-bold text-green-600 bg-green-100 px-2 py-0.5 rounded-full">
                                            +{{ item.prediccion.points }} pts
                                        </span>
                                    {% else %}
                                        <span class="text-xs font-bold text-gray-400">
                                            ptos: {{ item.prediccion.points }}
                                        </span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-xs font-bold text-gray-400">
                                        ptos: 0
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        {% if item.prediccion %}
                            <a href="{% url 'predecir' item.partido.id %}" class="block w-full text-center bg-white border border-slate-300 text-slate-600 hover:bg-slate-50 font-bold py-2 px-4 rounded-lg text-sm transition">
                                ‚úèÔ∏è {{ item.prediccion.predicted_home }}-{{ item.prediccion.predicted_away }}
                            </a>
                        {% else %}
                            <a href="{% url 'predecir' item.partido.id %}" class="block w-full text-center bg-slate-900 hover:bg-slate-800 text-white font-bold py-2 px-4 rounded-lg text-sm shadow transition">
                                Jugar
                            </a>
                        {% endif %}
                    {% endif %}
                </div>

            </div>
            {% endfor %}

        {% else %}
            <div class="text-center py-16 bg-white rounded-xl border border-dashed border-gray-300">
                <p class="text-gray-500 text-lg font-medium">No hay partidos para esta fecha.</p>
                <p class="text-sm text-gray-400 mt-1">Intenta seleccionar otra en el men√∫.</p>
            </div>
        {% endif %}
    </div>

    <script>
        (function() {
            if (window.location.hash) {
                var id = window.location.hash.substring(1);
                var element = document.getElementById(id);
                if (element) {
                    window.scrollTo({
                        top: element.offsetTop - 100, 
                        behavior: 'instant' 
                    });
                }
            }
        })();
    </script>

{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\mis_torneos.html
==================================================
{% extends 'core/base.html' %}

{% block content %}

    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
        <div class="text-center md:text-left">
            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Mis Torneos</h1>
            <p class="text-gray-600 text-sm">Gestiona tus ligas y compite con amigos</p>
        </div>
        
        <div class="flex gap-3">
            <a href="{% url 'unirse_por_codigo' %}" class="flex items-center gap-2 bg-white border border-gray-300 text-slate-700 hover:bg-gray-50 font-bold py-2 px-4 rounded-xl shadow-sm transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M8 9a3 3 0 100-6 3 3 0 000 6zM8 11a6 6 0 016 6H2a6 6 0 016-6zM16 7a1 1 0 10-2 0v1h-1a1 1 0 100 2h1v1a1 1 0 102 0v-1h1a1 1 0 100-2h-1V7z" />
                </svg>
                Unirse
            </a>
            
            <a href="{% url 'crear_torneo' %}" class="flex items-center gap-2 bg-slate-900 hover:bg-slate-800 text-white font-bold py-2 px-4 rounded-xl shadow-lg transition transform hover:-translate-y-0.5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                Crear Nuevo
            </a>
        </div>
    </div>

    {% if pendientes %}
    <div class="mb-8">
        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Solicitudes Pendientes</h3>
        <div class="space-y-3">
            {% for item in pendientes %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-yellow-200 text-yellow-700 p-2 rounded-full">
                        ‚è≥
                    </div>
                    <div>
                        <h4 class="font-bold text-yellow-900">{{ item.tournament.name }}</h4>
                        <p class="text-xs text-yellow-700">Esperando aprobaci√≥n del administrador</p>
                    </div>
                </div>
                <span class="text-xs font-mono bg-white px-2 py-1 rounded border border-yellow-200 text-yellow-600">PENDIENTE</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if mis_torneos %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for item in mis_torneos %}
            
            <div class="group bg-white rounded-2xl shadow-sm border border-gray-200 hover:shadow-md transition duration-300 flex flex-col overflow-hidden relative">
                
                <div class="h-2 w-full bg-gradient-to-r from-slate-700 to-slate-900 group-hover:from-blue-600 group-hover:to-blue-800 transition-all"></div>

                <div class="p-6 flex-grow flex flex-col">
                    
                    <div class="flex items-start justify-between mb-4">
                        <div class="bg-slate-100 p-3 rounded-xl">
                            {% if item.tournament.image %}
                                <img src="{{ item.tournament.image }}" class="w-8 h-8 object-cover rounded-full">
                            {% else %}
                                <span class="text-2xl">üèÜ</span>
                            {% endif %}
                        </div>
                        
                        {% if item.tournament.creator == request.user %}
                            <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded-full border border-blue-200">ADMIN</span>
                        {% else %}
                            <span class="bg-gray-100 text-gray-600 text-[10px] font-bold px-2 py-1 rounded-full border border-gray-200">JUGADOR</span>
                        {% endif %}
                    </div>

                    <h2 class="text-xl font-bold text-slate-800 mb-1 leading-tight">{{ item.tournament.name }}</h2>
                    <p class="text-xs text-gray-500 mb-6">Creado por {{ item.tournament.creator.username }}</p>

                    <div class="flex items-center gap-4 mb-6 text-sm text-gray-600 bg-slate-50 p-3 rounded-lg border border-slate-100">
                        <div class="flex-1 text-center border-r border-gray-200">
                            <span class="block font-bold text-slate-900 text-lg">{{ item.points }}</span>
                            <span class="text-[10px] uppercase">Puntos</span>
                        </div>
                        <div class="flex-1 text-center">
                            <span class="block font-bold text-slate-900 text-lg">#{{ item.id }}</span> <span class="text-[10px] uppercase">Ranking</span>
                        </div>
                    </div>

                    {% if item.tournament.creator == request.user %}
                    <div class="mt-auto mb-4">
                        <p class="text-[10px] text-gray-400 font-bold uppercase mb-1">C√≥digo de invitaci√≥n:</p>
                        <div class="flex items-center gap-2 bg-gray-50 border border-dashed border-gray-300 rounded p-2 cursor-pointer hover:bg-gray-100 transition" onclick="navigator.clipboard.writeText('{{ item.tournament.code }}'); alert('C√≥digo copiado: {{ item.tournament.code }}')">
                            <code class="text-sm font-mono font-bold text-slate-700 flex-grow text-center tracking-widest">{{ item.tournament.code }}</code>
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        </div>
                    </div>
                    {% else %}
                    <div class="mt-auto"></div>
                    {% endif %}

                    <a href="{% url 'detalle_torneo' item.tournament.id %}" class="block w-full text-center bg-white border-2 border-slate-900 text-slate-900 hover:bg-slate-900 hover:text-white font-bold py-2.5 rounded-xl transition-colors duration-200">
                        Ver Tabla
                    </a>

                </div>
            </div>
            {% endfor %}
        </div>

    {% else %}
        <div class="text-center py-20 bg-white rounded-3xl border-2 border-dashed border-gray-200">
            <div class="mb-4 text-6xl opacity-20">‚öΩ</div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">A√∫n no tienes torneos</h3>
            <p class="text-gray-500 max-w-sm mx-auto mb-8">√önete a una liga existente con un c√≥digo o crea la tuya propia para desafiar a tus amigos.</p>
            <div class="flex justify-center gap-4">
                <a href="{% url 'crear_torneo' %}" class="bg-slate-900 text-white font-bold py-2 px-6 rounded-xl hover:bg-slate-800 transition">Crear Torneo</a>
            </div>
        </div>
    {% endif %}

{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\password.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-md mx-auto mt-12">
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-slate-900 px-6 py-4">
            <h2 class="text-xl font-bold text-white">{{ titulo }}</h2>
        </div>

        <form method="post" class="p-6 space-y-4">
            {% csrf_token %}
            
            {% for field in form %}
            <div>
                <label class="block text-sm font-bold text-gray-700 mb-1">{{ field.label }}</label>
                <div class="django-password-input">
                    {{ field }}
                </div>
                {% if field.help_text %}
                    <p class="text-xs text-gray-400 mt-1">{{ field.help_text }}</p>
                {% endif %}
                {% if field.errors %}
                    <p class="text-xs text-red-500 font-bold mt-1">{{ field.errors.0 }}</p>
                {% endif %}
            </div>
            {% endfor %}

            <div class="pt-4 flex gap-3">
                <a href="{% url 'editar_perfil' %}" class="flex-1 text-center py-2 px-4 border border-gray-300 rounded-lg text-gray-700 font-bold hover:bg-gray-50">Cancelar</a>
                <button type="submit" class="flex-1 bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 shadow-md">
                    Confirmar
                </button>
            </div>
        </form>
    </div>
    
    <style>
        .django-password-input input {
            width: 100%;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }
        .django-password-input ul { font-size: 0.75rem; color: #6b7280; list-style-type: disc; margin-left: 1rem; }
    </style>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\perfil.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-5xl mx-auto">
    
    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8 mb-8 flex flex-col md:flex-row items-center gap-8">
        <div class="w-24 h-24 rounded-full bg-slate-900 text-white flex items-center justify-center text-3xl font-bold shadow-xl border-4 border-slate-100">
            {{ user.username|slice:":2"|upper }}
        </div>
        
        <div class="text-center md:text-left flex-grow">
            <h1 class="text-3xl font-extrabold text-slate-900 mb-1">{{ user.username }}</h1>
            <p class="text-gray-500 flex items-center justify-center md:justify-start gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                </svg>
                {{ user.email }}
            </p>
            <div class="mt-4 flex flex-wrap justify-center md:justify-start gap-3">
                <span class="bg-slate-100 text-slate-700 px-3 py-1 rounded-full text-xs font-bold border border-slate-200">
                    üìÖ Miembro desde {{ user.date_joined|date:"M Y" }}
                </span>
                <span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-100">
                    ‚öΩ Fan√°tico del F√∫tbol
                </span>
            </div>
        </div>

        <a href="{% url 'editar_perfil' %}" class="bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 font-bold py-2 px-4 rounded-lg shadow-sm transition inline-flex items-center gap-2">
            ‚öôÔ∏è Editar Datos
        </a>
    </div>

    <h2 class="text-xl font-bold text-slate-900 mb-4">Estad√≠sticas de Carrera</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
        
        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group hover:border-blue-300 transition">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-600" viewBox="0 0 20 20" fill="currentColor"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" /></svg>
            </div>
            <p class="text-sm text-gray-500 font-bold uppercase tracking-wider">Puntos Totales</p>
            <p class="text-4xl font-extrabold text-slate-900 mt-2">{{ total_puntos }}</p>
        </div>

        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group hover:border-green-300 transition">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
            </div>
            <p class="text-sm text-gray-500 font-bold uppercase tracking-wider">Efectividad</p>
            <div class="flex items-end gap-2">
                <p class="text-4xl font-extrabold text-green-600 mt-2">{{ efectividad }}%</p>
                <span class="text-xs text-gray-400 mb-1 font-bold">de acierto</span>
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group hover:border-purple-300 transition">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-purple-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
            </div>
            <p class="text-sm text-gray-500 font-bold uppercase tracking-wider">Plenos (3 Pts)</p>
            <p class="text-4xl font-extrabold text-purple-600 mt-2">{{ plenos }}</p>
            <p class="text-xs text-purple-400 font-bold mt-1">Resultados Exactos</p>
        </div>

        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative overflow-hidden group hover:border-orange-300 transition">
            <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-orange-600" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z" /><path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" /></svg>
            </div>
            <p class="text-sm text-gray-500 font-bold uppercase tracking-wider">Promedio / Partido</p>
            <p class="text-4xl font-extrabold text-orange-600 mt-2">{{ promedio }}</p>
        </div>
    </div>

    <div class="bg-slate-50 rounded-xl p-6 border border-slate-200">
        <h3 class="font-bold text-slate-700 mb-4">Desglose de Aciertos</h3>
        <div class="flex flex-col md:flex-row gap-4">
            
            <div class="flex-1">
                <div class="flex justify-between text-xs font-bold mb-1">
                    <span class="text-purple-700">Plenos (Exactos)</span>
                    <span class="text-purple-700">{{ plenos }}</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    <div class="bg-purple-500 h-2.5 rounded-full" style="width: {% widthratio plenos jugados_count 100 %}%"></div>
                </div>
            </div>

            <div class="flex-1">
                <div class="flex justify-between text-xs font-bold mb-1">
                    <span class="text-blue-700">Tendencias (Ganador)</span>
                    <span class="text-blue-700">{{ tendencias }}</span>
                </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    <div class="bg-blue-500 h-2.5 rounded-full" style="width: {% widthratio tendencias jugados_count 100 %}%"></div>
                </div>
            </div>

            <div class="flex-1">
                <div class="flex justify-between text-xs font-bold mb-1">
                    <span class="text-red-700">Fallos (0 Pts)</span>
                    <span class="text-red-700">{{ fallos }}</span> # Corregido: Variable fallos
                </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    {% if jugados_count > 0 %}
                    <div class="bg-red-400 h-2.5 rounded-full" style="width: {% widthratio fallos jugados_count 100 %}%"></div>
                    {% else %}
                    <div class="bg-red-400 h-2.5 rounded-full" style="width: 0%"></div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\prediccion.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-xl mx-auto mt-10">
    
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
        
        <div class="bg-slate-900 text-white text-center py-6">
            <h2 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Mundial 2026</h2>
            <div class="flex justify-center items-center space-x-4 text-2xl font-bold">
                <span>{{ partido.home_team.name }}</span>
                <span class="text-yellow-500">vs</span>
                <span>{{ partido.away_team.name }}</span>
            </div>
            <p class="text-slate-400 text-sm mt-2">üìÖ {{ partido.date|date:"l d F, H:i" }} hs</p>
        </div>

        <div class="p-8">
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="flex items-center justify-center space-x-6">
                    
                    <div class="text-center">
                        <label class="block text-sm font-bold text-gray-500 mb-1">{{ partido.home_team.flag_code|default:"üè†" }} Local</label>
                        <input type="number" name="predicted_home" min="0" max="20" required
                               value="{{ form.predicted_home.value|default_if_none:'' }}"
                               class="w-20 h-20 text-center text-4xl font-bold text-slate-900 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-4 focus:ring-yellow-200 outline-none transition">
                    </div>

                    <div class="text-4xl font-bold text-gray-300">-</div>

                    <div class="text-center">
                        <label class="block text-sm font-bold text-gray-500 mb-1">{{ partido.away_team.flag_code|default:"‚úàÔ∏è" }} Visitante</label>
                        <input type="number" name="predicted_away" min="0" max="20" required
                            value="{{ form.predicted_away.value|default_if_none:'' }}"
                            class="w-20 h-20 text-center text-4xl font-bold text-slate-900 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-4 focus:ring-yellow-200 outline-none transition">
                    </div>
                </div>

                <div class="pt-4 space-y-3">
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transform active:scale-95 transition-all text-lg flex justify-center items-center">
                        üíæ Guardar Pron√≥stico
                    </button>
                    
                    <a href="{% url 'home' %}" class="block w-full text-center text-slate-500 hover:text-slate-800 font-medium py-2">
                        Cancelar y volver
                    </a>
                </div>
            </form>
        </div>
    </div>

    <p class="text-center text-gray-400 text-xs mt-4">
        *Recuerda: Si acertas el resultado exacto sumas <strong>3 puntos</strong>.
    </p>

</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\ranking.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-3xl mx-auto">

    <div class="mb-8 text-center relative">
        <a href="{% url 'mis_torneos' %}" class="absolute left-0 top-2 text-gray-500 hover:text-slate-800 flex items-center text-sm font-bold">
            &larr; Volver a Mis Torneos
        </a>
        
        <div class="inline-block bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full font-bold mb-2 tracking-wide uppercase">
            Torneo Privado
        </div>
        
        <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">{{ titulo }}</h1>
        <p class="text-gray-500 text-sm mt-1">C√≥digo: <span class="font-mono">{{ torneo.code }}</span></p>
    </div>

    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <table class="w-full text-left">
            <thead class="bg-slate-50 text-slate-500 uppercase text-xs font-bold tracking-wider">
                <tr>
                    <th class="px-6 py-4">Pos</th>
                    <th class="px-6 py-4">Usuario</th>
                    <th class="px-6 py-4 text-right">Puntos</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for fila in ranking_data %}
                <tr class="{% if fila.es_el_usuario %}bg-yellow-50{% else %}hover:bg-gray-50 transition{% endif %}">
                    
                    <td class="px-6 py-4 font-bold text-gray-500">
                        {% if fila.posicion == 1 %}ü•á{% elif fila.posicion == 2 %}ü•à{% elif fila.posicion == 3 %}ü•â{% else %}#{{ fila.posicion }}{% endif %}
                    </td>

                    <td class="px-6 py-4 font-medium text-slate-900 flex items-center">
                        {% if fila.es_el_usuario %}
                            <span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>
                            {{ fila.usuario }} (T√∫)
                        {% else %}
                            {{ fila.usuario }}
                        {% endif %}
                    </td>

                    <td class="px-6 py-4 text-right font-bold text-lg text-slate-800">
                        {{ fila.puntos }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="px-6 py-8 text-center text-gray-400">
                        Nadie ha sumado puntos en este torneo a√∫n.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\tabla.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">

    <div class="text-center mb-8">
        <h1 class="text-3xl font-extrabold text-slate-900">Tabla de Posiciones</h1>
        <p class="text-gray-500">{{ competencia.name }}</p>
    </div>

    {% for grupo in tabla_agrupada %}
    <div class="mb-8 bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        
        <div class="bg-slate-50 px-6 py-3 border-b border-gray-200">
            <h2 class="font-bold text-slate-700">{{ grupo.nombre_grupo }}</h2>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left">
                <thead class="text-xs text-gray-500 uppercase bg-gray-50 border-b">
                    <tr>
                        <th class="px-4 py-3 text-center">Pos</th>
                        <th class="px-4 py-3">Equipo</th>
                        <th class="px-4 py-3 text-center font-bold text-black">Pts</th>
                        <th class="px-2 py-3 text-center hidden sm:table-cell">PJ</th>
                        <th class="px-2 py-3 text-center hidden md:table-cell">PG</th>
                        <th class="px-2 py-3 text-center hidden md:table-cell">PE</th>
                        <th class="px-2 py-3 text-center hidden md:table-cell">PP</th>
                        <th class="px-2 py-3 text-center hidden sm:table-cell">DG</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for stat in grupo.equipos %}
                    <tr class="hover:bg-slate-50 transition">
                        <td class="px-4 py-3 text-center font-bold 
                            {% if stat.position <= 2 %}text-green-600{% elif stat.position >= 18 %}text-red-500{% else %}text-gray-500{% endif %}">
                            {{ stat.position }}
                        </td>
                        <td class="px-4 py-3 font-medium text-slate-900 flex items-center space-x-2">
                            {% if stat.team.logo %}
                                <img src="{{ stat.team.logo }}" class="w-6 h-6 object-contain">
                            {% endif %}
                            <span>{{ stat.team.name }}</span>
                        </td>
                        <td class="px-4 py-3 text-center font-black text-slate-900 text-base bg-slate-50">
                            {{ stat.points }}
                        </td>
                        <td class="px-2 py-3 text-center hidden sm:table-cell text-gray-600">{{ stat.played }}</td>
                        <td class="px-2 py-3 text-center hidden md:table-cell text-green-600">{{ stat.won }}</td>
                        <td class="px-2 py-3 text-center hidden md:table-cell text-yellow-600">{{ stat.drawn }}</td>
                        <td class="px-2 py-3 text-center hidden md:table-cell text-red-600">{{ stat.lost }}</td>
                        <td class="px-2 py-3 text-center hidden sm:table-cell font-bold text-slate-700">
                            {% if stat.goal_diff > 0 %}+{% endif %}{{ stat.goal_diff }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% empty %}
    <div class="text-center py-12 bg-white rounded-lg border border-dashed border-gray-300">
        <p class="text-gray-500">No hay tabla de posiciones cargada.</p>
        <p class="text-sm text-gray-400">Ejecuta el script de carga de tablas.</p>
    </div>
    {% endfor %}

</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\unirse_por_codigo.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-md mx-auto mt-16 px-4">
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden text-center">
        
        <div class="bg-slate-900 py-6 px-4">
            <h2 class="text-2xl font-bold text-white tracking-tight">Unirse a un Torneo</h2>
            <p class="text-slate-400 text-sm mt-1">Ingresa el c√≥digo de invitaci√≥n</p>
        </div>

        <form method="post" class="p-8">
            {% csrf_token %}
            
            {% if messages %}
                {% for message in messages %}
                    <div class="mb-4 p-3 rounded text-sm font-bold {{ message.tags }} bg-red-100 text-red-700">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <div class="mb-6">
                <input type="text" name="codigo" required 
                    class="w-full text-center text-2xl font-mono tracking-widest uppercase border-2 border-gray-300 rounded-xl py-3 focus:ring-4 focus:ring-slate-200 focus:border-slate-900 transition outline-none placeholder-gray-300"
                    placeholder="XXXXXX" maxlength="10">
            </div>

            <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition">
                Ingresar al Torneo
            </button>
        </form>

        <div class="bg-gray-50 py-4 border-t border-gray-100">
            <a href="{% url 'mis_torneos' %}" class="text-sm text-gray-500 hover:text-slate-900 font-medium">Cancelar</a>
        </div>
    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\socialaccount\login.html
==================================================
{% extends 'core/base.html' %}
{% load i18n %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh] px-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-200 text-center">

        <div class="mb-6 flex justify-center">
        <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-12 h-12 animate-bounce" alt="Google">
        </div>

        <h2 class="text-2xl font-bold text-gray-800 mb-4">
            {% trans "Conectando con" %} {{ provider.name }}
        </h2>

        <p class="text-gray-600 mb-8 text-sm leading-relaxed">
            {% blocktrans with provider.name as provider %}
            Est√°s a punto de iniciar sesi√≥n en Prode Mundial utilizando tu cuenta de <strong>{{ provider }}</strong>. Por favor, confirma para continuar.
            {% endblocktrans %}
        </p>

        <form method="post">
            {% csrf_token %}
            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-bold text-slate-900 bg-yellow-500 hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 transition duration-200 uppercase tracking-wider">
                {% trans "Continuar" %}
            </button>
        </form>

        <p class="mt-6 text-xs text-gray-400">
            Esto solo tomar√° un segundo.
        </p>
    </div>
</div>
{% endblock %}