
==================================================
ARCHIVO: .\api_directa.py
==================================================
import requests
import json

# --- CONFIGURACI√ìN PARA API-FOOTBALL (DIRECTO) ---
# F√≠jate que la URL cambi√≥, ya no dice "rapidapi"
url = "https://v3.football.api-sports.io/fixtures"

headers = {
    'x-apisports-key': '8bfe23f584f1867b8ac0841f70d12009'
}

# Vamos a pedir los partidos de la Final del Mundo 2022 para asegurar que haya datos
# League 1 = Mundial. Season 2022.
params = {
    'date': '2025-12-14',
}

print("üì° Conectando directamente a API-Sports...")

try:
    response = requests.get(url, headers=headers, params=params)
    
    # Verificamos si la respuesta es correcta (C√≥digo 200)
    if response.status_code == 200:
        data = response.json()
        
        # Verificar si hay errores en el cuerpo de la respuesta (ej: clave inv√°lida)
        if data.get('errors'):
            print("‚ùå Error reportado por la API:")
            print(data['errors'])
        else:
            partidos = data['response']
            print(f"‚úÖ ¬°Conexi√≥n Exitosa! Se encontraron {len(partidos)} partidos.")
            
            for match in partidos:
                local = match['teams']['home']['name']
                visitante = match['teams']['away']['name']
                goles_local = match['goals']['home']
                goles_visitante = match['goals']['away']
                estado = match['fixture']['status']['long']
                
                print(f"--------------------------------")
                print(f"üèÜ {match['league']['name']} - {match['league']['round']}")
                print(f"‚öΩ {local} {goles_local} - {goles_visitante} {visitante}")
                print(f"üìä Estado: {estado}")

    else:
        print(f"‚ùå Error HTTP {response.status_code}")
        print(response.text)

except Exception as e:
    print(f"‚ùå Error de conexi√≥n: {e}")
==================================================
ARCHIVO: .\crear_contexto.py
==================================================
import os

# Extensiones que nos interesan
extensions = ['.py', '.html', '.css', '.js']
# Carpetas a ignorar (MUY IMPORTANTE para no copiar librerias basura)
ignore_dirs = ['venv', '.git', '__pycache__', '.idea', 'staticfiles']
output_file = 'PROYECTO_COMPLETO.txt'

with open(output_file, 'w', encoding='utf-8') as outfile:
    for root, dirs, files in os.walk("."):
        # Filtrar carpetas ignoradas
        dirs[:] = [d for d in dirs if d not in ignore_dirs]
        
        for file in files:
            if any(file.endswith(ext) for ext in extensions):
                path = os.path.join(root, file)
                outfile.write(f"\n{'='*50}\n")
                outfile.write(f"ARCHIVO: {path}\n")
                outfile.write(f"{'='*50}\n")
                try:
                    with open(path, 'r', encoding='utf-8') as infile:
                        outfile.write(infile.read())
                except Exception as e:
                    outfile.write(f"Error leyendo archivo: {e}\n")

print(f"Listo! Sub√≠ el archivo '{output_file}' al chat.")
==================================================
ARCHIVO: .\manage.py
==================================================
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()

==================================================
ARCHIVO: .\prueba_api.py
==================================================
import requests
import json

# 1. Configuraci√≥n
url = "https://api-football-v1.p.rapidapi.com/v3/fixtures"

# Queremos ver los partidos de HOY
# Ojo: Si hoy no hay partidos interesantes, la lista saldr√° vac√≠a.
# Puedes cambiar la fecha a un d√≠a que sepas que hubo f√∫tbol (ej: '2022-12-18' la final del mundo)
querystring = {"date": "2023-11-21"} 

headers = {
	"X-RapidAPI-Key": "57869ce1a1msh82e5d398f20ccb7p11a477jsnb1a7483a2731",
	"X-RapidAPI-Host": "api-football-v1.p.rapidapi.com"
}

print("üì° Consultando a la API...")

# 2. Hacemos el pedido (Request)
response = requests.get(url, headers=headers, params=querystring)

# 3. Analizamos la respuesta
if response.status_code == 200:
    data = response.json()
    cantidad = data['results']
    print(f"‚úÖ ¬°√âxito! Se encontraron {cantidad} partidos.")
    
    # Vamos a mostrar solo los primeros 3 para no llenar la pantalla
    # La API devuelve una lista dentro de 'response'
    for match in data['response'][:3]:
        local = match['teams']['home']['name']
        visitante = match['teams']['away']['name']
        goles_local = match['goals']['home']
        goles_visitante = match['goals']['away']
        estado = match['fixture']['status']['short'] # FT = Finalizado, NS = No Empezado
        
        print(f"--------------------------------")
        print(f"‚öΩ {local} vs {visitante}")
        print(f"üìä Estado: {estado}")
        print(f"ü•Ö Resultado: {goles_local} - {goles_visitante}")
        
else:
    print(f"‚ùå Error: {response.status_code}")
    print(response.text)
==================================================
ARCHIVO: .\ver_ligas.py
==================================================
import requests

api_token = '1988cfde850245faaaceaf5d9ff33ada' # Tu token
uri = 'https://api.football-data.org/v4/competitions'
headers = { 'X-Auth-Token': api_token }

response = requests.get(uri, headers=headers)
competitions = response.json().get('competitions', [])

print(f"{'ID':<6} | {'NOMBRE':<30} | {'PLAN'}")
print("-" * 50)

for c in competitions:
    # Solo mostramos las del plan gratuito (TIER_ONE) para que no te den error
    if c.get('plan') == 'TIER_ONE': 
        print(f"{c['id']:<6} | {c['name']:<30} | {c['plan']}")
==================================================
ARCHIVO: .\config\asgi.py
==================================================
"""
ASGI config for config project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

application = get_asgi_application()

==================================================
ARCHIVO: .\config\settings.py
==================================================
import os
import dj_database_url
"""
Django settings for config project.

Generated by 'django-admin startproject' using Django 5.2.9.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-@bxyzoskvf)@@hy*t5i9r))!ay7#2v-_*%fu)5kocqu$8%+du*'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['*']


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.sites',
    'core',
    'allauth',
    'allauth.account',
    'allauth.socialaccount',
    'allauth.socialaccount.providers.google', # Proveedor de Google
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'allauth.account.middleware.AccountMiddleware',
]

ROOT_URLCONF = 'config.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
                'core.context_processors.selector_competencias',
            ],
        },
    },
]

WSGI_APPLICATION = 'config.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

# Base de datos por defecto (Tu compu)
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

# Configuraci√≥n para Render (Si existe la variable DATABASE_URL, usa Postgres)
db_from_env = dj_database_url.config(conn_max_age=600)
DATABASES['default'].update(db_from_env)


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'es-ar' # Pone los mensajes en espa√±ol

TIME_ZONE = 'America/Argentina/Buenos_Aires' # Hora Argentina

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'
# Esto le dice a Django d√≥nde juntar los estilos antes de subir
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')

# Activar compresi√≥n de Whitenoise
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# A d√≥nde ir despu√©s de loguearse
LOGIN_REDIRECT_URL = 'home'

# A d√≥nde ir despu√©s de desloguearse
LOGOUT_REDIRECT_URL = 'home'

# --- CONFIGURACI√ìN DE ALLAUTH (A PRUEBA DE ERRORES) ---
AUTHENTICATION_BACKENDS = [
    'django.contrib.auth.backends.ModelBackend',
    'allauth.account.auth_backends.AuthenticationBackend',
]

SITE_ID = 1
LOGIN_REDIRECT_URL = '/'
LOGOUT_REDIRECT_URL = '/'

# Configuraci√≥n Cl√°sica
# 1. Permitir entrar con Email
ACCOUNT_AUTHENTICATION_METHOD = 'email' 
# 2. El email es obligatorio
ACCOUNT_EMAIL_REQUIRED = True
# 3. No verificar el email (para no trabarnos ahora)
ACCOUNT_EMAIL_VERIFICATION = 'none'
# 4. El usuario tambi√©n es obligatorio (necesitamos un nombre para la tabla de posiciones)
ACCOUNT_USERNAME_REQUIRED = True

# --- SEGURIDAD PARA RENDER ---
CSRF_TRUSTED_ORIGINS = ['https://prode-mundial-kczg.onrender.com']

# --- CONFIGURACI√ìN PARA RENDER (SOLUCI√ìN ERROR 400) ---
import os

# Si estamos en Render, forzamos HTTPS
if os.environ.get('RENDER'):
    # Le avisa a Django que est√° detr√°s de un proxy seguro
    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
    # Forza a que los links de login sean HTTPS
    ACCOUNT_DEFAULT_HTTP_PROTOCOL = 'https'
    # Seguridad extra recomendada
    SECURE_SSL_REDIRECT = True
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True
==================================================
ARCHIVO: .\config\urls.py
==================================================
"""
URL configuration for config project.

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/5.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path
from core.views import home, predecir_partido # <--- Importamos la nueva vista
from core.views import home, predecir_partido, ranking  # <--- Agregamos ranking
from django.urls import path, include # <--- Agrega include aqu√≠
from core.views import home, predecir_partido, ranking, actualizar_partidos_web, mis_torneos, buscar_torneo, unirse_torneo, gestionar_torneo, responder_solicitud, eliminar_torneo # <--- Importala
from core.views import correr_migraciones_web, cargar_fixture_inicial, cambiar_competencia, fixture, tabla_posiciones

urlpatterns = [
    path('admin/', admin.site.urls),

    # --- CAMBIO AQU√ç ---
    # Reemplazamos la l√≠nea vieja por esta nueva.
    # 'allauth.urls' maneja Login, Logout, Registro y... ¬°GOOGLE!
    path('accounts/', include('allauth.urls')),

    path('', home, name='home'),
    path('predecir/<int:match_id>/', predecir_partido, name='predecir'),
    path('ranking/<int:tournament_id>/', ranking, name='ranking_torneo'),
    path('actualizar-ahora/', actualizar_partidos_web, name='actualizar_web'),
    path('mis-torneos/', mis_torneos, name='mis_torneos'),
    path('buscar-torneo/', buscar_torneo, name='buscar_torneo'),
    path('unirse/<int:tournament_id>/', unirse_torneo, name='unirse_torneo'),
    # Panel de control del due√±o del torneo
    path('torneo/<int:tournament_id>/gestionar/', gestionar_torneo, name='gestionar_torneo'),
    
    # Acci√≥n de aceptar/rechazar (recibe el ID del MIEMBRO, no del torneo)
    path('solicitud/<int:member_id>/<str:accion>/', responder_solicitud, name='responder_solicitud'),
    path('torneo/<int:tournament_id>/eliminar/', eliminar_torneo, name='eliminar_torneo'),
    path('migrar-emergencia/', correr_migraciones_web),
    path('cargar-fixture-magico/', cargar_fixture_inicial),
    path('cambiar-liga/<int:comp_id>/', cambiar_competencia, name='cambiar_competencia'),
    path('fixture/', fixture, name='fixture'),
    path('tabla/', tabla_posiciones, name='tabla'),
]


==================================================
ARCHIVO: .\config\wsgi.py
==================================================
"""
WSGI config for config project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

application = get_wsgi_application()

==================================================
ARCHIVO: .\config\__init__.py
==================================================

==================================================
ARCHIVO: .\core\admin.py
==================================================
from django.contrib import admin
from .models import Team, Match, Prediction, Tournament, TournamentMember, Competition

# --- 1. NUEVA CONFIGURACI√ìN PARA COMPETICIONES ---
@admin.register(Competition)
class CompetitionAdmin(admin.ModelAdmin):
    list_display = ('name', 'type', 'api_id', 'slug')
    list_filter = ('type',)
    search_fields = ('name',)
    # Esto hace que el slug se escriba solo mientras escrib√≠s el nombre
    prepopulated_fields = {"slug": ("name",)} 

# --- 2. CONFIGURACI√ìN MEJORADA PARA PARTIDOS ---
@admin.register(Match)
class MatchAdmin(admin.ModelAdmin):
    # Ahora mostramos la Competici√≥n y la Ronda en la lista
    list_display = ('__str__', 'competition', 'round_name', 'date', 'status')
    list_filter = ('competition', 'status', 'date') # Filtros laterales muy √∫tiles
    search_fields = ('home_team__name', 'away_team__name')

# --- 3. CONFIGURACI√ìN MEJORADA PARA TORNEOS ---
class MemberInline(admin.TabularInline):
    model = TournamentMember
    extra = 1

@admin.register(Tournament)
class TournamentAdmin(admin.ModelAdmin):
    list_display = ('name', 'code', 'competition', 'creator', 'created_at')
    list_filter = ('competition',) # Filtro lateral para ver torneos por liga
    search_fields = ('name', 'code')
    inlines = [MemberInline]

# --- 4. RESTO DE MODELOS (Sin cambios mayores) ---
admin.site.register(Team)
admin.site.register(Prediction)

@admin.register(TournamentMember)
class TournamentMemberAdmin(admin.ModelAdmin):
    list_display = ('user', 'tournament', 'status', 'points')
    list_filter = ('status', 'tournament__competition') # Filtramos por la liga del torneo
==================================================
ARCHIVO: .\core\apps.py
==================================================
from django.apps import AppConfig


class CoreConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'core'

==================================================
ARCHIVO: .\core\context_processors.py
==================================================
from .models import Competition

def selector_competencias(request):
    # 1. Obtenemos todas las ligas para el men√∫ desplegable
    todas_comps = Competition.objects.all()
    
    # 2. Buscamos cu√°l est√° seleccionada en la sesi√≥n
    comp_id = request.session.get('competencia_id')
    
    competencia_activa = None
    if comp_id:
        competencia_activa = Competition.objects.filter(id=comp_id).first()
    
    # Si no hay ninguna seleccionada (primera vez), elegimos la primera por defecto
    if not competencia_activa and todas_comps.exists():
        competencia_activa = todas_comps.first()
        # La guardamos en sesi√≥n para la pr√≥xima
        request.session['competencia_id'] = competencia_activa.id

    return {
        'lista_competencias': todas_comps,
        'competencia_activa': competencia_activa
    }
==================================================
ARCHIVO: .\core\forms.py
==================================================
from django import forms
from .models import Prediction, Tournament, Match

class PredictionForm(forms.ModelForm):
    class Meta:
        model = Prediction
        fields = ['predicted_home', 'predicted_away']
        widgets = {
            'predicted_home': forms.NumberInput(attrs={'class': 'form-control', 'placeholder': 'Local'}),
            'predicted_away': forms.NumberInput(attrs={'class': 'form-control', 'placeholder': 'Visitante'}),
        }

class TournamentForm(forms.ModelForm):
    # Agregamos los campos para elegir inicio y fin (ChoiceField crea un dropdown)
    start_round = forms.ChoiceField(required=False, label="Desde la fecha")
    end_round = forms.ChoiceField(required=False, label="Hasta la fecha")

    class Meta:
        model = Tournament
        fields = ['name', 'image', 'start_round', 'end_round']
        widgets = {
            'name': forms.TextInput(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400',
                'placeholder': 'Ej: Copa de la Oficina'
            }),
            'image': forms.URLInput(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400',
                'placeholder': 'https://... (Opcional)'
            })
        }

    def __init__(self, *args, **kwargs):
        # Extraemos la competici√≥n que pasaremos desde la vista
        competition = kwargs.pop('competition', None)
        super().__init__(*args, **kwargs)

        if competition:
            # Buscamos todas las rondas √öNICAS de esa liga
            rondas = Match.objects.filter(competition=competition).values_list('round_name', flat=True).distinct().order_by('date')
            
            # Las convertimos en opciones para el select [(valor, texto), ...]
            # Usamos un set para evitar duplicados si las fechas no est√°n perfectamente ordenadas en DB,
            # pero lo ideal es ordenarlas. Por simplicidad ahora:
            opciones = [('', 'Torneo Completo (Todas las fechas)')] + [(r, r) for r in rondas]
            
            self.fields['start_round'].choices = opciones
            self.fields['end_round'].choices = opciones
            
            # Estilos CSS para los select
            style = 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400 bg-white'
            self.fields['start_round'].widget.attrs['class'] = style
            self.fields['end_round'].widget.attrs['class'] = style
==================================================
ARCHIVO: .\core\models.py
==================================================
from django.db import models
from django.contrib.auth.models import User
import random
import string

# --- 1. NUEVA ENTIDAD: COMPETICI√ìN (La base de la nueva arquitectura) ---
class Competition(models.Model):
    name = models.CharField(max_length=100, verbose_name="Nombre Liga/Copa") # Ej: Premier League
    slug = models.SlugField(unique=True, verbose_name="Identificador URL") # Ej: premier-league
    api_id = models.IntegerField(unique=True, verbose_name="ID en API Football") # Ej: 2021
    
    # Esto define si mostramos Tabla de Posiciones (Liga) o Grupos/Llaves (Copa)
    TYPE_CHOICES = [
        ('LEAGUE', 'Liga'), 
        ('CUP', 'Copa'),    
    ]
    type = models.CharField(max_length=10, choices=TYPE_CHOICES, default='LEAGUE')

    def __str__(self):
        return self.name

# --- 2. EQUIPOS (Sin cambios, solo mantenemos tu estructura) ---
class Team(models.Model):
    name = models.CharField(max_length=50, verbose_name="Nombre")
    flag_code = models.CharField(max_length=5, verbose_name="C√≥digo Bandera") # Ej: "ar", "br"
    logo = models.URLField(null=True, blank=True, verbose_name="Escudo URL")
    
    def __str__(self):
        return self.name

# --- 3. PARTIDOS (Ahora con Competici√≥n y Ronda) ---
class Match(models.Model):
    # Relaci√≥n nueva: Cada partido pertenece a una Liga/Copa espec√≠fica
    competition = models.ForeignKey(Competition, on_delete=models.CASCADE, related_name='matches', verbose_name="Competici√≥n")
    
    home_team = models.ForeignKey(Team, on_delete=models.CASCADE, related_name='home_matches', verbose_name="Local")
    away_team = models.ForeignKey(Team, on_delete=models.CASCADE, related_name='away_matches', verbose_name="Visitante")
    
    date = models.DateTimeField(verbose_name="Fecha del partido")
    status = models.CharField(max_length=20, default='SCHEDULED')
    
    # --- CAMPO NUEVO PARA TU FILTRO DE FECHAS ---
    # Aqu√≠ guardaremos "Regular Season - 1", "Group A - 3", "Quarter-finals", etc.
    round_name = models.CharField(max_length=50, verbose_name="Ronda / Fecha") 
    
    # Goles reales
    home_goals = models.IntegerField(null=True, blank=True, verbose_name="Goles Local")
    away_goals = models.IntegerField(null=True, blank=True, verbose_name="Goles Visitante")
    
    class Meta:
        verbose_name = "Partido"
        verbose_name_plural = "Partidos"

    def __str__(self):
        return f"[{self.competition.name}] {self.home_team} vs {self.away_team} ({self.round_name})"

# --- 4. PREDICCIONES (Tu l√≥gica original intacta) ---
class Prediction(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    match = models.ForeignKey(Match, on_delete=models.CASCADE)
    
    predicted_home = models.IntegerField(verbose_name="Predicci√≥n Local")
    predicted_away = models.IntegerField(verbose_name="Predicci√≥n Visitante")
    points = models.IntegerField(default=0) 
    
    def __str__(self):
        return f"{self.user.username}: {self.predicted_home}-{self.predicted_away}"

    def get_score(self):
        """
        Calcula los puntos ganados comparando con el resultado real del partido.
        Retorna: 3 (Exacto), 1 (Tendencia), 0 (Nada) o None (Si no se jug√≥).
        """
        if self.match.home_goals is None or self.match.away_goals is None:
            return None

        ph = self.predicted_home
        pa = self.predicted_away
        rh = self.match.home_goals
        ra = self.match.away_goals

        # 1. Exacto (3 Puntos)
        if ph == rh and pa == ra:
            return 3

        # 2. Tendencia (1 Punto)
        gana_local = (ph > pa) and (rh > ra)
        gana_visitante = (ph < pa) and (rh < ra)
        empate = (ph == pa) and (rh == ra)

        if gana_local or gana_visitante or empate:
            return 1
        
        # 3. Nada
        return 0

# --- 5. TORNEOS (Actualizado con Competici√≥n y Rango de Fechas) ---
class Tournament(models.Model):
    name = models.CharField(max_length=100, verbose_name="Nombre del Torneo")
    code = models.CharField(max_length=6, unique=True, verbose_name="C√≥digo de Invitaci√≥n")
    creator = models.ForeignKey(User, on_delete=models.CASCADE, related_name="created_tournaments")
    image = models.URLField(blank=True, null=True, verbose_name="Imagen (URL)")
    created_at = models.DateTimeField(auto_now_add=True)

    # --- NUEVOS FILTROS MAESTROS ---
    # Un torneo pertenece obligatoriamente a UNA competici√≥n (Premier, Champions, etc.)
    competition = models.ForeignKey(Competition, on_delete=models.CASCADE, verbose_name="Liga/Copa Base")
    
    # Rango de fechas (Opcional: Si se dejan vac√≠os, incluye todo el torneo)
    start_round = models.CharField(max_length=50, null=True, blank=True, verbose_name="Desde la Ronda")
    end_round = models.CharField(max_length=50, null=True, blank=True, verbose_name="Hasta la Ronda")

    members = models.ManyToManyField(User, through='TournamentMember', related_name="tournaments")

    def save(self, *args, **kwargs):
        if not self.code:
            self.code = ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))
        super().save(*args, **kwargs)

    def __str__(self):
        return f"{self.name} ({self.competition.name})"

# --- 6. MIEMBROS (Sin cambios) ---
class TournamentMember(models.Model):
    STATUS_CHOICES = [
        ('PENDING', 'Pendiente de Aprobaci√≥n'),
        ('ACCEPTED', 'Aceptado / Jugando'),
        ('REJECTED', 'Rechazado'),
    ]

    tournament = models.ForeignKey(Tournament, on_delete=models.CASCADE)
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    status = models.CharField(max_length=10, choices=STATUS_CHOICES, default='PENDING')
    joined_at = models.DateTimeField(auto_now_add=True)
    
    # Puntaje acumulado SOLO en este torneo
    points = models.IntegerField(default=0) 

    class Meta:
        unique_together = ('tournament', 'user')
        verbose_name = "Miembro de Torneo"
        verbose_name_plural = "Miembros de Torneo"

    def __str__(self):
        return f"{self.user.username} en {self.tournament.name} ({self.status})"
==================================================
ARCHIVO: .\core\tests.py
==================================================
from django.test import TestCase

# Create your tests here.

==================================================
ARCHIVO: .\core\views.py
==================================================
from django.shortcuts import render, redirect, get_object_or_404
from .models import Match, Prediction, Team, Tournament, TournamentMember, Competition
from .forms import PredictionForm
from django.contrib.auth.decorators import login_required
from django.contrib.auth.models import User
from django.utils import timezone # <--- IMPORTANTE
from django.core.management import call_command
from django.contrib.admin.views.decorators import staff_member_required
from django.http import HttpResponse
import io
from .forms import TournamentForm
from django.db.models import Q
from django.contrib import messages
from django.db.models import Sum
import requests
from datetime import timedelta
from itertools import groupby
from operator import attrgetter

def home(request):
    # 1. Traemos todos los partidos
    partidos = Match.objects.all()
    
    # 2. Preparamos un diccionario r√°pido de predicciones del usuario
    predicciones_dict = {}
    if request.user.is_authenticated:
        predicciones = Prediction.objects.filter(user=request.user)
        # Creamos un diccionario { id_partido: objeto_prediccion }
        predicciones_dict = {p.match.id: p for p in predicciones}

    # 3. Armamos la lista FINAL combinada
    lista_final = []
    for partido in partidos:
        # Buscamos si hay predicci√≥n para este partido (ser√° None si no hay)
        prediccion_usuario = predicciones_dict.get(partido.id)
        
        # Guardamos todo junto en un paquetito
        item = {
            'partido': partido,
            'prediccion': prediccion_usuario
        }
        lista_final.append(item)
            
    # Enviamos 'lista_partidos' en lugar de las dos variables sueltas
    return render(request, 'core/home.html', {'lista_partidos': lista_final})

@login_required # ¬°Ojo! Solo usuarios logueados pueden predecir
def predecir_partido(request, match_id):
    partido = get_object_or_404(Match, id=match_id)
    
    # --- NUEVA REGLA: VALIDACI√ìN DE HORARIO ---
    # Si la fecha del partido es menor a "ahora", ya empez√≥.
    if partido.date < timezone.now():
        # Opci√≥n A: Mostrar error feo
        # return HttpResponse("El partido ya empez√≥, tarde piaste.")
        
        # Opci√≥n B (Mejor): Redirigir al home y que se de cuenta solo
        return redirect('home')
    # ------------------------------------------

    prediccion_existente = Prediction.objects.filter(user=request.user, match=partido).first()

    if request.method == 'POST':
        # Si envi√≥ datos, cargamos el formulario con esos datos
        form = PredictionForm(request.POST, instance=prediccion_existente)
        if form.is_valid():
            # Guardamos pero sin enviar a la DB todav√≠a (commit=False)
            prediccion = form.save(commit=False)
            # Asignamos los datos faltantes que no vienen en el form
            prediccion.user = request.user
            prediccion.match = partido
            prediccion.save() # ¬°Ahora s√≠ guardamos!
            return redirect('home') # Lo mandamos al inicio
    else:
        # Si solo est√° visitando la p√°gina, mostramos el form (vac√≠o o con datos previos)
        form = PredictionForm(instance=prediccion_existente)

    return render(request, 'core/prediccion.html', {'form': form, 'partido': partido})
@login_required
def ranking(request, tournament_id=None):
    # 1. Si no hay ID, mandar a Mis Torneos
    if not tournament_id:
        messages.warning(request, "Debes seleccionar un torneo primero.")
        return redirect('mis_torneos')

    torneo = get_object_or_404(Tournament, id=tournament_id)
    
    # 2. Verificar si el usuario pertenece al torneo (Mirando la tabla intermedia expl√≠citamente)
    soy_miembro = TournamentMember.objects.filter(
        user=request.user, 
        tournament=torneo,
        status='ACCEPTED' # Solo dejamos pasar si est√° Aceptado
    ).exists()

    if not soy_miembro:
        # Si no es miembro aceptado, lo rebotamos
        messages.error(request, "No tienes permiso para ver este torneo o tu solicitud sigue pendiente.")
        return redirect('mis_torneos')

    # 3. Armar la Tabla de Posiciones
    ranking_data = []
    
    # Traemos a todos los miembros aceptados, ordenados por puntos (Mayor a menor)
    miembros = TournamentMember.objects.filter(
        tournament=torneo, 
        status='ACCEPTED'
    ).select_related('user').order_by('-points')

    for i, miembro in enumerate(miembros, 1):
        ranking_data.append({
            'posicion': i,
            'usuario': miembro.user.username,
            'puntos': miembro.points,
            'es_el_usuario': (miembro.user == request.user)
        })

    return render(request, 'core/ranking.html', {
        'ranking_data': ranking_data,
        'titulo': f"üèÜ {torneo.name}",
        'torneo': torneo
    })

    # 3. Ordenamos la lista de mayor a menor puntaje
    # lambda es una forma corta de decir: "ordena usando la clave 'puntos'"
    lista_ranking.sort(key=lambda x: x['puntos'], reverse=True)

    return render(request, 'core/ranking.html', {'ranking': lista_ranking})

@login_required
def actualizar_partidos_web(request):
    if not request.user.is_staff:
        messages.error(request, "Solo el administrador puede actualizar partidos.")
        return redirect('home')

    # --- TU TOKEN REAL AQU√ç ---
    API_TOKEN = '1988cfde850245faaaceaf5d9ff33ada' # <--- REVISA QUE EST√â TU TOKEN PUESTO
    # --------------------------
    
    base_url = "https://api.football-data.org/v4/matches"
    headers = {'X-Auth-Token': API_TOKEN}
    
    # Rango de fechas
    hoy = timezone.now().date()
    ayer = hoy - timedelta(days=5)
    manana = hoy + timedelta(days=5)
    
    params = {
        'dateFrom': ayer.strftime('%Y-%m-%d'),
        'dateTo': manana.strftime('%Y-%m-%d')
    }

    reporte = [] # <--- Lista para guardar lo que vemos

    try:
        response = requests.get(base_url, headers=headers, params=params)
        data = response.json()
        
        if 'matches' in data:
            for item in data['matches']:
                local = item['homeTeam']['name']
                visitante = item['awayTeam']['name']
                goles_local = item['score']['fullTime']['home']
                goles_visitante = item['score']['fullTime']['away']
                estado = item['status']
                
                # Info para el reporte
                info_partido = {
                    'partido': f"{local} vs {visitante}",
                    'resultado': f"{goles_local} - {goles_visitante}" if goles_local is not None else "- vs -",
                    'estado': estado,
                    'accion': 'Ignorado (No existe en DB)'
                }

                # Buscar en DB
                partido_db = Match.objects.filter(
                    home_team__name__icontains=local,
                    away_team__name__icontains=visitante
                ).first()

                if partido_db:
                    info_partido['accion'] = '‚úÖ Actualizado'
                    
                    # Actualizar datos
                    if goles_local is not None:
                        partido_db.home_goals = goles_local
                        partido_db.away_goals = goles_visitante
                    
                    partido_db.date = item['utcDate']
                    partido_db.save()

                    # Calcular Puntos
                    preds = Prediction.objects.filter(match=partido_db)
                    puntos_repartidos = 0
                    
                    for pred in preds:
                        pts = 0
                        if pred.predicted_home == goles_local and pred.predicted_away == goles_visitante:
                            pts = 3
                        else:
                            # L√≥gica simple de ganador
                            winner_real = "H" if goles_local > goles_visitante else "A" if goles_visitante > goles_local else "D"
                            winner_pred = "H" if pred.predicted_home > pred.predicted_away else "A" if pred.predicted_away > pred.predicted_home else "D"
                            if winner_real == winner_pred:
                                pts = 1
                        
                        if pred.points != pts:
                            pred.points = pts
                            pred.save()
                            puntos_repartidos += 1
                            
                    if puntos_repartidos > 0:
                        info_partido['accion'] += f" y Puntos Recalculados ({puntos_repartidos} preds)"

                reporte.append(info_partido)

            # Recalcular Torneos Globalmente
            miembros = TournamentMember.objects.filter(status='ACCEPTED')
            for m in miembros:
                total = Prediction.objects.filter(user=m.user).aggregate(Sum('points'))['points__sum'] or 0
                if m.points != total:
                    m.points = total
                    m.save()

        else:
            messages.warning(request, "La API respondi√≥ OK pero sin partidos.")

    except Exception as e:
        messages.error(request, f"Error: {e}")
        return redirect('mis_torneos')

    # EN LUGAR DE REDIRIGIR, MOSTRAMOS EL REPORTE
    return render(request, 'core/actualizar_resultados.html', {'reporte': reporte})
    
@login_required
def mis_torneos(request):
    # 1. Recuperamos la liga activa de la sesi√≥n (o una por defecto)
    comp_id = request.session.get('competencia_id')
    
    # IMPORTANTE: Si es la primera vez y no hay nada en sesi√≥n, tomamos la primera liga que exista
    if not comp_id:
        primera = Competition.objects.first()
        if primera:
            comp_id = primera.id
            request.session['competencia_id'] = comp_id
            
    competencia_activa = get_object_or_404(Competition, id=comp_id)

    # 2. Filtramos SOLO los torneos de esta liga
    jugando = TournamentMember.objects.filter(
        user=request.user, 
        status='ACCEPTED',
        tournament__competition=competencia_activa # <--- FILTRO MAGICO
    ).select_related('tournament')

    pendientes = TournamentMember.objects.filter(
        user=request.user, 
        status='PENDING',
        tournament__competition=competencia_activa # <--- FILTRO MAGICO
    ).select_related('tournament')

    if request.method == 'POST':
        cantidad_creados = Tournament.objects.filter(creator=request.user, competition=competencia_activa).count()
        
        # Pasamos la competencia al formulario para que llene los dropdowns
        form = TournamentForm(request.POST, competition=competencia_activa) 

        if cantidad_creados >= 3:
            messages.error(request, "üö´ L√≠mite alcanzado: Solo 3 torneos por liga.")
        else:
            if form.is_valid():
                torneo = form.save(commit=False)
                torneo.creator = request.user
                torneo.competition = competencia_activa # <--- ASIGNAMOS LA LIGA AUTOM√ÅTICAMENTE
                torneo.save()
                
                TournamentMember.objects.create(
                    user=request.user, 
                    tournament=torneo, 
                    status='ACCEPTED'
                )
                messages.success(request, f'¬°Torneo "{torneo.name}" creado en {competencia_activa.name}!')
                return redirect('mis_torneos')
    else:
        # Pasamos la competencia al formulario vac√≠o tambi√©n
        form = TournamentForm(competition=competencia_activa)

    return render(request, 'core/mis_torneos.html', {
        'jugando': jugando,
        'pendientes': pendientes,
        'form': form,
        'competencia': competencia_activa
    })

@login_required
def buscar_torneo(request):
    query = request.GET.get('q')
    resultados = []
    
    if query:
        # Buscamos por Nombre o por C√≥digo exacto
        resultados = Tournament.objects.filter(
            Q(name__icontains=query) | Q(code__iexact=query)
        ).exclude(members=request.user) # Excluir los que ya estoy unido

    return render(request, 'core/buscar_torneo.html', {'resultados': resultados, 'query': query})

@login_required
def unirse_torneo(request, tournament_id):
    torneo = Tournament.objects.get(id=tournament_id)
    
    # Verificamos si ya existe la solicitud para no duplicar
    miembro, created = TournamentMember.objects.get_or_create(
        user=request.user,
        tournament=torneo
    )
    
    if created:
        miembro.status = 'PENDING' # Por defecto entra en espera
        miembro.save()
        messages.success(request, f'Solicitud enviada a "{torneo.name}". Espera que el admin te acepte.')
    else:
        messages.info(request, 'Ya has enviado una solicitud a este torneo.')
        
    return redirect('mis_torneos')
@login_required
def gestionar_torneo(request, tournament_id):
    torneo = get_object_or_404(Tournament, id=tournament_id)
    
    # SEGURIDAD: Solo el creador puede entrar aqu√≠
    if request.user != torneo.creator:
        messages.error(request, "Solo el creador del torneo puede gestionarlo.")
        return redirect('mis_torneos')

    # Buscamos pendientes y aceptados
    pendientes = TournamentMember.objects.filter(tournament=torneo, status='PENDING')
    aceptados = TournamentMember.objects.filter(tournament=torneo, status='ACCEPTED')

    return render(request, 'core/gestionar_torneo.html', {
        'torneo': torneo,
        'pendientes': pendientes,
        'aceptados': aceptados
    })

@login_required
def responder_solicitud(request, member_id, accion):
    miembro = get_object_or_404(TournamentMember, id=member_id)
    torneo = miembro.tournament
    
    # SEGURIDAD: Solo el creador puede decidir
    if request.user != torneo.creator:
        messages.error(request, "No tienes permiso para hacer esto.")
        return redirect('mis_torneos')

    if accion == 'aceptar':
        miembro.status = 'ACCEPTED'
        miembro.save()
        messages.success(request, f"¬°{miembro.user.username} ha sido aceptado en el torneo!")
        
    elif accion == 'rechazar':
        # Si rechazamos, borramos la solicitud para que pueda volver a intentar o simplemente desaparezca
        nombre = miembro.user.username
        miembro.delete()
        messages.warning(request, f"Solicitud de {nombre} rechazada.")

    # Volvemos al panel de gesti√≥n
    return redirect('gestionar_torneo', tournament_id=torneo.id)

@login_required
def eliminar_torneo(request, tournament_id):
    torneo = get_object_or_404(Tournament, id=tournament_id)
    
    # SEGURIDAD: Solo el creador puede borrarlo
    if request.user != torneo.creator:
        messages.error(request, "No tienes permiso para eliminar este torneo.")
        return redirect('mis_torneos')
    
    # Borramos el torneo (y a todos sus miembros en cascada)
    nombre = torneo.name
    torneo.delete()
    messages.success(request, f"El torneo '{nombre}' ha sido eliminado correctamente.")
    
    return redirect('mis_torneos')

# --- AGREGAR AL FINAL DE core/views.py ---
from django.core.management import call_command
from django.http import HttpResponse

def correr_migraciones_web(request):
    try:
        # 1. Le decimos a Django: "F√≠jate qu√© cambios hubo en models.py" (Crea el archivo de migraci√≥n)
        call_command('makemigrations')
        
        # 2. Le decimos: "Aplica esos cambios a la base de datos real"
        call_command('migrate')
        
        return HttpResponse("‚úÖ ¬°√âXITO! Se agreg√≥ la columna 'points' y la base de datos est√° actualizada.")
    except Exception as e:
        return HttpResponse(f"‚ùå Error al migrar: {e}")
    
# --- AGREGAR AL FINAL DE core/views.py ---

def cargar_fixture_inicial(request):
    if not request.user.is_staff:
        return HttpResponse("‚õî Acceso denegado.")

    API_TOKEN = '1988cfde850245faaaceaf5d9ff33ada' 
    COMPETITION_ID = '2021' 
    
    headers = {'X-Auth-Token': API_TOKEN}
    url = f"https://api.football-data.org/v4/competitions/{COMPETITION_ID}/matches"

    log_html = "<h1>üìù Reporte de Carga</h1><ul>"
    actualizados = 0
    nuevos = 0

    try:
        response = requests.get(url, headers=headers)
        data = response.json()
        
        if 'matches' in data:
            for item in data['matches']:
                # 1. Equipos (Igual que antes)
                equipo_local, _ = Team.objects.get_or_create(
                    name=item['homeTeam']['name'],
                    defaults={'logo': item['homeTeam']['crest'], 'flag_code': item['homeTeam'].get('tla', 'XX')}
                )
                equipo_visitante, _ = Team.objects.get_or_create(
                    name=item['awayTeam']['name'],
                    defaults={'logo': item['awayTeam']['crest'], 'flag_code': item['awayTeam'].get('tla', 'XX')}
                )

                # 2. Datos del partido
                fecha = item['utcDate']
                estado = item['status']
                gol_local = item['score']['fullTime']['home']
                gol_visitante = item['score']['fullTime']['away']

                # 3. BUSQUEDA MANUAL Y ACTUALIZACI√ìN FORZADA
                # Buscamos el partido por equipos (ignoramos fecha exacta por si cambi√≥ la hora)
                partido = Match.objects.filter(
                    home_team=equipo_local, 
                    away_team=equipo_visitante
                ).first()

                if partido:
                    # SI YA EXISTE: Lo actualizamos a la fuerza
                    cambios = []
                    if partido.status != estado:
                        partido.status = estado
                        cambios.append("Estado")
                    
                    if partido.home_goals != gol_local:
                        partido.home_goals = gol_local
                        partido.away_goals = gol_visitante
                        cambios.append(f"Goles ({gol_local}-{gol_visitante})")
                    
                    if cambios:
                        partido.save()
                        actualizados += 1
                        log_html += f"<li>‚úÖ <b>{equipo_local} vs {equipo_visitante}</b>: Actualizado ({', '.join(cambios)})</li>"
                    else:
                        # Si no hubo cambios, no hacemos nada (pero sabemos que lo vimos)
                        pass
                else:
                    # SI NO EXISTE: Lo creamos
                    Match.objects.create(
                        home_team=equipo_local,
                        away_team=equipo_visitante,
                        date=fecha,
                        status=estado,
                        home_goals=gol_local,
                        away_goals=gol_visitante
                    )
                    nuevos += 1
                    log_html += f"<li>üÜï <b>{equipo_local} vs {equipo_visitante}</b>: Creado Nuevo</li>"

            log_html += f"</ul><h2>Resumen: {nuevos} Nuevos, {actualizados} Actualizados.</h2>"
            return HttpResponse(log_html)
        
        else:
            return HttpResponse(f"‚ö†Ô∏è La API respondi√≥ sin partidos. Data: {data}")

    except Exception as e:
        return HttpResponse(f"‚ùå Error: {e}")
    
def cambiar_competencia(request, comp_id):
    # Guardamos la elecci√≥n en la "memoria" del navegador (Sesi√≥n)
    request.session['competencia_id'] = comp_id
    
    # Redirigimos al usuario a la misma p√°gina donde estaba (o al home si falla)
    return redirect(request.META.get('HTTP_REFERER', 'home'))

# En core/views.py

def fixture(request):
    return render(request, 'core/home.html') # Por ahora reusamos home

def tabla_posiciones(request):
    return render(request, 'core/home.html') # Por ahora reusamos home

def home(request):
    # 1. Obtener Competencia Activa
    comp_id = request.session.get('competencia_id')
    if not comp_id:
        # Fallback si no hay sesi√≥n
        first_comp = Competition.objects.first()
        if first_comp:
            comp_id = first_comp.id
            request.session['competencia_id'] = comp_id
    
    # 2. Filtrar partidos SOLO de esa competencia
    if comp_id:
        # Ordenamos por fecha para que el groupby funcione bien y para mostrar ordenado
        partidos = Match.objects.filter(competition_id=comp_id).order_by('date')
    else:
        partidos = Match.objects.none()

    # 3. Predicciones del usuario
    predicciones_dict = {}
    if request.user.is_authenticated:
        predicciones = Prediction.objects.filter(user=request.user)
        predicciones_dict = {p.match.id: p for p in predicciones}

    # 4. Agrupar por Ronda (Fecha 1, Fecha 2...)
    # Usamos una lista de diccionarios para mandarlo f√°cil al template
    fixture_agrupado = []
    
    # groupby necesita que la lista est√© ordenada por la clave de agrupaci√≥n, 
    # pero ya ordenamos por fecha, asumimos que las rondas siguen un orden temporal.
    # Si las rondas est√°n desordenadas (ej: Fecha 2 antes que Fecha 1 en tiempo), mejor agrupar por nombre.
    
    # Truco: Ordenamos por 'round_name' para agrupar, o confiamos en 'date'. 
    # Vamos a confiar en 'date' para el orden visual, pero agruparemos manualmente para asegurar.
    
    grupos_temp = {} # { "Fecha 1": [match1, match2], "Fecha 2": ... }
    
    for partido in partidos:
        ronda = partido.round_name
        if ronda not in grupos_temp:
            grupos_temp[ronda] = []
        
        # Empaquetamos partido + prediccion
        item = {
            'partido': partido,
            'prediccion': predicciones_dict.get(partido.id)
        }
        grupos_temp[ronda].append(item)

    # Convertimos a lista para el template
    for nombre_ronda, items in grupos_temp.items():
        fixture_agrupado.append({
            'nombre': nombre_ronda,
            'partidos': items,
            'fecha_ref': items[0]['partido'].date # Para ordenar los grupos por fecha del primer partido
        })
    
    # Ordenamos los grupos cronol√≥gicamente
    fixture_agrupado.sort(key=lambda x: x['fecha_ref'])

    return render(request, 'core/home.html', {'fixture_agrupado': fixture_agrupado})
==================================================
ARCHIVO: .\core\__init__.py
==================================================

==================================================
ARCHIVO: .\core\management\commands\actualizar_partidos.py
==================================================
from django.core.management.base import BaseCommand
from core.models import Match, Competition, Team
import requests
from django.utils import timezone
from datetime import timedelta

class Command(BaseCommand):
    help = 'Actualiza partidos respetando la Competici√≥n y la Ronda'

    def handle(self, *args, **kwargs):
        self.stdout.write("üì° Conectando a Football-Data.org...")

        # --- TU TOKEN (Tomado de tu archivo original) ---
        API_TOKEN = '1988cfde850245faaaceaf5d9ff33ada' 
        headers = {'X-Auth-Token': API_TOKEN}
        base_url = "https://api.football-data.org/v4/competitions"

        # 1. Iteramos solo sobre las competiciones que cargaste en la DB
        competiciones_activas = Competition.objects.all()

        if not competiciones_activas:
            self.stdout.write(self.style.ERROR("‚ùå No hay competiciones cargadas en la base de datos. Cre√°las en el Admin primero."))
            return

        for comp in competiciones_activas:
            self.stdout.write(f"\nüèÜ Procesando: {comp.name} (ID API: {comp.api_id})...")
            
            # Pedimos los partidos de ESTA competici√≥n
            # Traemos partidos recientes y futuros cercanos (Rango amplio para fixture)
            hoy = timezone.now().date()
            desde = hoy - timedelta(days=5) 
            hasta = hoy + timedelta(days=15)
            
            url = f"{base_url}/{comp.api_id}/matches"
            params = {
                'dateFrom': desde.strftime('%Y-%m-%d'),
                'dateTo': hasta.strftime('%Y-%m-%d')
            }

            try:
                response = requests.get(url, headers=headers, params=params)
                data = response.json()

                if 'errorCode' in data:
                    self.stdout.write(self.style.WARNING(f"   ‚ö†Ô∏è Error API: {data.get('message')}"))
                    continue

                partidos_api = data.get('matches', [])
                self.stdout.write(f"   ‚úÖ Encontrados: {len(partidos_api)} partidos.")

                for item in partidos_api:
                    # --- A. PROCESAR EQUIPOS ---
                    # Usamos get_or_create para no duplicar
                    local, _ = Team.objects.get_or_create(
                        name=item['homeTeam']['name'],
                        defaults={
                            'logo': item['homeTeam'].get('crest'),
                            'flag_code': item['homeTeam'].get('tla', 'XX')
                        }
                    )
                    visitante, _ = Team.objects.get_or_create(
                        name=item['awayTeam']['name'],
                        defaults={
                            'logo': item['awayTeam'].get('crest'),
                            'flag_code': item['awayTeam'].get('tla', 'XX')
                        }
                    )

                    # --- B. DETECTAR RONDA (Vital para tu lista plegable) ---
                    # La API devuelve 'matchday' (ej: 10) o 'stage' (ej: GROUP_STAGE)
                    ronda = item.get('matchday')
                    stage = item.get('stage')
                    
                    if ronda:
                        nombre_ronda = f"Fecha {ronda}"
                    else:
                        # Limpiamos el nombre feo de la API (Ej: REGULAR_SEASON -> Regular Season)
                        nombre_ronda = stage.replace('_', ' ').title() if stage else "General"

                    # --- C. DATOS DEL PARTIDO ---
                    fecha_str = item['utcDate']
                    estado = item['status']
                    goles_local = item['score']['fullTime']['home']
                    goles_visitante = item['score']['fullTime']['away']

                    # --- D. BUSCAR O CREAR PARTIDO ---
                    # Ahora filtramos TAMBI√âN por competici√≥n para evitar cruces
                    match_obj, created = Match.objects.get_or_create(
                        competition=comp,
                        home_team=local,
                        away_team=visitante,
                        defaults={
                            'date': fecha_str,
                            'status': estado,
                            'round_name': nombre_ronda, # <--- Guardamos la ronda aqu√≠
                            'home_goals': goles_local,
                            'away_goals': goles_visitante
                        }
                    )

                    if not created:
                        # Si ya existe, actualizamos datos clave
                        cambios = False
                        if match_obj.status != estado:
                            match_obj.status = estado
                            cambios = True
                        if match_obj.home_goals != goles_local:
                            match_obj.home_goals = goles_local
                            match_obj.away_goals = goles_visitante
                            cambios = True
                        if match_obj.date != item['utcDate']: # Por si cambi√≥ el horario
                            # Ojo: comparar strings de fecha puede ser truculento, pero sirve para cambios grandes
                            pass 
                        
                        if cambios:
                            match_obj.save()
                            self.stdout.write(f"      üîÑ Actualizado: {local} vs {visitante}")
                    else:
                        self.stdout.write(self.style.SUCCESS(f"      ‚ú® Nuevo: {local} vs {visitante} ({nombre_ronda})"))

            except Exception as e:
                self.stdout.write(self.style.ERROR(f"   ‚ùå Error conectando: {e}"))

        self.stdout.write(self.style.SUCCESS("\n‚úÖ Proceso de carga finalizado."))
==================================================
ARCHIVO: .\core\management\commands\actualizar_partidos_apisports.py
==================================================
from django.core.management.base import BaseCommand
from core.models import Match
import requests
from django.utils import timezone
from datetime import timedelta

class Command(BaseCommand):
    help = 'Actualiza partidos de Ayer, Hoy y Ma√±ana'

    def handle(self, *args, **kwargs):
        self.stdout.write("üì° Iniciando actualizaci√≥n masiva...")

        # TU CONFIGURACI√ìN
        base_url = "https://v3.football.api-sports.io/fixtures"
        headers = {
            'x-apisports-key': '8bfe23f584f1867b8ac0841f70d12009' 
        }

        # Calculamos las fechas: Ayer, Hoy, Ma√±ana
        hoy = timezone.now().date()
        fechas_a_revisar = [
            hoy - timedelta(days=1), # Ayer
            hoy,                     # Hoy
            hoy + timedelta(days=1)  # Ma√±ana
        ]

        # BUCLE PRINCIPAL
        for fecha in fechas_a_revisar:
            fecha_str = fecha.strftime('%Y-%m-%d')
            self.stdout.write(f"üìÖ Consultando fecha: {fecha_str}...")

            params = {
                'date': fecha_str
            }

            try:
                response = requests.get(base_url, headers=headers, params=params)
                
                if response.status_code != 200:
                    self.stdout.write(self.style.ERROR(f"‚ùå Error API en {fecha_str}"))
                    continue 

                data = response.json()
                
                # Diagn√≥stico de errores (Plan Free, Cuota, etc)
                errores = data.get('errors')
                if errores:
                    self.stdout.write(self.style.WARNING(f"‚ö†Ô∏è ALERTA API en {fecha_str}: {errores}"))
                    continue 

                partidos_api = data.get('response', [])
                self.stdout.write(f"   --> Encontrados en API: {len(partidos_api)} partidos")

                count_actualizados = 0

                for item in partidos_api:
                    # 1. Datos API
                    nombre_local_api = item['teams']['home']['name']
                    nombre_visitante_api = item['teams']['away']['name']
                    
                    # --- ESTA ES LA L√çNEA QUE FALTABA (MODO ESP√çA) ---
                    self.stdout.write(f"üëÄ API ve: {nombre_local_api} vs {nombre_visitante_api}")
                    # -------------------------------------------------

                    goles_local = item['goals']['home']
                    goles_visitante = item['goals']['away']
                    estado = item['fixture']['status']['short']

                    # Logos
                    logo_local = item['teams']['home']['logo']
                    logo_visitante = item['teams']['away']['logo']

                    # 2. Buscar en DB
                    partido_db = Match.objects.filter(
                        home_team__name__icontains=nombre_local_api,
                        away_team__name__icontains=nombre_visitante_api
                    ).first()

                    if partido_db:
                        cambios = False

                        # A. Actualizar Goles
                        if goles_local is not None and goles_visitante is not None:
                            if partido_db.home_goals != goles_local or partido_db.away_goals != goles_visitante:
                                partido_db.home_goals = goles_local
                                partido_db.away_goals = goles_visitante
                                cambios = True

                        # B. Actualizar Logos (Esto s√≠ estaba, pero me aseguro que est√© bien)
                        if partido_db.home_team.logo != logo_local:
                            partido_db.home_team.logo = logo_local
                            partido_db.home_team.save()
                            self.stdout.write(f"      üõ°Ô∏è Logo actualizado: {nombre_local_api}")

                        if partido_db.away_team.logo != logo_visitante:
                            partido_db.away_team.logo = logo_visitante
                            partido_db.away_team.save()
                            self.stdout.write(f"      üõ°Ô∏è Logo actualizado: {nombre_visitante_api}")

                        # Guardar cambios
                        if cambios:
                            partido_db.save()
                            self.stdout.write(self.style.SUCCESS(f"      ‚úÖ Goles actualizados: {nombre_local_api}"))
                            count_actualizados += 1
                        
            except Exception as e:
                self.stdout.write(self.style.ERROR(f"‚ùå Error cr√≠tico en {fecha_str}: {e}"))

        self.stdout.write(self.style.SUCCESS("‚ú® Proceso finalizado."))
==================================================
ARCHIVO: .\core\migrations\0001_initial.py
==================================================
# Generated by Django 5.2.9 on 2025-12-20 01:01

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Competition',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre Liga/Copa')),
                ('slug', models.SlugField(unique=True, verbose_name='Identificador URL')),
                ('api_id', models.IntegerField(unique=True, verbose_name='ID en API Football')),
                ('type', models.CharField(choices=[('LEAGUE', 'Liga'), ('CUP', 'Copa')], default='LEAGUE', max_length=10)),
            ],
        ),
        migrations.CreateModel(
            name='Team',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50, verbose_name='Nombre')),
                ('flag_code', models.CharField(max_length=5, verbose_name='C√≥digo Bandera')),
                ('logo', models.URLField(blank=True, null=True, verbose_name='Escudo URL')),
            ],
        ),
        migrations.CreateModel(
            name='Match',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateTimeField(verbose_name='Fecha del partido')),
                ('status', models.CharField(default='SCHEDULED', max_length=20)),
                ('round_name', models.CharField(max_length=50, verbose_name='Ronda / Fecha')),
                ('home_goals', models.IntegerField(blank=True, null=True, verbose_name='Goles Local')),
                ('away_goals', models.IntegerField(blank=True, null=True, verbose_name='Goles Visitante')),
                ('competition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='matches', to='core.competition', verbose_name='Competici√≥n')),
                ('away_team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='away_matches', to='core.team', verbose_name='Visitante')),
                ('home_team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='home_matches', to='core.team', verbose_name='Local')),
            ],
            options={
                'verbose_name': 'Partido',
                'verbose_name_plural': 'Partidos',
            },
        ),
        migrations.CreateModel(
            name='Prediction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('predicted_home', models.IntegerField(verbose_name='Predicci√≥n Local')),
                ('predicted_away', models.IntegerField(verbose_name='Predicci√≥n Visitante')),
                ('points', models.IntegerField(default=0)),
                ('match', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.match')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Tournament',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Nombre del Torneo')),
                ('code', models.CharField(max_length=6, unique=True, verbose_name='C√≥digo de Invitaci√≥n')),
                ('image', models.URLField(blank=True, null=True, verbose_name='Imagen (URL)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('start_round', models.CharField(blank=True, max_length=50, null=True, verbose_name='Desde la Ronda')),
                ('end_round', models.CharField(blank=True, max_length=50, null=True, verbose_name='Hasta la Ronda')),
                ('competition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.competition', verbose_name='Liga/Copa Base')),
                ('creator', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='created_tournaments', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='TournamentMember',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('PENDING', 'Pendiente de Aprobaci√≥n'), ('ACCEPTED', 'Aceptado / Jugando'), ('REJECTED', 'Rechazado')], default='PENDING', max_length=10)),
                ('joined_at', models.DateTimeField(auto_now_add=True)),
                ('points', models.IntegerField(default=0)),
                ('tournament', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.tournament')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Miembro de Torneo',
                'verbose_name_plural': 'Miembros de Torneo',
                'unique_together': {('tournament', 'user')},
            },
        ),
        migrations.AddField(
            model_name='tournament',
            name='members',
            field=models.ManyToManyField(related_name='tournaments', through='core.TournamentMember', to=settings.AUTH_USER_MODEL),
        ),
    ]

==================================================
ARCHIVO: .\core\migrations\__init__.py
==================================================

==================================================
ARCHIVO: .\core\templates\account\login.html
==================================================
{% extends 'core/base.html' %}
{% load socialaccount %}
{% load i18n %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh]">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-200">
        
        <div class="text-center mb-6">
            <h2 class="text-3xl font-bold text-slate-800">Bienvenido</h2>
            <p class="text-gray-500 text-sm mt-2">Ingresa para jugar al Prode</p>
        </div>

        <div class="mb-6">
            {% get_providers as socialaccount_providers %}
            {% if socialaccount_providers %}
            <a href="{% provider_login_url 'google' %}?next=/" 
               class="flex items-center justify-center w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold py-3 px-4 rounded-md transition duration-200 shadow-sm gap-3">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Logo Google">
                Continuar con Google
            </a>
            {% endif %}
        </div>

        <div class="relative flex py-2 items-center mb-6">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="flex-shrink mx-4 text-gray-400 text-sm">O ingresa con tu email</span>
            <div class="flex-grow border-t border-gray-300"></div>
        </div>

        <form class="login" method="POST" action="{% url 'account_login' %}">
            {% csrf_token %}
            
            {% if form.non_field_errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm">
                    {{ form.non_field_errors.0 }}
                </div>
            {% endif %}

            <div class="space-y-4">
                
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email o Usuario</label>
                    <input type="text" 
                           name="login" 
                           placeholder="tu@email.com" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           required>
                    {% if form.login.errors %}
                        <p class="text-red-500 text-xs italic mt-1">{{ form.login.errors.0 }}</p>
                    {% endif %}
                </div>
                
                <div>
                    <div class="flex justify-between">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Contrase√±a</label>
                        <a href="{% url 'account_reset_password' %}" class="text-xs text-blue-600 hover:underline">¬øOlvidaste tu contrase√±a?</a>
                    </div>
                    <input type="password" 
                           name="password" 
                           placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           required>
                    {% if form.password.errors %}
                        <p class="text-red-500 text-xs italic mt-1">{{ form.password.errors.0 }}</p>
                    {% endif %}
                </div>

                <div class="flex items-center">
                    <input type="checkbox" name="remember" id="id_remember" class="h-4 w-4 text-yellow-500 focus:ring-yellow-400 border-gray-300 rounded">
                    <label for="id_remember" class="ml-2 block text-sm text-gray-900">
                        Recordarme
                    </label>
                </div>

                <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-md transition duration-200 mt-2">
                    Ingresar
                </button>
            </div>
        </form>

        <p class="text-center text-gray-500 text-xs mt-6">
            ¬øA√∫n no tienes cuenta? 
            <a href="{% url 'account_signup' %}" class="text-blue-600 hover:underline">Reg√≠strate aqu√≠</a>
        </p>
    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\account\signup.html
==================================================
{% extends 'core/base.html' %}
{% load socialaccount %}
{% load i18n %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh]">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-200">
        
        <div class="text-center mb-6">
            <h2 class="text-3xl font-bold text-slate-800">Crear Cuenta</h2>
            <p class="text-gray-500 text-sm mt-2">√önete para jugar al Prode</p>
        </div>

        <div class="mb-6">
            {% get_providers as socialaccount_providers %}
            {% if socialaccount_providers %}
            <a href="{% provider_login_url 'google' %}?next=/" 
               class="flex items-center justify-center w-full bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 font-bold py-3 px-4 rounded-md transition duration-200 shadow-sm gap-3">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="Logo Google">
                Registrarse con Google
            </a>
            {% endif %}
        </div>

        <div class="relative flex py-2 items-center mb-6">
            <div class="flex-grow border-t border-gray-300"></div>
            <span class="flex-shrink mx-4 text-gray-400 text-sm">O usa tu email</span>
            <div class="flex-grow border-t border-gray-300"></div>
        </div>

        <form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
            {% csrf_token %}

            {% if form.non_field_errors %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm">
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}

            <div class="space-y-4">
                {% for field in form %}
                <div>
                    <label class="block text-gray-700 text-sm font-bold mb-2">{{ field.label }}</label>
                    <input type="{{ field.field.widget.input_type }}" 
                           name="{{ field.name }}" 
                           id="{{ field.id_for_label }}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-400"
                           {% if field.field.required %}required{% endif %}
                           placeholder="{{ field.label }}">
                    
                    {% if field.errors %}
                        <p class="text-red-500 text-xs italic mt-1">{{ field.errors.0 }}</p>
                    {% endif %}
                    
                    {% if field.help_text %}
                        <p class="text-gray-400 text-xs mt-1">{{ field.help_text|safe }}</p>
                    {% endif %}
                </div>
                {% endfor %}

                <button type="submit" class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 px-4 rounded-md transition duration-200 mt-2">
                    Registrarse
                </button>
            </div>
        </form>

        <p class="text-center text-gray-500 text-xs mt-6">
            ¬øYa tienes cuenta? 
            <a href="{% url 'account_login' %}" class="text-blue-600 hover:underline">Ingresa aqu√≠</a>
        </p>
    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\actualizar_resultados.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">
    
    <div class="mb-6 flex justify-between items-center">
        <h1 class="text-2xl font-bold text-slate-800">üì° Reporte de Conexi√≥n API</h1>
        <a href="{% url 'mis_torneos' %}" class="bg-blue-600 text-white px-4 py-2 rounded-md font-bold hover:bg-blue-700">
            &larr; Volver a Mis Torneos
        </a>
    </div>

    <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
        <table class="w-full text-left text-sm">
            <thead class="bg-slate-100 text-slate-600 uppercase font-bold">
                <tr>
                    <th class="px-4 py-3">Partido (API)</th>
                    <th class="px-4 py-3">Resultado</th>
                    <th class="px-4 py-3">Estado</th>
                    <th class="px-4 py-3">Acci√≥n en DB</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for item in reporte %}
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 font-medium">{{ item.partido }}</td>
                    <td class="px-4 py-3 font-mono bg-gray-50 text-center font-bold">{{ item.resultado }}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-bold
                            {% if item.estado == 'FINISHED' %}bg-green-100 text-green-800
                            {% elif item.estado == 'IN_PLAY' %}bg-red-100 text-red-800 animate-pulse
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ item.estado }}
                        </span>
                    </td>
                    <td class="px-4 py-3 text-slate-600">
                        {{ item.accion }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="px-4 py-8 text-center text-gray-500">
                        No se encontraron partidos en el rango de fechas de la API.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

==================================================
ARCHIVO: .\core\templates\core\base.html
==================================================
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prode Mundial - {{ competencia_activa.name|default:"General" }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        /* Ocultar scrollbar pero permitir scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <nav class="bg-slate-900 text-white shadow-lg z-50 relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                
                <div class="flex items-center space-x-6">
                    <a href="{% url 'home' %}" class="flex items-center space-x-2 text-xl font-bold text-yellow-400 hover:text-yellow-300">
                        <span>‚öΩ</span>
                        <span class="hidden md:inline">PRODE</span>
                    </a>

                    <div x-data="{ open: false }" class="relative">
                        <button @click="open = !open" @click.outside="open = false" class="flex items-center space-x-2 bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-full transition border border-slate-700">
                            {% if competencia_activa %}
                                <span class="font-bold text-sm uppercase tracking-wide">{{ competencia_activa.name }}</span>
                            {% else %}
                                <span class="font-bold text-sm text-red-400">Seleccionar Liga</span>
                            {% endif %}
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>

                        <div x-show="open" 
                             class="absolute left-0 mt-2 w-56 bg-white rounded-md shadow-xl py-2 z-50 text-slate-800 border border-gray-100"
                             style="display: none;">
                            
                            <div class="px-4 py-2 text-xs font-bold text-gray-400 uppercase">Cambiar Competici√≥n</div>
                            
                            {% for comp in lista_competencias %}
                            <a href="{% url 'cambiar_competencia' comp.id %}" 
                               class="block px-4 py-2 text-sm hover:bg-yellow-50 hover:text-yellow-700 flex justify-between items-center group
                               {% if comp.id == competencia_activa.id %}bg-slate-50 font-bold text-blue-600{% endif %}">
                                <span>{{ comp.name }}</span>
                                {% if comp.id == competencia_activa.id %}
                                    <span class="text-blue-500">‚óè</span>
                                {% endif %}
                            </a>
                            {% empty %}
                                <span class="block px-4 py-2 text-sm text-gray-400">No hay ligas cargadas</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    {% if user.is_staff %}
                        <a href="{% url 'actualizar_web' %}" class="text-gray-400 hover:text-white" title="Actualizar API">üîÑ</a>
                    {% endif %}

                    {% if user.is_authenticated %}
                        <div class="flex items-center space-x-3">
                            <span class="text-sm font-medium hidden md:block">{{ user.username }}</span>
                            <form action="{% url 'account_logout' %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="text-xs bg-slate-800 hover:bg-red-900 text-red-400 px-3 py-1 rounded transition">Salir</button>
                            </form>
                        </div>
                    {% else %}
                        <a href="{% url 'account_login' %}" class="bg-yellow-500 hover:bg-yellow-600 text-slate-900 px-4 py-2 rounded-md text-sm font-bold transition">Ingresar</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <div class="bg-white border-b border-gray-200 sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="flex space-x-8 overflow-x-auto no-scrollbar" aria-label="Tabs">
                
                <a href="{% url 'home' %}" 
                   class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition
                   {% if request.resolver_match.url_name == 'home' or request.resolver_match.url_name == 'predecir' %}
                        border-blue-500 text-blue-600
                   {% else %}
                        border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üìù Pron√≥sticos
                </a>

                <a href="{% url 'mis_torneos' %}" 
                   class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition
                   {% if 'torneo' in request.resolver_match.url_name %}
                        border-blue-500 text-blue-600
                   {% else %}
                        border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üèÜ Mis Torneos
                </a>

                <a href="{% url 'fixture' %}" 
                   class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition
                   {% if request.resolver_match.url_name == 'fixture' %}
                        border-blue-500 text-blue-600
                   {% else %}
                        border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üìÖ Fixture
                </a>

                <a href="{% url 'tabla' %}" 
                   class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition
                   {% if request.resolver_match.url_name == 'tabla' %}
                        border-blue-500 text-blue-600
                   {% else %}
                        border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300
                   {% endif %}">
                   üìä {% if competencia_activa.type == 'CUP' %}Grupos{% else %}Tabla{% endif %}
                </a>

            </nav>
        </div>
    </div>

    <main class="flex-grow max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {% if messages %}
            <div class="max-w-4xl mx-auto mb-6">
                {% for message in messages %}
                    <div class="p-4 rounded-md shadow-sm border mb-2 text-sm font-medium
                        {% if message.tags == 'error' %}bg-red-50 text-red-700 border-red-200
                        {% elif message.tags == 'success' %}bg-green-50 text-green-700 border-green-200
                        {% else %}bg-blue-50 text-blue-700 border-blue-200{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-slate-900 text-gray-500 py-6 mt-auto border-t border-slate-800">
        <div class="max-w-7xl mx-auto px-4 text-center text-xs">
            <p>&copy; 2026 Prode System - Desarrollado por Facundo</p>
        </div>
    </footer>

</body>
</html>
==================================================
ARCHIVO: .\core\templates\core\buscar_torneo.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto min-h-[60vh]">

    <div class="mb-6">
        <a href="{% url 'mis_torneos' %}" class="text-gray-500 hover:text-gray-900 flex items-center mb-4">
            &larr; Volver a Mis Torneos
        </a>
        <h1 class="text-3xl font-bold text-slate-800">üîç Buscar Torneo</h1>
        <p class="text-gray-600">Ingresa el nombre del torneo o el c√≥digo de invitaci√≥n.</p>
    </div>

    <form method="get" class="mb-8 relative">
        <input type="text" name="q" value="{{ query|default:'' }}" 
               class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
               placeholder="Ej: Mundial Amigos o C√≥digo X7Z9...">
        <span class="absolute left-3 top-3.5 text-gray-400 text-xl">üîé</span>
        <button type="submit" class="absolute right-2 top-2 bg-blue-600 text-white px-4 py-1.5 rounded-md font-bold hover:bg-blue-700">
            Buscar
        </button>
    </form>

    {% if query %}
        <h2 class="text-xl font-bold text-gray-700 mb-4">Resultados para "{{ query }}"</h2>
        
        {% if resultados %}
            <div class="space-y-4">
                {% for torneo in resultados %}
                <div class="bg-white p-4 rounded-lg shadow border border-gray-200 flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        {% if torneo.image %}
                            <img src="{{ torneo.image }}" class="w-10 h-10 rounded-full object-cover">
                        {% else %}
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-lg">üèÜ</div>
                        {% endif %}
                        <div>
                            <h3 class="font-bold text-lg">{{ torneo.name }}</h3>
                            <p class="text-xs text-gray-500">Creado por {{ torneo.creator.username }}</p>
                        </div>
                    </div>

                    <a href="{% url 'unirse_torneo' torneo.id %}" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-md font-bold text-sm transition">
                        Unirse
                    </a>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 text-yellow-700">
                <p>No se encontraron torneos. Verifica el c√≥digo o el nombre.</p>
            </div>
        {% endif %}

    {% else %}
        <div class="text-center text-gray-400 mt-12">
            <p>Escribe algo arriba para empezar a buscar.</p>
        </div>
    {% endif %}

</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\gestionar_torneo.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">
    
    <div class="mb-8 flex justify-between items-center">
        <div>
            <a href="{% url 'mis_torneos' %}" class="text-gray-500 hover:text-slate-800 text-sm font-bold mb-2 block">&larr; Volver</a>
            <h1 class="text-3xl font-bold text-slate-800">‚öôÔ∏è Gestionar: {{ torneo.name }}</h1>
            <p class="text-gray-500">C√≥digo de invitaci√≥n: <span class="font-mono bg-yellow-100 px-2 py-1 rounded font-bold text-slate-800 select-all">{{ torneo.code }}</span></p>
        </div>
    </div>

    <div class="bg-white rounded-lg shadow-md border border-orange-200 mb-8 overflow-hidden">
        <div class="bg-orange-50 px-6 py-4 border-b border-orange-100 flex justify-between items-center">
            <h2 class="text-lg font-bold text-orange-800">‚è≥ Solicitudes Pendientes</h2>
            <span class="bg-orange-200 text-orange-800 text-xs font-bold px-2 py-1 rounded-full">{{ pendientes.count }}</span>
        </div>

        {% if pendientes %}
            <ul class="divide-y divide-gray-100">
                {% for solicitud in pendientes %}
                <li class="px-6 py-4 flex items-center justify-between hover:bg-orange-50/30 transition">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-slate-200 flex items-center justify-center font-bold text-slate-600 mr-3">
                            {{ solicitud.user.username|slice:":1"|upper }}
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">{{ solicitud.user.username }}</p>
                            <p class="text-xs text-gray-500">{{ solicitud.user.email }}</p>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <a href="{% url 'responder_solicitud' solicitud.id 'rechazar' %}" 
                           class="bg-white border border-red-200 text-red-600 hover:bg-red-50 px-3 py-1.5 rounded-md text-sm font-bold transition">
                            Rechazar
                        </a>
                        <a href="{% url 'responder_solicitud' solicitud.id 'aceptar' %}" 
                           class="bg-green-500 text-white hover:bg-green-600 px-3 py-1.5 rounded-md text-sm font-bold shadow-sm transition">
                            ‚úÖ Aceptar
                        </a>
                    </div>
                </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="p-8 text-center text-gray-400">
                <p>No hay solicitudes pendientes por ahora.</p>
            </div>
        {% endif %}
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <div class="px-6 py-4 border-b border-gray-100">
            <h2 class="text-lg font-bold text-slate-700">üë• Participantes Activos ({{ aceptados.count }})</h2>
        </div>
        <div class="p-6">
            <div class="flex flex-wrap gap-2">
                {% for miembro in aceptados %}
                    <div class="inline-flex items-center bg-gray-100 px-3 py-1 rounded-full border border-gray-200">
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                        <span class="text-sm font-medium text-gray-700">
                            {{ miembro.user.username }} 
                            {% if miembro.user == torneo.creator %}<span class="text-xs text-blue-500 font-bold ml-1">(Admin)</span>{% endif %}
                        </span>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

</div>
<div class="mt-12 border-t-2 border-red-100 pt-8">
        <div class="bg-red-50 p-6 rounded-lg border border-red-200 flex justify-between items-center">
            <div>
                <h3 class="text-lg font-bold text-red-800">Zona de Peligro</h3>
                <p class="text-sm text-red-600">Esta acci√≥n no se puede deshacer. Se borrar√° el torneo y todos los puntajes asociados.</p>
            </div>
            
            <button onclick="confirmarEliminacion()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded shadow transition">
                üóëÔ∏è Eliminar Torneo
            </button>
        </div>
    </div>

    <script>
        function confirmarEliminacion() {
            if (confirm('¬øEst√°s SEGURO de que quieres eliminar este torneo?\n\nEsta acci√≥n es irreversible.')) {
                window.location.href = "{% url 'eliminar_torneo' torneo.id %}";
            }
        }
    </script>

</div> 
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\home.html
==================================================
{% extends 'core/base.html' %} 

{% block content %}

    <div class="text-center mb-8">
        <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Pron√≥sticos</h1>
        <p class="text-gray-600 text-sm">Juega fecha a fecha en {{ competencia_activa.name }}</p>
    </div>

    <div class="max-w-4xl mx-auto space-y-4">
        
        {% for grupo in fixture_agrupado %}
        <div x-data="{ open: {% if forloop.first %}true{% else %}false{% endif %} }" 
             class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            
            <button @click="open = !open" class="w-full flex justify-between items-center px-6 py-4 bg-slate-50 hover:bg-slate-100 transition border-b border-gray-100">
                <h2 class="text-lg font-bold text-slate-800">{{ grupo.nombre }}</h2>
                <div class="flex items-center space-x-3">
                    <span class="text-xs text-gray-500 font-medium">{{ grupo.partidos|length }} partidos</span>
                    <svg :class="{'rotate-180': open}" class="w-5 h-5 text-gray-400 transform transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
            </button>

            <div x-show="open" x-collapse class="divide-y divide-gray-100">
                
                {% for item in grupo.partidos %}
                <div class="p-4 hover:bg-gray-50 transition flex flex-col sm:flex-row items-center justify-between gap-4">
                    
                    <div class="text-center sm:text-left min-w-[80px]">
                        <span class="block text-xs font-bold text-gray-400 uppercase">{{ item.partido.date|date:"D d" }}</span>
                        <span class="block text-xs text-gray-400">{{ item.partido.date|date:"H:i" }}</span>
                        {% if item.partido.status == 'IN_PLAY' %}
                            <span class="text-[10px] text-red-500 font-bold animate-pulse">EN VIVO</span>
                        {% endif %}
                    </div>

                    <div class="flex-grow flex items-center justify-center space-x-4 w-full sm:w-auto">
                        <div class="flex items-center justify-end w-1/3 space-x-2 text-right">
                            <span class="font-bold text-slate-800 text-sm md:text-base hidden md:block">{{ item.partido.home_team.name }}</span>
                            <span class="font-bold text-slate-800 text-sm md:text-base md:hidden">{{ item.partido.home_team.name|slice:":3"|upper }}</span>
                            {% if item.partido.home_team.logo %}
                                <img src="{{ item.partido.home_team.logo }}" class="w-8 h-8 object-contain">
                            {% else %}
                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs">üè†</div>
                            {% endif %}
                        </div>

                        <div class="font-black text-xl text-slate-900 bg-slate-100 px-3 py-1 rounded min-w-[60px] text-center">
                            {% if item.partido.status == 'FINISHED' or item.partido.status == 'IN_PLAY' %}
                                {{ item.partido.home_goals }}-{{ item.partido.away_goals }}
                            {% else %}
                                VS
                            {% endif %}
                        </div>

                        <div class="flex items-center justify-start w-1/3 space-x-2 text-left">
                            {% if item.partido.away_team.logo %}
                                <img src="{{ item.partido.away_team.logo }}" class="w-8 h-8 object-contain">
                            {% else %}
                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs">‚úàÔ∏è</div>
                            {% endif %}
                            <span class="font-bold text-slate-800 text-sm md:text-base hidden md:block">{{ item.partido.away_team.name }}</span>
                            <span class="font-bold text-slate-800 text-sm md:text-base md:hidden">{{ item.partido.away_team.name|slice:":3"|upper }}</span>
                        </div>
                    </div>

                    <div class="w-full sm:w-auto min-w-[140px]">
                        {% if item.partido.status == 'FINISHED' %}
                            <div class="text-center">
                                {% if item.prediccion %}
                                    <span class="text-xs font-bold text-blue-600 block">Tu pron√≥stico:</span>
                                    <span class="font-mono font-bold text-lg">{{ item.prediccion.predicted_home }} - {{ item.prediccion.predicted_away }}</span>
                                    
                                    {% if item.prediccion.points > 0 %}
                                        <span class="block text-[10px] bg-green-100 text-green-700 px-1 rounded mt-1">+{{ item.prediccion.points }} pts</span>
                                    {% else %}
                                        <span class="block text-[10px] bg-gray-100 text-gray-500 px-1 rounded mt-1">0 pts</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-xs text-red-400 font-bold">No jugado</span>
                                {% endif %}
                            </div>
                        {% else %}
                            {% if item.prediccion %}
                                <a href="{% url 'predecir' item.partido.id %}" class="block w-full text-center bg-white border border-slate-300 text-slate-600 hover:bg-slate-50 font-bold py-2 px-4 rounded-lg text-sm transition">
                                    ‚úèÔ∏è {{ item.prediccion.predicted_home }}-{{ item.prediccion.predicted_away }}
                                </a>
                            {% else %}
                                <a href="{% url 'predecir' item.partido.id %}" class="block w-full text-center bg-slate-900 hover:bg-slate-800 text-white font-bold py-2 px-4 rounded-lg text-sm shadow transition">
                                    Jugar
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>

                </div>
                {% endfor %}
            </div>
        </div>
        {% empty %}
            <div class="text-center py-12">
                <p class="text-gray-500 text-lg">No hay partidos cargados para esta competici√≥n.</p>
                <p class="text-sm text-gray-400">Verifica que hayas corrido el script de actualizaci√≥n.</p>
            </div>
        {% endfor %}
    </div>

{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\mis_torneos.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-4xl mx-auto">

    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-slate-800">üèÜ Mis Torneos</h1>
        <a href="{% url 'buscar_torneo' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-bold shadow transition flex items-center">
            üîç Buscar Torneo
        </a>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">‚ú® Crear Nuevo Torneo</h2>
        
        <form method="post" class="flex flex-col md:flex-row gap-4 items-end">
            {% csrf_token %}
            
            <div class="flex-grow w-full">
                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre del Torneo</label>
                {{ form.name }} </div>

            <div class="flex-grow w-full">
                <label class="block text-sm font-medium text-gray-700 mb-1">Imagen (URL Opcional)</label>
                {{ form.image }}
            </div>

            <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-slate-900 font-bold px-6 py-2 rounded-md transition w-full md:w-auto h-[42px]">
                Crear
            </button>
        </form>
    </div>

    <h2 class="text-2xl font-bold text-slate-700 mb-4">‚úÖ Jugando Actualmente</h2>
    
    {% if jugando %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            {% for miembro in jugando %}
            <div class="bg-white p-5 rounded-lg shadow border border-green-200 relative overflow-hidden group hover:shadow-lg transition">
                <div class="absolute top-0 right-0 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-bl-lg">
                    ACTIVO
                </div>
                
                <div class="flex items-center space-x-4">
                    {% if miembro.tournament.image %}
                        <img src="{{ miembro.tournament.image }}" class="w-12 h-12 rounded-full object-cover border-2 border-green-500">
                    {% else %}
                        <div class="w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center text-xl">üèÜ</div>
                    {% endif %}
                    
                    <div>
                        <h3 class="font-bold text-lg text-gray-900">{{ miembro.tournament.name }}</h3>
                        <p class="text-sm text-gray-500">C√≥digo: <span class="font-mono bg-gray-100 px-1 rounded">{{ miembro.tournament.code }}</span></p>
                    </div>
                </div>

                <div class="mt-4 pt-4 border-t border-gray-100 flex justify-between items-center">
                    <span class="text-sm font-semibold text-slate-600">Tu Puntaje: {{ miembro.points }} pts</span>
    
                    <div class="flex space-x-3">
                        {% if miembro.tournament.creator == user %}
                            <a href="{% url 'gestionar_torneo' miembro.tournament.id %}" class="text-orange-600 text-sm hover:underline font-bold flex items-center">
                                ‚öôÔ∏è Gestionar
                            </a>
                    {% endif %}

                    <a href="{% url 'ranking_torneo' miembro.tournament.id %}" class="text-blue-600 text-sm hover:underline font-medium">
                        Ver Ranking &rarr;
                    </a>
    </div>
</div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="bg-gray-50 p-8 rounded-lg text-center border border-dashed border-gray-300 mb-8">
            <p class="text-gray-500">A√∫n no est√°s participando en ning√∫n torneo.</p>
        </div>
    {% endif %}

    {% if pendientes %}
        <h2 class="text-2xl font-bold text-slate-700 mb-4">‚è≥ Solicitudes Pendientes</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {% for miembro in pendientes %}
            <div class="bg-white p-5 rounded-lg shadow border border-orange-200 opacity-75">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-xl">‚è≥</div>
                    <div>
                        <h3 class="font-bold text-lg text-gray-900">{{ miembro.tournament.name }}</h3>
                        <p class="text-sm text-orange-600 font-medium">Esperando al administrador...</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% endif %}

</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\prediccion.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-xl mx-auto mt-10">
    
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-200">
        
        <div class="bg-slate-900 text-white text-center py-6">
            <h2 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2">Mundial 2026</h2>
            <div class="flex justify-center items-center space-x-4 text-2xl font-bold">
                <span>{{ partido.home_team.name }}</span>
                <span class="text-yellow-500">vs</span>
                <span>{{ partido.away_team.name }}</span>
            </div>
            <p class="text-slate-400 text-sm mt-2">üìÖ {{ partido.date|date:"l d F, H:i" }} hs</p>
        </div>

        <div class="p-8">
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="flex items-center justify-center space-x-6">
                    
                    <div class="text-center">
                        <label class="block text-sm font-bold text-gray-500 mb-1">{{ partido.home_team.flag_code|default:"üè†" }} Local</label>
                        <input type="number" name="predicted_home" min="0" max="20" required
                               value="{{ form.predicted_home.value|default_if_none:'' }}"
                               class="w-20 h-20 text-center text-4xl font-bold text-slate-900 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-4 focus:ring-yellow-200 outline-none transition">
                    </div>

                    <div class="text-4xl font-bold text-gray-300">-</div>

                    <div class="text-center">
                        <label class="block text-sm font-bold text-gray-500 mb-1">{{ partido.away_team.flag_code|default:"‚úàÔ∏è" }} Visitante</label>
                        <input type="number" name="predicted_away" min="0" max="20" required
                               value="{{ form.predicted_away.value|default_if_none:'' }}"
                               class="w-20 h-20 text-center text-4xl font-bold text-slate-900 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:ring-4 focus:ring-yellow-200 outline-none transition">
                    </div>
                </div>

                <div class="pt-4 space-y-3">
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transform active:scale-95 transition-all text-lg flex justify-center items-center">
                        üíæ Guardar Pron√≥stico
                    </button>
                    
                    <a href="{% url 'home' %}" class="block w-full text-center text-slate-500 hover:text-slate-800 font-medium py-2">
                        Cancelar y volver
                    </a>
                </div>
            </form>
        </div>
    </div>

    <p class="text-center text-gray-400 text-xs mt-4">
        *Recuerda: Si acertas el resultado exacto sumas <strong>3 puntos</strong>.
    </p>

</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\core\ranking.html
==================================================
{% extends 'core/base.html' %}

{% block content %}
<div class="max-w-3xl mx-auto">

    <div class="mb-8 text-center relative">
        <a href="{% url 'mis_torneos' %}" class="absolute left-0 top-2 text-gray-500 hover:text-slate-800 flex items-center text-sm font-bold">
            &larr; Volver a Mis Torneos
        </a>
        
        <div class="inline-block bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full font-bold mb-2 tracking-wide uppercase">
            Torneo Privado
        </div>
        
        <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">{{ titulo }}</h1>
        <p class="text-gray-500 text-sm mt-1">C√≥digo: <span class="font-mono">{{ torneo.code }}</span></p>
    </div>

    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <table class="w-full text-left">
            <thead class="bg-slate-50 text-slate-500 uppercase text-xs font-bold tracking-wider">
                <tr>
                    <th class="px-6 py-4">Pos</th>
                    <th class="px-6 py-4">Usuario</th>
                    <th class="px-6 py-4 text-right">Puntos</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {% for fila in ranking_data %}
                <tr class="{% if fila.es_el_usuario %}bg-yellow-50{% else %}hover:bg-gray-50 transition{% endif %}">
                    
                    <td class="px-6 py-4 font-bold text-gray-500">
                        {% if fila.posicion == 1 %}ü•á{% elif fila.posicion == 2 %}ü•à{% elif fila.posicion == 3 %}ü•â{% else %}#{{ fila.posicion }}{% endif %}
                    </td>

                    <td class="px-6 py-4 font-medium text-slate-900 flex items-center">
                        {% if fila.es_el_usuario %}
                            <span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>
                            {{ fila.usuario }} (T√∫)
                        {% else %}
                            {{ fila.usuario }}
                        {% endif %}
                    </td>

                    <td class="px-6 py-4 text-right font-bold text-lg text-slate-800">
                        {{ fila.puntos }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="px-6 py-8 text-center text-gray-400">
                        Nadie ha sumado puntos en este torneo a√∫n.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
==================================================
ARCHIVO: .\core\templates\socialaccount\login.html
==================================================
{% extends 'core/base.html' %}
{% load i18n %}

{% block content %}
<div class="flex items-center justify-center min-h-[80vh] px-4">
    <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-200 text-center">

        <div class="mb-6 flex justify-center">
        <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-12 h-12 animate-bounce" alt="Google">
        </div>

        <h2 class="text-2xl font-bold text-gray-800 mb-4">
            {% trans "Conectando con" %} {{ provider.name }}
        </h2>

        <p class="text-gray-600 mb-8 text-sm leading-relaxed">
            {% blocktrans with provider.name as provider %}
            Est√°s a punto de iniciar sesi√≥n en Prode Mundial utilizando tu cuenta de <strong>{{ provider }}</strong>. Por favor, confirma para continuar.
            {% endblocktrans %}
        </p>

        <form method="post">
            {% csrf_token %}
            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-bold text-slate-900 bg-yellow-500 hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 transition duration-200 uppercase tracking-wider">
                {% trans "Continuar" %}
            </button>
        </form>

        <p class="mt-6 text-xs text-gray-400">
            Esto solo tomar√° un segundo.
        </p>
    </div>
</div>
{% endblock %}